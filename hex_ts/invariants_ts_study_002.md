# 第2章　不変条件ってなに？（超やさしく）💎😊

## この章でわかること🎯✨

* 不変条件（Invariant）が「どんなルール」か、ふわっとじゃなく言葉にできる🙂
* 「壊れるとヤバいルール」と「ただの入力チェック」を分けられる🧠✨
* 自分の題材から“不変条件のタネ”を3〜10個見つけられる📝🌸

---

## 2-1. 不変条件＝「絶対に壊れちゃダメなルール」🛡️💥

不変条件って、めっちゃシンプルに言うと…

**「アプリの中で、いつ・どこで・誰が触っても、絶対に守られててほしい約束」**だよ🙂✨

たとえば現実でいうと👇

* 銀行口座の残高がマイナスになってたら困るよね💰😱
* エレベーターの定員オーバーは危ないよね🚪⚠️
* 学生証が“他人の学籍番号”と混ざったらヤバいよね🪪💥

ソフトでも同じで、**「壊れた瞬間に事故るルール」**が不変条件だよ🧯✨

---

## 2-2. 例でつかむ！不変条件ってこういうやつ💡😆

ここからは、超あるある例で感覚をつかもう〜！🙌✨

### 例1）金額はマイナス不可💰🚫

* ルール：`金額 >= 0`
* 壊れたら：返金・請求・会計が全部バグる😵‍💫

### 例2）在庫は0未満にならない📦🚫

* ルール：`在庫 >= 0`
* 壊れたら：売ってないのに売ったことになる😱📦

### 例3）メールはメールっぽい形である✉️✅

* ルール：`xxx@yyy.zzz` っぽい形（＋細かい条件）
* 壊れたら：連絡つかない／登録できない／迷惑メール判定の原因にも📩😢

### 例4）IDは混ぜない（UserIdとOrderId）🆔🌀

* ルール：UserId は UserId、OrderId は OrderId（混ぜない！）
* 壊れたら：別ユーザーの注文を操作…みたいな最悪事故🧨😱

---

## 2-3. 「不変条件が壊れる」と、どんなバグになる？😱🌀

不変条件が壊れると、バグの特徴がちょっと独特👇

* **バグが“あとから”出る**（入力時は通ったのに、別の場所で爆発💥）
* **原因が追いにくい**（どこで壊れたか分からない迷宮🧩😵‍💫）
* **修正が怖い**（ifを足しても別ルートが漏れる…🌀）

だからこそこの教材は、あとでやる「型＋境界」で、**そもそも壊れにくい形に寄せる**んだよ🛡️💎

---

## 2-4. 「不変条件」と「ただのチェック」のちがい🧠✨

ここ、超大事ポイント〜！📌💕

✅ 不変条件（Invariant）

* 壊れたら、そのデータは“存在してはいけない”レベル
* ドメイン（アプリの中心）でいつでも成立しててほしい
* 例：金額マイナス、在庫マイナス、日付の前後関係が逆、ID混線など💥

✅ ただのチェック（UI都合・運用都合も多い）

* 便利のため／見た目のため／一時的なルール
* 変わりやすい（キャンペーンで条件が変わる等）🎁
* 例：ニックネームは20文字まで、アイコン画像は2MBまで、など📷🙂

見分けコツはこれ👇✨
**「壊れたまま保存されてたら“後工程が死ぬ”か？」**
→ YESなら不変条件の可能性が高いよ🧯🔥

---

## 2-5. 予告：この教材での守り方は「型＋境界」だよ🚪🔒

今は“概念の章”だから、ふわっとだけ予告ね🙂✨

* **型（Type）**：プログラムの中で「混ぜない・壊れない」方向に寄せる🧷
* **境界（Boundary）**：外から入ってくる入力を、入口でチェックして“安全な形に変換”する🚪✅

特に大事なのがこれ👇
TypeScriptの型注釈は、最終的にJavaScriptへ変換されると **消える（実行時には残らない）** んだよね😅
だから、外部入力は「型だけで安全」にはならない → **境界での実行時チェックが必要**になるよ🛡️✨ ([typescriptlang.org][1])

ちなみに、2026年1月20日時点で TypeScript は GitHubのReleases上「5.9.3」がLatest表示になってるよ🔖✨（型システムは進化しても“実行時チェックが必要”という前提は変わらないよ） ([GitHub][2])

---

## 2-6. ミニ課題：不変条件を3〜10個、書き出そう📝✨

やることはシンプル！でも効果バツグン💪😊

### 手順🎀

1. **あなたの題材を1つ思い浮かべる**（会員登録・注文・予約・在庫・メモ帳でもOK）🎯
2. その題材に出てくる **“名詞”** を出す（User, Email, Price, Stock, Date…）🧠
3. 各名詞に対して、次の質問をする👇

   * 「これは **絶対NG** な状態ある？」🚫
   * 「**下限・上限** ある？」⬇️⬆️
   * 「**形式**（パターン）ある？」✉️🔢
   * 「**組み合わせ**のルールある？」（開始日＜終了日とか）📅
   * 「**状態**によって禁止される操作ある？」🚦

### 書き方テンプレ（コピペしてOK）🧁

* ルール①：＿＿＿＿ は ＿＿＿＿ でなければならない（理由：＿＿＿＿）
* ルール②：＿＿＿＿ は ＿＿＿＿ を超えてはいけない（理由：＿＿＿＿）
* ルール③：＿＿＿＿ と ＿＿＿＿ は矛盾してはいけない（理由：＿＿＿＿）

### 例：会員登録ならこんな感じ🌸

* ルール①：Emailは空ではダメ（連絡不能になる）✉️😢
* ルール②：Emailはメール形式である（配送不能になる）📩🚫
* ルール③：UserId と OrderId を混ぜない（別人の操作事故）🆔💥
* ルール④：年齢が必要なら 0未満はダメ（意味が壊れる）🎂🚫

3個だけでもOK！余裕あったら10個いっちゃお🙌✨

---

## 2-7. AI活用（この章バージョン）🤖💡

AIはこの章だと **「不変条件の候補出し」** がめっちゃ強いよ〜！💪😍
（採用するかはあなたが決めるのがコツ👌）

そのまま投げてOKな質問テンプレ👇✨

* 「この題材（＿＿＿）にありがちな不変条件を20個候補で出して。重要度も付けて」📝🤖
* 「不変条件が壊れる“最悪の事故シナリオ”を5つ考えて」😱💥
* 「入力の抜け漏れを起こしやすい境界（UI/API/DB/外部）を列挙して」🚪🔍
* 「初心者が見落としがちな“数値・日付・ID”の不変条件パターンを教えて」🔢📅🆔

---

## まとめ🎁✨

* 不変条件＝「壊れたら事故る、絶対守りたい約束」🛡️
* “ただのチェック”と分けると、設計がスッキリしてくる🧼✨
* 次は「チェックが散るとなぜ事故る？」を体験して、守り方の必要性を腹落ちさせるよ😱➡️😌

次章へGO〜！🚀📘

[1]: https://www.typescriptlang.org/docs/handbook/2/basic-types.html?utm_source=chatgpt.com "TypeScript: Documentation - The Basics"
[2]: https://github.com/microsoft/typescript/releases "Releases · microsoft/TypeScript · GitHub"
