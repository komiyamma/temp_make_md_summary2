# ç¬¬10ç« ï¼špayloadè¨­è¨ˆã®ã‚³ãƒ„ï¼ˆå£Šã‚Œã«ãã„JSONï¼‰ğŸ§©ğŸ“„

## ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ğŸ¯

* ã€Œå—ã‘å´ãŒå›°ã‚‰ãªã„ã€ã‚¤ãƒ™ãƒ³ãƒˆJSONï¼ˆpayloadï¼‰ã‚’ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ˜Š
* â€œã‚ã¨ã‹ã‚‰å¤‰æ›´ã—ã¦ã‚‚å£Šã‚Œã«ãã„â€è¨­è¨ˆã®ã‚³ãƒ„ãŒèº«ã«ã¤ãğŸ›¡ï¸
* TypeScriptã§ã€Œå‹ã€ï¼‹ã€Œå®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¾ã§ä¸€æ­©é€²ã‚ã‚‹ğŸš¶â€â™€ï¸âœ¨

---

## 10-1. ã¾ãšã€Œpayloadã€ã¨ã€Œå°ç­’ï¼ˆenvelopeï¼‰ã€ã‚’åˆ†ã‘ã‚ˆã†ğŸ“©ğŸ“¦

ã‚¤ãƒ™ãƒ³ãƒˆã«ã¯ã€ã ã„ãŸã„2ç¨®é¡ã®æƒ…å ±ãŒæ··ã–ã‚Šã¾ã™ğŸ‘‡

* **å°ç­’ï¼ˆenvelopeï¼‰**ï¼šã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ¡ã‚¿æƒ…å ±ï¼ˆèª°ãŒãƒ»ã„ã¤ãƒ»ä½•ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼Ÿï¼‰ğŸªªğŸ•’
* **payloadï¼ˆä¸­èº«ï¼‰**ï¼šæ¥­å‹™ãƒ‡ãƒ¼ã‚¿ï¼ˆæ³¨æ–‡IDãƒ»é‡‘é¡ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDâ€¦ãªã©ï¼‰ğŸ›’ğŸ’°

ã“ã®2å±¤ã‚’æ„è­˜ã™ã‚‹ã¨ã€è¨­è¨ˆãŒä¸€æ°—ã«ã‚¹ãƒƒã‚­ãƒªã—ã¾ã™âœ¨

## æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»£è¡¨ä¾‹ï¼šCloudEventsâ˜ï¸

CloudEvents ã¯ã€Œã‚¤ãƒ™ãƒ³ãƒˆã®å°ç­’ã€ã®å…±é€šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã€`specversion / id / source / type` ãªã©ã®å±æ€§ã‚’æŒã¡ã¾ã™ã€‚([GitHub][1])

**ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆå°ç­’ï¼‹dataãŒpayloadï¼‰**ğŸ‘‡

```json
{
  "specversion": "1.0",
  "id": "01HZY9VQW1Y5T6N6C9D4K9NQ0A",
  "source": "/orders",
  "type": "order.confirmed.v1",
  "time": "2026-02-03T06:00:00Z",
  "datacontenttype": "application/json",
  "data": {
    "orderId": "ORD_123",
    "customerId": "CUS_999",
    "totalAmountMinor": 1200,
    "currency": "JPY"
  }
}
```

> Outboxãƒ†ãƒ¼ãƒ–ãƒ«ã® `eventType` ã¯ã€CloudEventsã ã¨ `type` ã«ç›¸å½“ã™ã‚‹æ„Ÿã˜ã ã‚ˆğŸ™‚

---

## 10-2. eventTypeï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåï¼‰ã¯ã€Œèª­ã¿ã‚„ã™ããƒ»è¡çªã—ã«ããã€ğŸ·ï¸âœ¨

## ãƒ«ãƒ¼ãƒ«ï¼ˆãŠã™ã™ã‚ï¼‰ğŸ“›

* **éå»å½¢**ã£ã½ãï¼ˆèµ·ããŸäº‹å®Ÿï¼‰

  * âœ… `order.confirmed` / âœ… `user.registered`
* **ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥ã‚Œã¦è¡çªå›é¿**

  * âœ… `order.confirmed`ï¼ˆæ³¨æ–‡ç³»ï¼‰
  * âœ… `payment.succeeded`ï¼ˆæ±ºæ¸ˆç³»ï¼‰
* **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¿…ãšå…¥ã‚Œã‚‹**ï¼ˆè¶…é‡è¦ï¼‰ğŸ§¬

  * âœ… `order.confirmed.v1`
* **å˜èªåŒºåˆ‡ã‚Šã¯ `.`ï¼ˆãƒ‰ãƒƒãƒˆï¼‰**ãŒè¦‹ã‚„ã™ã„ï¼ˆå¥½ã¿ã§OKï¼‰ğŸ™‚

## ã‚ˆãã‚ã‚‹äº‹æ•…ğŸ˜µâ€ğŸ’«

* âŒ `OrderConfirmed`ï¼ˆè¨€èªã”ã¨ã«è¡¨è¨˜æºã‚Œã—ã‚„ã™ã„ï¼‰
* âŒ `orderConfirm`ï¼ˆâ€œä½•ãŒèµ·ããŸï¼Ÿâ€ãŒæ›–æ˜§ï¼‰
* âŒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç„¡ã—ï¼ˆã‚ã¨ã§åœ°ç„ğŸ‘»ï¼‰

---

## 10-3. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­è¨ˆã®åŸºæœ¬ï¼šã€Œå—ã‘å´ãŒè¿·ã‚ãªã„ã€ğŸğŸ™‚

## å‘½åã®ã‚³ãƒ„ğŸ§ 

* JSONã®ã‚­ãƒ¼ã¯ **camelCase** ãŒç„¡é›£ï¼ˆTSã¨ã‚‚ç›¸æ€§â—ï¼‰

  * âœ… `orderId`, `createdAt`, `totalAmountMinor`
* â€œæ„å‘³ãŒ1ã¤â€ã«ãªã‚‹ã‚ˆã†ã«åå‰ã‚’ã¤ã‘ã‚‹

  * âœ… `totalAmountMinor`ï¼ˆå˜ä½ã¾ã§å«ã‚ã¦ç¢ºå®šï¼ï¼‰
  * âŒ `amount`ï¼ˆå††ï¼Ÿãƒ‰ãƒ«ï¼Ÿç¨è¾¼ï¼Ÿç¨æŠœï¼Ÿå°æ•°ã‚ã‚‹ï¼ŸğŸ˜‡ï¼‰

## å‹ã®ã‚³ãƒ„ğŸ§·

* **IDã¯ string**ï¼ˆUUID/ULIDãªã©ï¼‰
* **é‡‘é¡ã¯ integerï¼ˆæœ€å°é€šè²¨å˜ä½ï¼‰**ã«å¯„ã›ã‚‹ï¼ˆå°æ•°ãŒäº‹æ•…ã‚Šã‚„ã™ã„ï¼‰ğŸ’°

  * ä¾‹ï¼š$1.00 â†’ 100ï¼ˆã‚»ãƒ³ãƒˆï¼‰ / Â¥100 â†’ 100ï¼ˆå††ã¯ã‚¼ãƒ­å°æ•°é€šè²¨ï¼‰
  * ã“ã†ã„ã†è¨­è¨ˆã¯æ±ºæ¸ˆAPIã§ã‚‚ä¸€èˆ¬çš„ã ã‚ˆã€‚([docs.stripe.com][2])
* **é€šè²¨ã‚³ãƒ¼ãƒ‰ã¯ ISO 4217ï¼ˆ3æ–‡å­—ï¼‰**ãŒå®šç•ªï¼ˆJPY/USD/EURâ€¦ï¼‰ğŸ’±

  * å…¬å¼èª¬æ˜ã€‚([iso.org][3])

---

## 10-1. ã€Œå°ç­’ã€ã¨ã€Œä¾¿ç®‹ã€ã‚’åˆ†ã‘ã‚‹âœ‰ï¸ğŸ“„

<!-- img: outbox_ts_study_010_envelope.png -->
Outboxãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’ **2ã¤ã®å±¤** ã§è€ƒãˆã‚‹ã¨æ•´ç†ã—ã‚„ã™ã„ã§ã™æ•´ç†ã—ã‚„ã™ã„ã§ã™ğŸ“š

## 10-4. ã€Œnullã€ã€Œæ¬ æã€ã€Œç©ºæ–‡å­—ã€å•é¡Œã‚’ç‰‡ä»˜ã‘ã‚ˆã†ğŸ§¹ğŸ˜‡

ã“ã“ã€å—ã‘å´ãŒä¸€ç•ªå›°ã‚‹ã‚„ã¤ã§ã™â€¦ï¼ğŸ¥¹

## åŸºæœ¬æ–¹é‡ï¼ˆãŠã™ã™ã‚ï¼‰âœ…

* **â€œç„¡ã„â€ã¯ã€åŸºæœ¬ã€Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è‡ªä½“ã‚’å‡ºã•ãªã„ã€**

  * âœ… `shippingAddress` ãŒç„¡ã„ãªã‚‰ã‚­ãƒ¼ã”ã¨ç„¡ã—
* **nullã¯æ¥µåŠ›ä½¿ã‚ãªã„**ï¼ˆæ„å‘³ãŒãƒ–ãƒ¬ã‚„ã™ã„ï¼‰

  * `null` = ä¸æ˜ï¼Ÿæœªè¨­å®šï¼Ÿå‰Šé™¤æ¸ˆã¿ï¼Ÿã®åŒºåˆ¥ãŒé›£ã—ã„ğŸ’¦
* ã©ã†ã—ã¦ã‚‚çŠ¶æ…‹ã‚’è¡¨ç¾ã—ãŸã„ãªã‚‰ã€**æ˜ç¤ºçš„ãªenum**ã«ã™ã‚‹

  * ä¾‹ï¼š`deliveryStatus: "unknown" | "scheduled" | "delivered"`

## ä¾‹ï¼ˆãŠã™ã™ã‚ï¼‰ğŸ“¦

```json
{
  "orderId": "ORD_123",
  "couponCode": "SAVE10"
}
```

ã‚¯ãƒ¼ãƒãƒ³ç„¡ã—ãªã‚‰ğŸ‘‡

```json
{
  "orderId": "ORD_123"
}
```

---

## 10-5. æ—¥ä»˜ãƒ»æ™‚åˆ»ã¯ RFC 3339ï¼ˆæ–‡å­—åˆ—ï¼‰ã§çµ±ä¸€ğŸ•’ğŸŒ

åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã§ã®æ™‚åˆ»ã¯ã€Œè¡¨è¨˜æºã‚Œã€ãŒäº‹æ•…ã®å…ƒğŸ˜µâ€ğŸ’«
RFC 3339 ã®å½¢å¼ï¼ˆä¾‹ï¼š`2026-02-03T06:00:00Z`ï¼‰ãŒã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚([IETF Datatracker][4])

TypeScriptå´ã¯ã“ã†ã„ã†å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ç½®ãã¨å®‰å¿ƒæ„ŸUPâœ¨

```ts
type Rfc3339String = string; // å®Ÿéš›ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§å®ˆã‚‹ã‚ˆ
```

---

## 10-6. IDï¼ˆevent id / order idï¼‰ã¯ã€Œä¸¦ã³æ›¿ãˆãŸã„ãªã‚‰ULIDã‚‚ä¾¿åˆ©ã€ğŸ†”ğŸ“Œ

ã‚¤ãƒ™ãƒ³ãƒˆã«ã¯ **ä¸€æ„ãªID**ãŒå¿…é ˆç´šã§ã™ï¼ˆé‡è¤‡æ’é™¤ãƒ»è¿½è·¡ã«ä½¿ã†ï¼‰ğŸ›¡ï¸
ULID ã¯ã€Œæ–‡å­—åˆ—ã§æ‰±ã„ã‚„ã™ã„ã€ã€Œæ™‚ç³»åˆ—ã‚½ãƒ¼ãƒˆã—ã‚„ã™ã„ã€ç‰¹å¾´ãŒã‚ã‚‹ã‚ˆã€‚([GitHub][5])

> ãŸã ã— UUID ã§ã‚‚OKï¼ã“ã“ã¯ â€œãƒãƒ¼ãƒ ã§çµ±ä¸€â€ ãŒã„ã¡ã°ã‚“å¼·ã„ğŸ’ª

---

## 10-7. schemaVersionï¼špayloadã¯å°†æ¥å¤‰ã‚ã‚‹å‰æã§å®ˆã‚‹ğŸ§¬ğŸ›¡ï¸

payloadã¯ã€å°†æ¥ã»ã¼ç¢ºå®Ÿã«å¤‰ã‚ã‚Šã¾ã™ğŸ™‚
ã ã‹ã‚‰ã©ã“ã‹ã« **ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±**ã‚’å…¥ã‚Œã¦ãŠãã®ãŒå¤§äº‹ï¼

å…¥ã‚Œæ–¹ã®ä¾‹ğŸ‘‡

* `type` ã«å«ã‚ã‚‹ï¼š`order.confirmed.v1`ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§å¼·ã„ï¼‰
* payloadã«æŒã¤ï¼š`schemaVersion: 1`
* CloudEventsã® `dataschema` ã«ã‚¹ã‚­ãƒ¼ãƒURLã‚’å…¥ã‚Œã‚‹ï¼ˆå¤§äººãªã‚„ã‚Šæ–¹ï¼‰([GitHub][1])

---

## 10-8. å®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼šJSON Schemaã§ã€Œå£Šã‚ŒãŸpayloadã€ã‚’æ­¢ã‚ã‚‹ğŸš§ğŸ§ª

TypeScriptã®å‹ã ã‘ã ã¨ã€**å—ã‘å–ã£ãŸJSONãŒå£Šã‚Œã¦ã¦ã‚‚é€šã£ã¡ã‚ƒã†**ã“ã¨ãŒã‚ã‚Šã¾ã™ğŸ˜±
ãã“ã§ **JSON Schema** ã‚’ä½¿ã†ã¨ã€Œå®Ÿè¡Œæ™‚ã«æ¤œæŸ»ã€ã§ãã¾ã™ã€‚
JSON Schemaï¼ˆç¾è¡Œã¯ 2020-12ï¼‰ãŒå…¬å¼ã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚([JSON Schema][6])

ã•ã‚‰ã«ã€AsyncAPIã§ã‚‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸payloadã‚’ã‚¹ã‚­ãƒ¼ãƒã§å®šç¾©ã™ã‚‹è€ƒãˆæ–¹ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚([AsyncAPI][7])

## ä¾‹ï¼šOrderConfirmed ã® payload schemaï¼ˆå­¦ç¿’ç”¨ãƒŸãƒ‹ï¼‰ğŸ“„

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "OrderConfirmedPayloadV1",
  "type": "object",
  "additionalProperties": false,
  "required": ["orderId", "customerId", "totalAmountMinor", "currency", "confirmedAt"],
  "properties": {
    "orderId": { "type": "string" },
    "customerId": { "type": "string" },
    "totalAmountMinor": { "type": "integer", "minimum": 0 },
    "currency": { "type": "string", "minLength": 3, "maxLength": 3 },
    "confirmedAt": { "type": "string", "format": "date-time" }
  }
}
```

## TypeScriptã®å‹ï¼ˆpayloadï¼‰ğŸ§©

```ts
export type OrderConfirmedPayloadV1 = {
  orderId: string;
  customerId: string;
  totalAmountMinor: number; // integeræƒ³å®š
  currency: string; // ISO 4217æƒ³å®š
  confirmedAt: string; // RFC 3339æƒ³å®š
};
```

## é€ã‚‹ç›´å‰ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ğŸ”

ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½•ã§ã‚‚ã„ã„ã‘ã©ã€ã“ã“ã§ã¯é›°å›²æ°—ã ã‘ğŸ™‚ï¼‰

```ts
function assertValidOrderConfirmedPayload(input: unknown): asserts input is OrderConfirmedPayloadV1 {
  // JSON Schema validatorï¼ˆä¾‹ï¼šAjvãªã©ï¼‰ã§æ¤œæŸ»ã™ã‚‹æƒ³å®š
  // NGãªã‚‰throwã—ã¦ã€Œå£Šã‚ŒãŸpayloadã¯Outboxã«å…¥ã‚Œãªã„ã€ğŸš«
}
```

**ãƒã‚¤ãƒ³ãƒˆğŸ’¡**

* âœ… **Outboxã«ä¿å­˜ã™ã‚‹å‰**ã«æ¤œæŸ»ï¼ˆå£Šã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’è²¯ã‚ãªã„ï¼‰
* âœ… `additionalProperties: false` ã§ â€œå¤‰ãªã‚­ãƒ¼æ··å…¥â€ ã‚’é˜²ã
* âœ… `required` ã¯æ…é‡ã«ï¼ˆå¾Œæ–¹äº’æ›ã‚’è€ƒãˆã‚‹ã¨ã€å¢—ã‚„ã—ã™ãæ³¨æ„ï¼‰

---

## 10-9. è¿½è·¡ã—ã‚„ã™ã•ï¼šcorrelationId / traceparent ã‚’å…¥ã‚Œã‚‹ã¨æœ€å¼·ğŸ”ğŸ§µ

ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã¯ã€Œã©ã®å‡¦ç†ã‹ã‚‰æ¥ãŸã‚¤ãƒ™ãƒ³ãƒˆï¼Ÿã€ãŒè¿·å­ã«ãªã‚ŠãŒã¡ğŸ¥¹
ãã“ã§ **ç›¸é–¢ID**ã‚„ **ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±**ãŒã‚ã‚‹ã¨ã€ãƒ­ã‚°è¿½è·¡ãŒã‚ã¡ã‚ƒæ¥½ã«ãªã‚Šã¾ã™âœ¨

* W3C Trace Context ã® `traceparent` ã¯åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã§ä½¿ã‚ã‚Œã‚‹æ¨™æº–çš„ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã™ã€‚([W3C][8])

payloadã«å…¥ã‚Œã‚‹ã‚ˆã‚Šã€**å°ç­’ï¼ˆenvelopeï¼‰å´ã®ãƒ¡ã‚¿**ã«å…¥ã‚Œã‚‹ã®ãŒãŠã™ã™ã‚ğŸ™‚
ï¼ˆã“ã®ã¸ã‚“ã¯ç¬¬21ç« ã®ã€Œè¦³æ¸¬ã€ã§è¶…åŠ¹ã„ã¦ãã‚‹ã‚ˆğŸ“Šï¼‰

---

## 10-10. payloadè¨­è¨ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ğŸ“ï¼ˆã“ã®ç« ã®ã¾ã¨ã‚ï¼‰

ä½œã£ãŸpayloadã‚’ã€é€ã‚‹å‰ã«ã“ã‚Œã§ãƒã‚§ãƒƒã‚¯ğŸ€

* [ ] eventTypeã¯ **éå»å½¢ã£ã½ã**ã€æ„å‘³ãŒ1ã¤ï¼ŸğŸ·ï¸
* [ ] **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**ãŒã©ã“ã‹ã«ã‚ã‚‹ï¼ŸğŸ§¬
* [ ] é‡‘é¡ã¯ **æœ€å°é€šè²¨å˜ä½ã®integer**ï¼ŸğŸ’°
* [ ] é€šè²¨ã¯ **ISO 4217**ã®3æ–‡å­—ï¼ŸğŸ’±
* [ ] æ—¥ä»˜ã¯ **RFC 3339**ï¼ˆdate-timeæ–‡å­—åˆ—ï¼‰ï¼ŸğŸ•’
* [ ] `null` åœ°ç„ã«ãªã£ã¦ãªã„ï¼Ÿï¼ˆæ¬ æã¨åŒºåˆ¥ã§ãã‚‹ï¼Ÿï¼‰ğŸ˜‡
* [ ] å—ã‘å´ãŒã€Œã“ã‚Œä½•ã®å˜ä½ï¼Ÿã€ã£ã¦ãªã‚‰ãªã„ï¼ŸğŸ“
* [ ] JSON Schemaç­‰ã§ **å®Ÿè¡Œæ™‚æ¤œæŸ»**ã§ãã‚‹ï¼ŸğŸš§
* [ ] ä½™è¨ˆãªå€‹äººæƒ…å ±ã‚’å…¥ã‚Œã¦ãªã„ï¼ŸğŸ”
* [ ] ãƒ­ã‚°è¿½è·¡ã§ãã‚‹ãƒ¡ã‚¿ï¼ˆcorrelation/traceï¼‰ãŒã‚ã‚‹ï¼ŸğŸ”

---

## ç·´ç¿’å•é¡ŒğŸ“âœ¨ï¼ˆæ‰‹ã‚’å‹•ã‹ã™ã‚„ã¤ï¼‰

## ãŠé¡Œï¼š`order.cancelled.v1` ã‚’è¨­è¨ˆã—ã‚ˆã†ğŸ›’âŒ

æ¬¡ã‚’æº€ãŸã™payloadã‚’è¨­è¨ˆã—ã¦ã¿ã¦ã­ğŸ‘‡

* å¿…é ˆï¼š`orderId`, `cancelledAt`, `reasonCode`
* `reasonCode` ã¯ `"customer_request" | "payment_failed" | "out_of_stock"` ã®ã©ã‚Œã‹
* `cancelledAt` ã¯ RFC 3339
* ä½™è¨ˆãªã‚­ãƒ¼ã¯å…¥ã‚Œãªã„ï¼ˆ`additionalProperties: false`ï¼‰

**ã‚„ã‚‹ã“ã¨ğŸ› ï¸**

1. payloadã®TypeScriptå‹ã‚’æ›¸ãğŸ§©
2. JSON Schemaã‚’æ›¸ãğŸ“„
3. ã‚µãƒ³ãƒ—ãƒ«payloadã‚’3ã¤ä½œã‚‹ï¼ˆæ­£å¸¸2ã¤ï¼‹ç•°å¸¸1ã¤ï¼‰ğŸ§ª

---

## AIæ´»ç”¨ã‚³ãƒ¼ãƒŠãƒ¼ğŸ¤–âœ¨ï¼ˆã“ã®ç« ã§ä½¿ãˆã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼‰

## 1) eventTypeå€™è£œã‚’å‡ºã—ã¦ã‚‚ã‚‰ã†ğŸ·ï¸

```text
æ³¨æ–‡ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­è¨ˆä¸­ã§ã™ã€‚
ã€Œæ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ã‚’è¡¨ã™eventTypeã‚’ã€è¡çªã—ã«ãã„å‘½åã§5æ¡ˆãã ã•ã„ã€‚
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»˜ãã€ãƒ‰ãƒƒãƒˆåŒºåˆ‡ã‚Šã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
```

## 2) JSON Schemaã®ãŸãŸãå°ã‚’ä½œã£ã¦ã‚‚ã‚‰ã†ğŸ“„

```text
æ¬¡ã®payloadè¦ä»¶ã‚’æº€ãŸã™JSON Schema Draft 2020-12 ã‚’ç”Ÿæˆã—ã¦ã€‚
- orderId: string required
- cancelledAt: RFC3339 date-time required
- reasonCode: enum(customer_request, payment_failed, out_of_stock) required
- additionalProperties: false
```

## 3) â€œå—ã‘å´ãŒå›°ã‚‹ç‚¹â€ ã‚’æŒ‡æ‘˜ã—ã¦ã‚‚ã‚‰ã†ğŸ‘€

```text
ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆpayloadæ¡ˆã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€å—ã‘å´ãŒå›°ã‚Šãã†ãªç‚¹ã‚’10å€‹æŒ‡æ‘˜ã—ã¦ã€‚
ç‰¹ã«ã€Œnullã€ã€Œå˜ä½ã€ã€Œå¾Œæ–¹äº’æ›ã€ã€Œå‘½åã®æ›–æ˜§ã•ã€ã‚’å³ã—ã‚ã«è¦‹ã¦ã€‚
ï¼ˆpayloadè²¼ã‚Šä»˜ã‘ï¼‰
```

[1]: https://github.com/cloudevents/spec/blob/main/cloudevents/formats/json-format.md?utm_source=chatgpt.com "spec/cloudevents/formats/json-format.md at main"
[2]: https://docs.stripe.com/api/charges/object?utm_source=chatgpt.com "The Charge object | Stripe API Reference"
[3]: https://www.iso.org/iso-4217-currency-codes.html?utm_source=chatgpt.com "ISO 4217 â€” Currency codes"
[4]: https://datatracker.ietf.org/doc/html/rfc3339?utm_source=chatgpt.com "RFC 3339 - Date and Time on the Internet: Timestamps"
[5]: https://github.com/ulid/spec?utm_source=chatgpt.com "The canonical spec for ulid"
[6]: https://json-schema.org/specification?utm_source=chatgpt.com "JSON Schema - Specification [#section]"
[7]: https://www.asyncapi.com/docs/concepts/asyncapi-document/define-payload?utm_source=chatgpt.com "Payload schema | AsyncAPI Initiative for event-driven APIs"
[8]: https://www.w3.org/TR/trace-context/?utm_source=chatgpt.com "Trace Context"
