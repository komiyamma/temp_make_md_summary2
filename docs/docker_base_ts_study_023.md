# ç¬¬23ç« ï¼šã‚ˆãã‚ã‚‹å¤±æ•—ï¼ˆãƒãƒ¼ãƒˆè¢«ã‚Š/èµ·å‹•ã—ã¦ãªã„/Firewallï¼‰ğŸ”¥ğŸšªğŸªŸ

ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ã¯ **ã€Œlocalhost:3000 ãŒé–‹ã‹ãªã„ğŸ˜µã€ã‚’è¦‹ãŸç¬é–“ã«ã€åŸå› ã‚’3åˆ†ã§çµã‚Œã‚‹** ã‚ˆã†ã«ãªã‚‹ã“ã¨ã§ã™ğŸ’ªâœ¨
ï¼ˆâ€œå‹˜â€ã˜ã‚ƒãªãã¦ã€â€œæ‰‹é †â€ã§å€’ã™å›ã ã‚ˆã€œğŸ˜Šï¼‰

---

## 0) ã¾ãšçµè«–ï¼šå›°ã£ãŸã‚‰ã“ã®3ã‚¹ãƒ†ãƒƒãƒ—ã ã‘ã‚„ã‚ã†âœ…âœ…âœ…

1. **ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã—ã¦ã‚‹ï¼Ÿ**ï¼ˆè½ã¡ã¦ãªã„ï¼Ÿï¼‰ğŸ³
2. **ãƒãƒ¼ãƒˆå…¬é–‹ã§ãã¦ã‚‹ï¼Ÿ**ï¼ˆ-p / ports æ›¸ã„ãŸï¼Ÿï¼‰ğŸ”Œ
3. **ãƒ›ã‚¹ãƒˆå´ã®ãƒãƒ¼ãƒˆã€èª°ã‹ä½¿ã£ã¦ãªã„ï¼Ÿ**ï¼ˆè¢«ã‚Šï¼‰âš”ï¸

ã“ã“ã¾ã§ã§å¤§åŠãŒç›´ã‚Šã¾ã™ğŸ˜†
ãã‚Œã§ã‚‚ãƒ€ãƒ¡ãªã‚‰ **Firewall/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** ã®é †ã§è¦‹ã‚‹ã‚ˆğŸ”¥ğŸ›¡ï¸

---

## 1) ç—‡çŠ¶â†’åŸå› ã® â€œå½“ãŸã‚Šâ€ æ—©è¦‹è¡¨ğŸ‘€ğŸ§ 

| ç—‡çŠ¶ğŸ˜µ                                                 | ã‚ã‚ŠãŒã¡ãªåŸå› ğŸ˜ˆ                           | ã¾ãšã‚„ã‚‹ã“ã¨âœ…                                     |
| ---------------------------------------------------- | ----------------------------------- | ------------------------------------------- |
| ãƒ–ãƒ©ã‚¦ã‚¶ãŒ `ERR_CONNECTION_REFUSED`                       | **ã‚³ãƒ³ãƒ†ãƒŠè½ã¡ã¦ã‚‹** / ã‚¢ãƒ—ãƒªèµ·å‹•å¤±æ•—              | `docker ps -a` â†’ `docker logs`              |
| `bind: address already in use`                       | **ãƒãƒ¼ãƒˆè¢«ã‚Š**ï¼ˆåˆ¥ã‚¢ãƒ—ãƒª or åˆ¥ã‚³ãƒ³ãƒ†ãƒŠï¼‰            | `netstat` / `Get-NetTCPConnection` ã§çŠ¯äººæ¢ã—    |
| `permission` / â€œforbidden by its access permissionsâ€ | **äºˆç´„ãƒãƒ¼ãƒˆ** / ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ / ç‰¹æ®Šãªå æœ‰          | `netsh ... excludedportrange` ã‚’è¦‹ã‚‹           |
| è‡ªåˆ†ã®PCã§ã¯é–‹ãã®ã«ã€ã‚¹ãƒãƒ›/åˆ¥PCã‹ã‚‰é–‹ã‹ãªã„                            | **127.0.0.1ã«ã—ã‹ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ãªã„** / Firewall | ãƒã‚¤ãƒ³ãƒ‰å…ˆ & Firewall ãƒ«ãƒ¼ãƒ«ç¢ºèª                      |
| Composeã§ `ports:` æ›¸ã„ãŸã®ã«é–‹ã‹ãªã„                          | ã‚µãƒ¼ãƒ“ã‚¹åãƒŸã‚¹ / èµ·å‹•å¤±æ•— / ãã‚‚ãã‚‚åˆ¥ãƒãƒ¼ãƒˆ           | `docker compose ps` â†’ `docker compose logs` |

---

## 2) ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šã‚ã–ã¨â€œãƒãƒ¼ãƒˆè¢«ã‚Šâ€ã‚’èµ·ã“ã—ã¦ç›´ã™ğŸ”¥âš”ï¸ğŸ§¯

## (A) å…ˆã«ãƒ›ã‚¹ãƒˆå´ã§ã€Œ3000ç•ªã€ã‚’åŸ‹ã‚ã‚‹ğŸ ğŸ”’

VS Code ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆPowerShellï¼‰ã§ğŸ‘‡

```bash
node -e "require('http').createServer((req,res)=>res.end('host 3000')).listen(3000, ()=>console.log('host listening 3000'))"
```

ã“ã®çŠ¶æ…‹ã§ `http://localhost:3000` ã‚’é–‹ãã¨ `host 3000` ãŒå‡ºã‚‹ã¯ãšğŸ™‚

## (B) ãã“ã¸ Docker ã§ 3000 ã‚’ä½¿ãŠã†ã¨ã—ã¦ã¿ã‚‹ğŸ³ğŸ’¥

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ğŸ‘‡ï¼ˆä¾‹ã¨ã—ã¦ nginx ã‚’ä½¿ã†ã‚ˆï¼‰

```bash
docker run --rm -p 3000:80 nginx
```

ğŸ‘‰ ã ã„ãŸã„ **ã€Œã‚‚ã†ä½¿ã‚ã‚Œã¦ã‚‹ï¼ã€ç³»ã®ã‚¨ãƒ©ãƒ¼** ã§æ­¢ã¾ã‚Šã¾ã™ğŸ˜‡
ã“ã‚ŒãŒ **ãƒãƒ¼ãƒˆè¢«ã‚Š** ã®å…¸å‹ï¼

## (C) ç›´ã—æ–¹ï¼šãƒ›ã‚¹ãƒˆå´ãƒãƒ¼ãƒˆã‚’ãšã‚‰ã™ğŸ”âœ¨

```bash
docker run --rm -p 3001:80 nginx
```

ä»Šåº¦ã¯ `http://localhost:3001` ã§è¦‹ãˆã‚‹ã¯ãšğŸ‰

> ğŸ§ ãƒã‚¤ãƒ³ãƒˆï¼š`-p ãƒ›ã‚¹ãƒˆå´:ã‚³ãƒ³ãƒ†ãƒŠå´`
> ã€Œãƒ›ã‚¹ãƒˆå´ã€ã¯ *ã‚ãªãŸã®PCã§ç©ºã„ã¦ã‚‹ç•ªå·* ã‚’ä½¿ãˆã°OKğŸ‘

---

## 3) â€œèµ·å‹•ã—ã¦ãªã„/è½ã¡ã¦ã‚‹â€ ã‚’æœ€é€Ÿã§è¦‹æŠœãğŸ£ğŸ”

## 3-1) ã¾ãšä¸€è¦§ï¼ğŸ³ğŸ“‹

```bash
docker ps
```

* ã“ã“ã«å‡ºã¦ãªã„ â†’ **èµ·å‹•ã—ã¦ãªã„**ğŸ˜µ
* ã˜ã‚ƒã‚æ¬¡ğŸ‘‡

```bash
docker ps -a
```

`Exited` ãŒã„ãŸã‚‰ã€ã»ã¼ã‚³ã‚³ãŒåŸå› ğŸ˜‡

## 3-2) ã™ããƒ­ã‚°ï¼ğŸªµğŸ‘€

```bash
docker logs <ã‚³ãƒ³ãƒ†ãƒŠå or ID>
```

**â€œè½ã¡ãŸç†ç”±â€ãŒã ã„ãŸã„æ›¸ã„ã¦ã‚ã‚‹**ã®ã§ã€ã¾ãšèª­ã‚€ç™–ã‚’ã¤ã‘ã‚‹ã¨å‹ã¡ã‚„ã™ã„ğŸ†âœ¨

---

## 4) â€œãƒãƒ¼ãƒˆå…¬é–‹ã§ãã¦ãªã„â€ ã‚’è¦‹æŠœãğŸ”ŒğŸ•µï¸

## 4-1) `docker ps` ã® PORTS æ¬„ã‚’è¦‹ã‚‹ğŸ‘€

* `0.0.0.0:3000->3000/tcp` ã¿ãŸã„ã«å‡ºã¦ã‚‹ï¼Ÿ
  â†’ **å…¬é–‹ã§ãã¦ã‚‹**âœ…
* ä½•ã‚‚å‡ºã¦ãªã„ï¼Ÿ
  â†’ **å…¬é–‹ã—ã¦ãªã„**ï¼ˆ`-p` / Composeã® `ports:` ã‚’å¿˜ã‚ŒãŸï¼‰âŒ

## 4-2) Docker Desktop ã® â€œãƒãƒ¼ãƒˆã®ãƒã‚¤ãƒ³ãƒ‰æŒ™å‹•â€ è¨­å®šã‚‚çŸ¥ã£ã¦ãŠãâš™ï¸ğŸ³

Docker Desktop ã«ã¯ **å…¬é–‹ãƒãƒ¼ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 0.0.0.0 ã«ã™ã‚‹ã‹ã€localhost ã«å¯„ã›ã‚‹ã‹** ã¿ãŸã„ãªè¨­å®šãŒã‚ã‚Šã¾ã™ã€‚([Docker Documentation][1])
é–‹ç™ºä¸­ã«ã€Œå¤–ã‹ã‚‰è¦‹ãˆãªãã¦åŠ©ã‹ã‚‹ã€ã“ã¨ã‚‚ã‚ã‚‹ã—ã€é€†ã«ã€Œã‚¹ãƒãƒ›ã‹ã‚‰è¦‹ãˆãªã„ğŸ˜µã€åŸå› ã«ã‚‚ãªã‚‹ã‚ˆã€œğŸ“±ğŸ’¦

ã•ã‚‰ã«ã€Dockerå´ã®â€œå…¬é–‹ãƒãƒ¼ãƒˆâ€ã®è€ƒãˆæ–¹ã‚„å®‰å…¨é¢ï¼ˆlocalhostå…¬é–‹ã®æ‰±ã„ï¼‰ã‚‚å…¬å¼ã«ã¾ã¨ã¾ã£ã¦ã‚‹ã®ã§ã€ã“ã“ã¯ä¸€å›ç›®ã‚’é€šã™ã¨å¼·ã„ã§ã™ã€‚([Docker Documentation][2])

---

## 5) â€œãƒãƒ¼ãƒˆè¢«ã‚Šâ€ çŠ¯äººæœã—ï¼ˆWindowsç·¨ï¼‰ğŸ•µï¸â€â™‚ï¸ğŸªŸ

## 5-1) ãã®ãƒãƒ¼ãƒˆã€èª°ãŒä½¿ã£ã¦ã‚‹ï¼Ÿï¼ˆPowerShellï¼‰ğŸ”

ä¾‹ï¼š3000ç•ªã‚’èª¿ã¹ã‚‹ğŸ‘‡

```powershell
Get-NetTCPConnection -LocalPort 3000 -State Listen | Select-Object -First 5
```

PID ãŒå‡ºãŸã‚‰ã€æ¬¡ğŸ‘‡

```powershell
Get-Process -Id <PID>
```

## 5-2) æ˜”ãªãŒã‚‰ã® netstat ã§ã‚‚OKğŸ“Ÿ

```bat
netstat -ano | findstr :3000
```

PID ãŒã‚ã‹ã£ãŸã‚‰ğŸ‘‡

```bat
tasklist /FI "PID eq <PID>"
```

ğŸ‘‰ çŠ¯äººãŒ **Node / VS Code / åˆ¥ã‚³ãƒ³ãƒ†ãƒŠ / DB** ã¨ã‹ãªã‚‰ã€æ­¢ã‚ã‚‹ã‹ãƒãƒ¼ãƒˆãšã‚‰ã™ã ã‘ã§è§£æ±ºğŸ¯

---

## 6) â€œforbidden / access permissionsâ€ ç³»ã¯ã€Œäºˆç´„ãƒãƒ¼ãƒˆã€ã‚‚ç–‘ã†ğŸ§¨ğŸ§ 

Docker ã‚’å‹•ã‹ãã†ã¨ã—ã¦ã€

* â€œAn attempt was made to access a socket in a way forbidden by its access permissionsâ€
* â€œforbidden by its access permissionsâ€

ã¿ãŸã„ãªã®ãŒå‡ºãŸã‚‰ã€**Windowså´ã§ãã®ãƒãƒ¼ãƒˆå¸¯ãŒäºˆç´„ã•ã‚Œã¦ã‚‹** ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ğŸ˜µâ€ğŸ’«
ç¢ºèªã‚³ãƒãƒ³ãƒ‰ï¼ˆç®¡ç†è€…ã§å®Ÿè¡ŒãŒç„¡é›£ï¼‰ğŸ‘‡ ([Microsoft Learn][3])

```bat
netsh interface ipv4 show excludedportrange protocol=tcp
```

äºˆç´„å¸¯ã«ã¶ã¤ã‹ã£ã¦ãŸã‚‰ã€**åˆ¥ãƒãƒ¼ãƒˆã«é€ƒãŒã™**ã®ãŒä¸€ç•ªæ—©ã„ã§ã™ğŸƒâ€â™‚ï¸ğŸ’¨
ï¼ˆã“ã“ã®æ²¼ã¯æ·±è¿½ã„ã™ã‚‹ã¨æ™‚é–“æº¶ã‘ã‚‹ã®ã§ã€ã¾ãšé€ƒã’ã‚‹ã®ãŒæ­£è§£ã«ãªã‚ŠãŒã¡ğŸ˜‡ï¼‰

---

## 7) Firewall / ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã§æ­¢ã‚ã‚‰ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ğŸ›¡ï¸ğŸ”¥

## 7-1) ã„ã¤ Firewall ã‚’ç–‘ã†ï¼ŸğŸ§ 

* âœ… **è‡ªåˆ†ã®PCã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalhostï¼‰ã§ã‚‚ãƒ€ãƒ¡**
  â†’ ã¾ãšã¯ã€Œèµ·å‹•/å…¬é–‹/è¢«ã‚Šã€ã‚’ç–‘ã†ï¼ˆFirewallç‡ã¯ãã“ã¾ã§é«˜ããªã„ï¼‰
* âœ… **åˆ¥PC/ã‚¹ãƒãƒ›ï¼ˆLANï¼‰ã‹ã‚‰ã ã‘è¦‹ãˆãªã„**
  â†’ Firewall ãŒâ€œæœ¬å‘½â€ã«ãªã‚Šã‚„ã™ã„ğŸ“±ğŸ”¥

Docker Desktop ã®é€šä¿¡ã¯ã€Firewall ã‚„ endpoint protectionï¼ˆä¼æ¥­ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç³»ï¼‰ã‹ã‚‰ã‚‚è¦‹ãˆã‚‹ãƒ»å½±éŸ¿ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã€ã¨å…¬å¼ã«ã‚‚æ›¸ã‹ã‚Œã¦ã¾ã™ã€‚([Docker Documentation][4])

## 7-2) ãƒãƒ¼ãƒˆã‚’è¨±å¯ã™ã‚‹ï¼ˆPowerShellä¾‹ï¼‰ğŸ§¯

Windows Firewall ã¯ **PowerShell / netsh ã§æ“ä½œã§ãã‚‹** ã®ã§ã€æ¤œè¨¼ãŒé€Ÿã„ã§ã™ã€‚([Microsoft Learn][5])
`New-NetFirewallRule` ã§ãƒ«ãƒ¼ãƒ«ä½œæˆã‚‚å¯èƒ½ã€‚([Microsoft Learn][6])

ä¾‹ï¼šTCP 3000 ã‚’å—ã‘å…¥ã‚Œï¼ˆå¿…è¦ãªã‚‰ï¼‰ğŸ‘‡

```powershell
New-NetFirewallRule -DisplayName "Allow TCP 3000 (Dev)" -Direction Inbound -Action Allow -Protocol TCP -LocalPort 3000
```

> âš ï¸æ³¨æ„ï¼šã‚€ã‚„ã¿ã«å…¨é–‹æ”¾ã¯å±é™ºã ã‚ˆğŸ˜±
> â€œLANå†…ã ã‘ã§ä½¿ã†â€ ã¨ã‹ â€œPrivateãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘â€ ã¿ãŸã„ã«çµã‚‹é‹ç”¨ãŒåŸºæœ¬ï¼ˆä¼šç¤¾PCãªã‚‰ç‰¹ã«ï¼‰ğŸ›¡ï¸âœ¨

---

## 8) AIã«æŠ•ã’ã‚‹ã¨çˆ†é€Ÿã«ãªã‚‹è³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ğŸ¤–âš¡

## (1) ã‚¨ãƒ©ãƒ¼æ–‡ã‚’è²¼ã‚‹ã ã‘ã§â€œå½“ãŸã‚Šâ€ã‚’å‡ºã™ğŸ¯

* ã€Œã“ã®ã‚¨ãƒ©ãƒ¼ã®åŸå› å€™è£œãƒˆãƒƒãƒ—3ã¨ã€ç¢ºèªã‚³ãƒãƒ³ãƒ‰ã‚’é †ç•ªã«å‡ºã—ã¦ã€
* ã€ŒWindows + Docker Desktop + WSL2 å‰æã§ã€æœ€çŸ­ã®åˆ‡ã‚Šåˆ†ã‘æ‰‹é †ã«ã—ã¦ã€

## (2) ãƒ­ã‚°è¦ç´„ï¼ˆé•·ã„ãƒ­ã‚°ã‚’1åˆ†ã§èª­ã‚€ï¼‰ğŸªµâœ‚ï¸

* ã€Œã“ã®ãƒ­ã‚°ã‚’3è¡Œã«è¦ç´„ã—ã¦ã€æ¬¡ã«è¦‹ã‚‹ã¹ãè¨­å®š/ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ™ã’ã¦ã€

## (3) ãƒãƒ¼ãƒˆè¢«ã‚Šèª¿æŸ»ã®è‡ªå‹•åŒ–ğŸ› ï¸

* ã€ŒPowerShellã§â€œæŒ‡å®šãƒãƒ¼ãƒˆã®LISTENãƒ—ãƒ­ã‚»ã‚¹åã¨PIDã‚’å‡ºã™â€ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ä½œã£ã¦ã€

---

## 9) ç« æœ«ãƒŸãƒ‹ãƒã‚§ãƒƒã‚¯âœ…ğŸ“

* [ ] `docker ps -a` ã§ **Exited ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹**
* [ ] `docker ps` ã® PORTS æ¬„ã§ **å…¬é–‹ã§ãã¦ã‚‹/ã§ãã¦ãªã„ã‚’åˆ¤æ–­ã§ãã‚‹**
* [ ] Windowsã§ **3000ç•ªã®çŠ¯äººPIDâ†’ãƒ—ãƒ­ã‚»ã‚¹å** ã¾ã§è¾¿ã‚Œã‚‹
* [ ] LANã‹ã‚‰è¦‹ãˆãªã„æ™‚ã« **Firewall ã‚’ç–‘ã†é †ç•ª**ãŒã‚ã‹ã‚‹

---

æ¬¡ã®ç¬¬24ç« ã§ã¯ã€ã•ã‚‰ã«æ··ä¹±ã—ãŒã¡ãª **ã€Œã‚³ãƒ³ãƒ†ãƒŠå†…ã® localhost ç½ ã€**ï¼ˆâ€œè‡ªåˆ†è‡ªèº«ã‚’æŒ‡ã—ã¦ã‚‹ã ã‘å•é¡Œâ€ï¼‰ã‚’ã¶ã£å£Šã—ã«ã„ãã‚ˆã€œğŸª¤ğŸ˜µâ€ğŸ’«â¡ï¸ğŸ’ªğŸ˜„

[1]: https://docs.docker.com/desktop/settings-and-maintenance/settings/?utm_source=chatgpt.com "Change your Docker Desktop settings"
[2]: https://docs.docker.com/engine/network/port-publishing/?utm_source=chatgpt.com "Port publishing and mapping"
[3]: https://learn.microsoft.com/en-us/answers/questions/5536234/access-a-socket-in-a-way-forbidden-by-its-access-p?utm_source=chatgpt.com "access a socket in a way forbidden by its access permissions"
[4]: https://docs.docker.com/desktop/features/networking/?utm_source=chatgpt.com "Networking on Docker Desktop"
[5]: https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/configure-with-command-line?utm_source=chatgpt.com "Manage Windows Firewall With the Command Line"
[6]: https://learn.microsoft.com/en-us/powershell/module/netsecurity/new-netfirewallrule?view=windowsserver2025-ps&utm_source=chatgpt.com "New-NetFirewallRule (NetSecurity)"
