# ç¬¬16ç« ï¼šã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã®ç›´æ„Ÿï¼ˆå¤šæ•°æ±ºï¼‰ğŸ—³ï¸âœ¨

**çµè«–1è¡Œ**ï¼š**ã€ŒNå€‹ã«è¤‡è£½ã—ãŸãƒ‡ãƒ¼ã‚¿ã€ã‚’â€œä½•ç¥¨é›†ã¾ã£ãŸã‚‰OKï¼Ÿâ€ã§é‹ç”¨ã™ã‚‹ã¨ã€é€Ÿã•âš¡ã¨ä¸€è‡´âœ…ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é¸ã¹ã‚‹ã‚ˆï¼ˆãã‚ŒãŒã‚¯ã‚©ãƒ¼ãƒ©ãƒ ï¼‰**ğŸ˜Šâœ¨

---

## 16.1 ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã£ã¦ãªã«ï¼Ÿï¼ˆè¶…ã–ã£ãã‚Šï¼‰ğŸ§ ğŸ’¡

åˆ†æ•£ã§ã¯ã€åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã—ã¾ã™ğŸ“¦ğŸ“¦ğŸ“¦
ã§ã‚‚ã‚³ãƒ”ãƒ¼ã¯â€œåŒæ™‚ãƒ”ãƒƒã‚¿ãƒªâ€ã«ã¯æƒã‚ãªã„ã“ã¨ãŒã‚ã‚‹ã‚“ã ã£ãŸã­â€¦â³ğŸ˜µâ€ğŸ’«

ãã“ã§ç™»å ´ã™ã‚‹ã®ãŒ **ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ï¼ˆquorumï¼‰ï¼ã€Œä½•ç¥¨é›†ã¾ã£ãŸã‚‰æˆåŠŸã«ã™ã‚‹ï¼Ÿã€** ã¨ã„ã†è€ƒãˆæ–¹ğŸ—³ï¸âœ¨

* **æ›¸ãè¾¼ã¿**ï¼šä½•å°ãŒã€Œæ›¸ã‘ãŸã‚ˆï¼ã€ã£ã¦è¿”ã—ãŸã‚‰æˆåŠŸã«ã™ã‚‹ï¼Ÿâœï¸âœ…
* **èª­ã¿å–ã‚Š**ï¼šä½•å°ã‹ã‚‰è¿”äº‹ãŒæ¥ãŸã‚‰ã€Œã“ã‚Œã§æ±ºã‚ã‚‹ï¼ã€ã«ã™ã‚‹ï¼ŸğŸ‘€âœ…

ã“ã®ã€Œç¥¨æ•°ã€ã‚’å¤‰ãˆã‚‹ã¨ã€**é€Ÿã„ã‘ã©ã‚ºãƒ¬ã‚„ã™ã„**âš¡ğŸŒ€ï¼**é…ã„ã‘ã©æƒã„ã‚„ã™ã„**ğŸ¢âœ… ã‚’èª¿æ•´ã§ãã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆï¼

---

## 16.2 N / W / R ã£ã¦ä½•ï¼ŸğŸ”¤ğŸ“Œ

ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã¯ã ã„ãŸã„ã“ã®3ã¤ã§è©±ã—ã¾ã™ğŸ‘‡

* **N**ï¼šåŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ãã‚³ãƒ”ãƒ¼æ•°ï¼ˆè¤‡è£½æ•°ï¼‰ï¼ãƒ¬ãƒ—ãƒªã‚«æ•°
* **W**ï¼šæ›¸ãè¾¼ã¿æˆåŠŸã«å¿…è¦ãªã€ŒOKç¥¨ã€ã®æ•°
* **R**ï¼šèª­ã¿å–ã‚Šã§é›†ã‚ã‚‹ã€Œå›ç­”ç¥¨ã€ã®æ•°

Cassandraã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€Dynamoç³»ã®è€ƒãˆæ–¹ã¨ã—ã¦ **R / W / N ã¨ `R + W > N`** ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ğŸ“˜âœ¨ ([Apache Cassandra][1])

---

## 16.3 ã„ã¡ã°ã‚“å¤§äº‹ï¼š`R + W > N` ã®ç›´æ„Ÿ ğŸ¤âœ¨

**`R + W > N` ã ã¨ã€èª­ã¿å–ã‚Šå´ã¨æ›¸ãè¾¼ã¿å´ã®â€œæŠ•ç¥¨ãƒ¡ãƒ³ãƒãƒ¼â€ãŒå¿…ãšé‡ãªã‚‹**ï¼ˆå°‘ãªãã¨ã‚‚1å°ã¯å…±é€šã«ãªã‚‹ï¼‰
â†’ **ã€Œæ›¸ãè¾¼ã¿ã§OKã—ãŸæœ€æ–°ãƒ‡ãƒ¼ã‚¿ã€ã‚’ã€èª­ã¿å–ã‚Šã§æ‹¾ãˆã‚‹å¯èƒ½æ€§ãŒé«˜ããªã‚‹** ã¨ã„ã†ç›´æ„ŸğŸ˜Š

ã“ã®â€œé‡ãªã‚Šâ€ãŒã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã®ã‚­ãƒ¢ã§ã€è§£èª¬ã¨ã—ã¦ã‚‚ã‚ˆã **ã€Œèª­ã¿å–ã‚Šé›†åˆã¨æ›¸ãè¾¼ã¿é›†åˆãŒäº¤å·®ã™ã‚‹ã€** ã¨èª¬æ˜ã•ã‚Œã¾ã™ğŸ§© ([System Overflow][2])

---

## 16.4 3ãƒãƒ¼ãƒ‰ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚ˆã†ï¼ˆN=3ï¼‰ğŸ§‘â€ğŸ¤â€ğŸ§‘ğŸ§‘â€ğŸ¤â€ğŸ§‘ğŸ§‘â€ğŸ¤â€ğŸ§‘

```text
ãƒãƒ¼ãƒ‰ A / B / C ã®3å°ã«ã‚³ãƒ”ãƒ¼ï¼ˆN=3ï¼‰

æ›¸ãè¾¼ã¿ W=2ï¼ˆ2ç¥¨ã§æˆåŠŸï¼‰
èª­ã¿å–ã‚Š R=2ï¼ˆ2ç¥¨é›†ã‚ã¦æ±ºã‚ã‚‹ï¼‰

æ›¸ãè¾¼ã¿ã®OKç¥¨ï¼šAã¨B ã ã£ãŸã¨ã™ã‚‹
èª­ã¿å–ã‚Šã®å›ç­”ç¥¨ï¼šBã¨C ã ã£ãŸã¨ã™ã‚‹

â†’ B ãŒ â€œã‹ã¶ã£ã¦ã‚‹â€ï¼
â†’ ã ã‹ã‚‰ã€èª­ã¿å–ã‚Šã¯ã€Œæœ€æ–°ã‚’çŸ¥ã£ã¦ã‚‹ãƒãƒ¼ãƒ‰ã€ã«å½“ãŸã‚Šã‚„ã™ã„âœ¨
```

### ã‚ˆãä½¿ã†å®šç•ªï¼ˆéåŠæ•°ï¼‰ğŸ—³ï¸âœ¨

* **QUORUM / majority** ã¯ã€Œã ã„ãŸã„éåŠæ•°ã€
* ãŸã¨ãˆã°ãƒ¬ãƒ—ãƒªã‚«3å°ãªã‚‰ **2å°** ãŒã‚¯ã‚©ãƒ¼ãƒ©ãƒ ï¼ˆéåŠæ•°ï¼‰
  ï¼ˆCassandraã§ã¯ QUORUM ã®è¨ˆç®—å¼ä¾‹ã‚‚æ˜è¨˜ã•ã‚Œã¦ã‚‹ã‚ˆï¼‰([DataStax Documentation][3])

---

## 16.5 ãƒãƒ³ã‚ºã‚ªãƒ³ï¼š3ãƒãƒ¼ãƒ‰æ“¬ä¼¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã€Œ2ç¥¨å–ã‚ŒãŸã‚‰OKã€ã‚’ä½“é¨“ğŸ§ªâœ¨

ã“ã“ã§ã¯ã€Œåˆ†æ•£DBã£ã½ã„é›°å›²æ°—ã€ã‚’ **TypeScriptã®ãƒŸãƒ‹å®Ÿé¨“**ã§ä½“é¨“ã™ã‚‹ã‚ˆğŸ˜Š
ï¼ˆæœ¬ç‰©ã®DBã¯ä½¿ã‚ãšã€ãƒ¡ãƒ¢ãƒªä¸Šã§ â€œãƒ¬ãƒ—ãƒªã‚«3å°â€ ã‚’çœŸä¼¼ã™ã‚‹ã ã‘ï¼ï¼‰

### â‘  ä¾å­˜ã®è¿½åŠ ï¼ˆtsxã§TSã‚’ãã®ã¾ã¾å®Ÿè¡Œï¼‰âš™ï¸

```bash
npm i -D tsx
```

### â‘¡ ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆğŸ“„âœ¨

`apps/sim/quorum.ts` ã‚’ä½œã£ã¦ã€æ¬¡ã‚’è²¼ã‚Šä»˜ã‘ã¦ã­ğŸ‘‡

```ts
type Value = { version: number; data: string };

class Replica {
  public store: Value = { version: 0, data: "(init)" };

  constructor(
    public readonly name: string,
    public isUp = true,
    public dropWrites = false,        // æ“¬ä¼¼çš„ãªåˆ†æ–­ï¼šã“ã®ãƒãƒ¼ãƒ‰ã ã‘æ›¸ãè¾¼ã¿ãŒå±Šã‹ãªã„
    public latencyMs = 50             // æ“¬ä¼¼é…å»¶
  ) {}

  async write(v: Value): Promise<void> {
    if (!this.isUp) throw new Error(`${this.name} is down`);
    if (this.dropWrites) throw new Error(`${this.name} dropped write (partition)`);

    await sleep(this.latencyMs);
    if (v.version >= this.store.version) {
      this.store = v;
    }
  }

  async read(): Promise<Value> {
    if (!this.isUp) throw new Error(`${this.name} is down`);
    await sleep(this.latencyMs);
    return this.store;
  }
}

class Coordinator {
  private version = 0;

  constructor(
    private readonly replicas: Replica[],
    private readonly N: number,
    private readonly W: number,
    private readonly R: number
  ) {}

  async write(data: string): Promise<void> {
    const v: Value = { version: ++this.version, data };

    const tasks = this.replicas.map(async (r) => {
      await r.write(v);
      return r.name;
    });

    const ok = await settleUntil(tasks, this.W);
    console.log(`âœï¸ write "${data}" v=${v.version} âœ… acks=${ok.join(", ")}`);
  }

  async read(): Promise<Value> {
    // â€œæœ€åˆã«è¿”ã£ã¦ããŸRä»¶â€ã ã‘ã§æ±ºã‚ã‚‹ï¼ˆCL=ONEã¿ãŸã„ãªé›°å›²æ°—ï¼‰
    const tasks = this.replicas.map(async (r) => {
      const val = await r.read();
      return { from: r.name, val };
    });

    const got = await settleUntil(tasks, this.R);
    const picked = got
      .map((x) => x.val)
      .reduce((a, b) => (a.version >= b.version ? a : b));

    console.log(
      `ğŸ‘€ read (R=${this.R}) got=[${got.map((x) => `${x.from}:v${x.val.version}`).join(", ")}] -> pick v${picked.version}`
    );

    return picked;
  }
}

async function sleep(ms: number) {
  return new Promise<void>((res) => setTimeout(res, ms));
}

// Promiseé…åˆ—ã‹ã‚‰ã€ŒæˆåŠŸãŒkä»¶é›†ã¾ã‚‹ã¾ã§ã€å¾…ã¤ï¼ˆå¤±æ•—ã¯ç„¡è¦–ï¼‰
// kä»¶é›†ã¾ã‚‰ãªã‘ã‚Œã°å¤±æ•—
async function settleUntil<T>(promises: Promise<T>[], k: number): Promise<T[]> {
  return new Promise<T[]>((resolve, reject) => {
    const results: T[] = [];
    let done = 0;
    let failed = 0;

    promises.forEach((p) => {
      p.then((v) => {
        results.push(v);
        done++;
        if (results.length >= k) resolve(results);
      }).catch(() => {
        failed++;
        done++;
        if (done === promises.length && results.length < k) {
          reject(new Error(`Not enough successes: need ${k}, got ${results.length}`));
        }
      });
    });
  });
}

async function main() {
  // âœ… Case A: â€œå¤šæ•°æ±ºã§OKâ€ (N=3, W=2, R=2)
  console.log("\n=== Case A: N=3 W=2 R=2 (quorum) ===");
  {
    const A = new Replica("A", true, false, 30);
    const B = new Replica("B", true, false, 40);
    const C = new Replica("C", true, false, 200); // ã¡ã‚‡ã„é…ã„
    const coord = new Coordinator([A, B, C], 3, 2, 2);

    await coord.write("apple");
    await coord.read();
  }

  // âš¡ Case B: â€œé€Ÿã„ã‘ã©ã‚ºãƒ¬ã‚„ã™ã„â€ (N=3, W=1, R=1)
  console.log("\n=== Case B: N=3 W=1 R=1 (fast but stale risk) ===");
  {
    const A = new Replica("A", true, true, 20);   // Aã ã‘åˆ†æ–­ï¼šæ›¸ãè¾¼ã¿å±Šã‹ãªã„
    const B = new Replica("B", true, false, 40);
    const C = new Replica("C", true, false, 200);

    const coord = new Coordinator([A, B, C], 3, 1, 1);

    await coord.write("banana");
    // AãŒæœ€é€Ÿã§è¿”äº‹ã™ã‚‹ã¨ã€Œå¤ã„å€¤ã€ã‚’è¿”ã—ã‚„ã™ã„
    await coord.read();
  }

  // ğŸ’¥ Case C: â€œå¼·ã„ã‘ã©è½ã¡ã‚„ã™ã„â€ (N=3, W=3, R=1)
  console.log("\n=== Case C: N=3 W=3 R=1 (very strict write) ===");
  {
    const A = new Replica("A", true, false, 30);
    const B = new Replica("B", true, false, 40);
    const C = new Replica("C", false, false, 50); // Cãƒ€ã‚¦ãƒ³
    const coord = new Coordinator([A, B, C], 3, 3, 1);

    try {
      await coord.write("choco");
    } catch (e) {
      console.log("ğŸ˜± write failed because W=3 needs all replicas");
    }
  }
}

main().catch((e) => console.error(e));
```

### â‘¢ å®Ÿè¡Œã™ã‚‹ğŸš€

```bash
npx tsx apps/sim/quorum.ts
```

---

## 16.6 ä½•ãŒâ€œä½“æ„Ÿâ€ã§ããŸï¼ŸğŸ‘€âœ¨ï¼ˆãƒ­ã‚°ã®èª­ã¿æ–¹ï¼‰

### âœ… Case Aï¼ˆW=2, R=2ï¼‰ï¼ã€Œå¤šæ•°æ±ºã§ä¸€è‡´ã‚’å–ã‚Šã«è¡Œãã€ğŸ—³ï¸âœ…

* æ›¸ãè¾¼ã¿ã¯ **2å°ã®OK**ãŒå¿…è¦ â†’ ã¡ã‚‡ã„é…ããªã‚‹ğŸ¢
* èª­ã¿å–ã‚Šã‚‚ **2å°ã®å›ç­”**ãŒå¿…è¦ â†’ ã¡ã‚‡ã„é…ããªã‚‹ğŸ¢
* ã§ã‚‚ã€**èª­ã¿æ›¸ãé›†åˆãŒé‡ãªã‚‹**ã®ã§ã€æœ€æ–°ã«å½“ãŸã‚Šã‚„ã™ã„ğŸ¤âœ¨ ([System Overflow][2])

### âš¡ Case Bï¼ˆW=1, R=1ï¼‰ï¼ã€Œé€Ÿã•å„ªå…ˆã€âš¡ğŸ˜†

* æ›¸ãè¾¼ã¿ãŒ **1å°OK**ã§æˆåŠŸ â†’ ã‚ã¡ã‚ƒé€Ÿã„âš¡
* èª­ã¿å–ã‚Šã‚‚ **1å°ã ã‘**ã§æ±ºã‚ã‚‹ â†’ ã‚ã¡ã‚ƒé€Ÿã„âš¡
* ã§ã‚‚ **ãã®1å°ãŒå¤ã„/åˆ†æ–­ä¸­**ã ã¨ã€**å¤ã„å€¤ã‚’èª­ã‚€**ã“ã¨ãŒã‚ã‚‹ğŸ˜µâ€ğŸ’«ğŸŒ€
  ï¼ˆCassandraã§ã‚‚ â€œONEã¯å¤ã„èª­ã¿å–ã‚Šã®ç¢ºç‡ãŒé«˜ã„ãŒå¯ç”¨æ€§ãŒé«˜ã„â€ ã¨ã„ã†è¶£æ—¨ã§èª¬æ˜ã•ã‚Œã‚‹ã‚ˆï¼‰([DataStax Documentation][3])

### ğŸ’¥ Case Cï¼ˆW=3ï¼‰ï¼ã€Œå…¨å“¡ä¸€è‡´ã€ğŸ§±ğŸ˜‡

* 1å°ã§ã‚‚è½ã¡ãŸã‚‰ **æ›¸ãè¾¼ã¿å¤±æ•—**ã—ã‚„ã™ã„ğŸ˜±
* å¼·ã„ã‘ã© **å¯ç”¨æ€§ãŒè½ã¡ã‚„ã™ã„**ï¼ˆCAPã®è‚Œæ„Ÿè¦šãƒã‚¤ãƒ³ãƒˆï¼ï¼‰âš–ï¸ğŸ’¥

---

## 16.7 ã€Œå¤šæ•°æ±ºã€ã£ã¦ã€ç¾å ´ã§ã¯ã©ã‚“ãªå½¢ã§å‡ºã¦ãã‚‹ï¼ŸğŸ¢ğŸ§©

### Cassandraç³»ï¼š`R + W > N` ã‚’â€œèª¿æ•´å¯èƒ½â€ã«ã™ã‚‹ç™ºæƒ³ğŸ› ï¸âœ¨

Cassandraã®è€ƒãˆæ–¹ã¨ã—ã¦ã€**Rã¨Wã‚’è¨­å®šã—ã¦ `R + W > N` ã‚’ç‹™ã†**ã¨ã„ã†èª¬æ˜ãŒå…¬å¼ã«ã‚ã‚‹ã‚ˆğŸ“˜ ([Apache Cassandra][1])

ã•ã‚‰ã« QUORUM ã®è¨ˆç®—ï¼ˆéåŠæ•°ï¼‰ã‚‚å…·ä½“çš„ã«æ›¸ã‹ã‚Œã¦ã‚‹ğŸ—³ï¸ ([DataStax Documentation][3])

### MongoDBç³»ï¼šã€Œmajorityï¼ˆéåŠæ•°ï¼‰ã€ã§â€œç¢ºå®šã—ãŸã‚‚ã®ã ã‘è¿”ã™â€ğŸ§·âœ…

MongoDBã® read concern `"majority"` ã¯ã€**éåŠæ•°ã§ç¢ºèªæ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ã ã‘è¿”ã™**è¶£æ—¨ã§èª¬æ˜ã•ã‚Œã¦ã‚‹ã‚ˆğŸ§¾ ([MongoDB][4])
ï¼ˆã¤ã¾ã‚Šã€Œå¤šæ•°æ±ºã§â€œç¢ºå®šâ€ã—ãŸã‚‚ã®ã€ã£ã¦æ„Ÿè¦šã«è¿‘ã„ğŸ˜Šï¼‰

---

## 16.8 ã‚ã‚ŠãŒã¡ãªå‹˜é•ã„ï¼†æ³¨æ„ç‚¹âš ï¸ğŸ˜µ

### å‹˜é•ã„â‘ ï¼šã‚¯ã‚©ãƒ¼ãƒ©ãƒ ï¼ã€Œå¿…ãšæœ€æ–°ãŒè¦‹ãˆã‚‹é­”æ³•ã€ã§ã¯ãªã„ğŸª„âŒ

`R + W > N` ã¯ â€œç›´æ„Ÿã®å¼·ã„é“å…·â€ ã ã‘ã©ã€ç¾å®Ÿã«ã¯

* é…å»¶â³
* åˆ†æ–­ğŸ”Œ
* åŒæ™‚æ›´æ–°âš”ï¸
  ãŒçµ¡ã‚€ã®ã§ã€**ç«¶åˆè§£æ±ºï¼ˆLWWã¨ã‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ã¨ã‹ï¼‰**ã‚‚å¿…è¦ã«ãªã‚‹ã‚ˆï¼ˆã“ã®æ•™æã®å¾ŒåŠã§ã‚„ã‚‹ã‚„ã¤ï¼ï¼‰ğŸ›ï¸ğŸ§ 

### å‹˜é•ã„â‘¡ï¼šã€Œå¤šæ•°æ±ºã€ï¼ã€Œåˆæ„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆRaft/Paxosï¼‰ã€ã ã¨æ€ã†ğŸ¤¯

ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã¯ã“ã“ã§ã¯ **â€œè¤‡è£½ã®èª­ã¿æ›¸ãç¥¨æ•°â€** ã®è©±ã€‚
ã€Œ1ã¤ã«æ±ºã‚ã‚‹åˆæ„ã€ãã®ã‚‚ã®ã¨ã¯åˆ¥ç‰©ã ã‚ˆï¼ˆæ··ãœãªã„ã®å¤§äº‹ï¼‰ğŸ§ âœ¨

### å‹˜é•ã„â‘¢ï¼šéåŠæ•°ã«ã™ã‚‹ã¨â€œçµ¶å¯¾ã«é€Ÿã„â€ã‚ã‘ã§ã‚‚ãªã„ğŸ¢

**é…ã„ãƒãƒ¼ãƒ‰ãŒæ··ã˜ã‚‹ã¨ã€Wã‚„RãŒæº€ãŸã›ãªãã¦å…¨ä½“ãŒå¼•ã£å¼µã‚‰ã‚Œã‚‹**ã“ã¨ãŒã‚ã‚‹ã‚ˆğŸ˜µâ€ğŸ’«
ï¼ˆã ã‹ã‚‰ã€Œã©ã“ã§ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã‚’ä½¿ã†ã‹ã€ã‚’é¸ã¶ã®ãŒè¨­è¨ˆï¼ï¼‰

---

## 16.9 ç·´ç¿’å•é¡Œï¼ˆN/R/Wã®çµ„ã¿åˆã‚ã›ï¼‰âœï¸ğŸ¤–âœ¨

### å•1ï¼šN=3 ã®ã¨ãã€ã€Œ`R + W > N` ã‚’æº€ãŸã™ã€çµ„ã¿åˆã‚ã›ã‚’3ã¤è¨€ã£ã¦ã­ğŸ§©

ãƒ’ãƒ³ãƒˆï¼š`R + W` ãŒ **4ä»¥ä¸Š**ãªã‚‰OKğŸ˜Š

**ç­”ãˆä¾‹**ï¼š

* R=2, W=2 âœ…
* R=1, W=3 âœ…
* R=3, W=1 âœ…

---

### å•2ï¼šN=5 ã®ã¨ãã€ã€ŒéåŠæ•°ï¼ˆmajorityï¼‰ã€ã¯ã„ãã¤ï¼ŸğŸ—³ï¸

**ç­”ãˆ**ï¼š3ï¼ˆã ã„ãŸã„ `floor(5/2)+1`ï¼‰âœ…
â€œéåŠæ•°â€ã®é›°å›²æ°—ã¯ Cassandra ã® QUORUM è¨ˆç®—ä¾‹ã§ã‚‚è¦‹ã‚Œã‚‹ã‚ˆğŸ“˜ ([DataStax Documentation][3])

---

### å•3ï¼šã€Œèª­ã¿å–ã‚Šã‚’é€Ÿãã—ãŸã„ã€ã‘ã©ã€Œå¤ã„èª­ã¿å–ã‚Šã¯æ¸›ã‚‰ã—ãŸã„ã€ğŸ¥ºğŸ’­

N=3ãªã‚‰ã€ã¾ãšè©¦ã™ãªã‚‰ã©ã‚Œï¼Ÿï¼ˆ1ã¤é¸ã¶ï¼‰

* A) R=1, W=1
* B) R=2, W=2
* C) R=3, W=3

**ãŠã™ã™ã‚**ï¼šB âœ…
é€Ÿã•ã¯è½ã¡ã‚‹ã‘ã©ã€**å¤šæ•°æ±ºã®äº¤å·®**ã§ã€Œå¤ã„èª­ã¿å–ã‚Šã€ã‚’æ¸›ã‚‰ã—ã‚„ã™ã„ğŸ¤âœ¨ ([System Overflow][2])

---

## 16.10 AIã®ä½¿ã„æ–¹ï¼ˆç·´ç¿’å•é¡Œã‚’é‡ç”£ï¼‰ğŸ¤–ğŸ“šâœ¨

AIã«ã¯ã€Œç­”ãˆã¤ãã®å°ãƒ†ã‚¹ãƒˆã€ã‚’ä½œã‚‰ã›ã‚‹ã®ãŒè¶…ä¾¿åˆ©ã ã‚ˆğŸ˜Š
ä¾‹ğŸ‘‡

```text
N/R/Wã®ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ç·´ç¿’å•é¡Œã‚’10å•ä½œã£ã¦ã€‚
æ¡ä»¶ï¼š
- N=3,5,7 ã‚’æ··ãœã‚‹
- ã€ŒR+W>N ã‚’æº€ãŸã™ã‹ï¼Ÿã€ã ã‘ã˜ã‚ƒãªãã€
  ã€Œå¯ç”¨æ€§ãŒè½ã¡ã‚„ã™ã„ã®ã¯ã©ã‚Œï¼Ÿã€ã‚‚æ··ãœã‚‹
- å„å•ã«â€œãªãœãã†ãªã‚‹ã‹â€ã‚’ä¸€è¨€ã§è§£èª¬ã—ã¦
```

---

## ã¾ã¨ã‚ğŸ“âœ¨

* ã‚¯ã‚©ãƒ¼ãƒ©ãƒ ã¯ **ã€Œä½•ç¥¨é›†ã¾ã£ãŸã‚‰æˆåŠŸï¼Ÿã€** ã§åˆ†æ•£ã®èª­ã¿æ›¸ãã‚’è¨­è¨ˆã™ã‚‹é“å…·ğŸ—³ï¸
* **`R + W > N`** ã¯ã€Œèª­ã¿å–ã‚Šé›†åˆã¨æ›¸ãè¾¼ã¿é›†åˆãŒé‡ãªã‚‹ã€ç›´æ„Ÿã®å¼ğŸ¤âœ¨ ([Apache Cassandra][1])
* éåŠæ•°ï¼ˆQUORUM / majorityï¼‰ã¯å®šç•ªã§ã€å®ŸDBã§ã‚‚æ™®é€šã«å‡ºã¦ãã‚‹ã‚ˆğŸ“˜ğŸ§¾ ([DataStax Documentation][3])

[1]: https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html "Dynamo | Apache Cassandra Documentation"
[2]: https://www.systemoverflow.com/learn/replication-consistency/consistency-models/quorum-based-tunable-consistency-the-rwn-formula "Quorum Based Tunable Consistency: The R+W>N Formula | Consistency Models - System Overflow"
[3]: https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/dml/dmlConfigConsistency.html "How is the consistency level configured?"
[4]: https://www.mongodb.com/ja-jp/docs/manual/reference/read-concern-majority/ "èª­ã¿å–ã‚Šä¿è¨¼ (read concern) \"éåŠæ•°\" - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ãƒãƒ‹ãƒ¥ã‚¢ãƒ« - MongoDB Docs"
