# ç¬¬22ç« ï¼š`package.json` ã®æœ€å°è¨­è¨ˆğŸ“¦ğŸ“

ã“ã®ç« ã¯ã€Œ**ã‚³ãƒãƒ³ãƒ‰ãŒè¿·å­ã«ãªã‚‰ãªã„è¨­è¨ˆ**ã€ã‚’ä½œã‚‹å›ã§ã™ğŸ˜†âœ¨
`package.json` ã¯ã€è¨€ã„æ›ãˆã‚‹ã¨ **â€œã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ“ä½œãƒ‘ãƒãƒ«ğŸ›ï¸â€**ã€‚
ã“ã“ãŒæ•´ã†ã¨ã€Docker/Compose ã‹ã‚‰ã‚‚ VS Code ã‹ã‚‰ã‚‚ CI ã‹ã‚‰ã‚‚ã€ãœã‚“ã¶åŒã˜åˆè¨€è‘‰ã§å‹•ãã¾ã™ğŸ”ğŸ’ª

---

#### ğŸ¯ ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«

* `npm run dev / build / start` ã®3ç‚¹ã‚»ãƒƒãƒˆã§ **æ“ä½œãŒå›ºå®š**ã§ãã‚‹ğŸ§­âœ¨
* ã€Œé–‹ç™ºã¯TSç›´å®Ÿè¡Œã€ã€Œæœ¬ç•ªã¯distã‚’nodeã§å®Ÿè¡Œã€ã¿ãŸã„ã« **å½¹å‰²ãŒåˆ†ã‹ã‚Œã‚‹**ğŸ­
* `compose.yml` ã® `command:` ã§ã‚‚è¿·ã‚ãªã„ï¼ˆ= ã©ã“ã‹ã‚‰èµ·å‹•ã—ã¦ã‚‚åŒã˜ï¼‰ğŸ³âœ…

---

## 1) æœ€å°è¨­è¨ˆã®â€œçµè«–â€ã¯ã“ã‚ŒğŸ§©

æœ€å°ã§å¼·ã„ã®ã¯ **ã“ã®3æœ¬æŸ±**ã§ã™ğŸ‘‡

* `dev`ï¼šé–‹ç™ºç”¨ï¼ˆç›£è¦–ã—ã¦å³ãƒªãƒ­ãƒ¼ãƒ‰ğŸ‘€ğŸ”ï¼‰
* `build`ï¼šé…å¸ƒãƒ»æœ¬ç•ªç”¨ã«ãƒ“ãƒ«ãƒ‰ï¼ˆ`dist/` ã‚’ä½œã‚‹ğŸ—ï¸ï¼‰
* `start`ï¼šæœ¬ç•ªå®Ÿè¡Œï¼ˆ`dist/` ã‚’ `node` ã§èµ·å‹•ğŸš€ï¼‰

ã“ã®å½¢ã«ã—ã¦ãŠã‘ã°ã€ãŸã„ã¦ã„ã®äººãŒä¸€ç™ºã§ç†è§£ã§ãã¾ã™ğŸ‘âœ¨
ï¼ˆ`npm` ã® scripts ã¯å…¬å¼ã«ã€Œä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã—ã¦ `npm run` ã§å®Ÿè¡Œã§ãã‚‹ã€ä»•çµ„ã¿ã¨ã—ã¦æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚([docs.npmjs.com][1])ï¼‰

---

## 2) â€œTSã‚’ãƒ©ã‚¯ã«å‹•ã‹ã™â€å‰æã®æœ€å° `package.json` ä¾‹ğŸ§ªâœ¨

ç¬¬21ç« ã§è§¦ã‚ŒãŸ **tsxãƒ«ãƒ¼ãƒˆï¼ˆé–‹ç™ºãŒé€Ÿã„ğŸ¥³ï¼‰** ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ã¨ã€ã“ã†ãªã‚Šã¾ã™ğŸ‘‡
ï¼ˆtsx ã® Watch mode ã¯ `tsx watch ./file.ts` ã§å†å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ğŸ‘€ğŸ” ([tsx][2])ï¼‰

```json
{
  "name": "node-ts-runtime-fixed",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "tsx watch src/index.ts",
    "build": "tsc -p tsconfig.json",
    "start": "node --enable-source-maps dist/index.js"
  },
  "devDependencies": {
    "tsx": "^4.21.0",
    "typescript": "^5.9.3"
  }
}
```

ãƒã‚¤ãƒ³ãƒˆè§£èª¬ğŸ‘‡âœ¨

* **`dev`**ï¼š`tsx watch` ã§ä¿å­˜ã®ãŸã³ã«å†å®Ÿè¡Œ â†’ é–‹ç™ºãŒæ°—æŒã¡ã„ã„ğŸ˜†
  ï¼ˆtsxå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® Watch mode è§£èª¬ã€‚([tsx][2])ï¼‰
* **`build`**ï¼š`tsc` ã§ `dist/` ã‚’ä½œã‚‹ï¼ˆ`outDir: "dist"` ã¯æ¬¡ç« ã§æ•´ãˆã‚Œã°OKğŸ‘Œï¼‰
* **`start`**ï¼š`node dist/...` ã§ â€œãƒ“ãƒ«ãƒ‰æ¸ˆã¿â€ ã‚’å‹•ã‹ã™ï¼ˆæœ¬ç•ªã®å½¢ï¼‰ğŸš€
  ã•ã‚‰ã« `--enable-source-maps` ã‚’ä»˜ã‘ã‚‹ã¨ã€TSã®è¡Œç•ªå·ã§è¿½ã„ã‚„ã™ããªã‚Šã¾ã™ğŸ•µï¸â€â™‚ï¸âœ¨ï¼ˆNodeã®èµ·å‹•ãƒ•ãƒ©ã‚°ä¾‹ã¨ã—ã¦åºƒãæ¡ˆå†…ã•ã‚Œã¦ã„ã¾ã™ã€‚([Stack Overflow][3])ï¼‰

> `typescript` ã® â€œLatestâ€ ãŒ 5.9.3 ã¨ã—ã¦æ¡ˆå†…ã•ã‚Œã¦ã„ã‚‹ã®ã‚‚ç¢ºèªæ¸ˆã¿ã§ã™ã€‚([npm][4])
> ï¼ˆTypeScript 5.9 ã®å…¬å¼ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚‚ã‚ã‚Šã¾ã™ã€‚([TypeScript][5])ï¼‰

---

## 3) ã‚ˆãã‚ã‚‹ã€Œæœ€å°ã®ç½ ã€3ã¤ğŸ’£ï¼ˆã“ã“ã ã‘é¿ã‘ã‚Œã°å‹ã¡ï¼‰

### ç½ â‘ ï¼š`start` ãŒ â€œé–‹ç™ºç”¨â€ ã«ãªã£ã¦ã—ã¾ã†ğŸ˜µ

`start` ã¯ **æœ¬ç•ªèµ·å‹•ã®åˆè¨€è‘‰**ã«ã—ã¦ãŠãã®ãŒè¶…ãŠã™ã™ã‚ã§ã™ğŸ‘
é–‹ç™ºã¯ `dev`ã€æœ¬ç•ªã¯ `start` ã«åˆ†ã‘ã‚‹ã¨ã€æœªæ¥ã®è‡ªåˆ†ãŒåŠ©ã‹ã‚Šã¾ã™ğŸ›Ÿâœ¨

---

### ç½ â‘¡ï¼šWindowsã§ scripts ãŒå‹•ã‹ãªã„ï¼ˆ`rm -rf` å•é¡Œï¼‰ğŸªŸâš ï¸

scripts ã«ã“ã‚“ãªã®å…¥ã‚Œã‚‹ã¨ğŸ‘‡

* `rm -rf dist`
* `export NODE_ENV=production`

Windowsã ã¨æ­»ã«ãŒã¡ã§ã™ğŸ’€
ã“ã®ç« ã§ã¯ã€Œæœ€å°ã€ã«çµã£ã¦ã€**OSä¾å­˜ã‚³ãƒãƒ³ãƒ‰ã¯æ¥µåŠ›å…¥ã‚Œãªã„**ã®ãŒå®‰å…¨ã§ã™ğŸ‘Œâœ¨
ï¼ˆã©ã†ã—ã¦ã‚‚ã‚„ã‚‹ãªã‚‰ã€å¾Œã§ `rimraf` ã‚„ `cross-env` ã‚’è¶³ã™ã®ãŒç‹é“ã§ã™ğŸ§°ï¼‰

---

### ç½ â‘¢ï¼š`tsx` ã¯ â€œå‹ãƒã‚§ãƒƒã‚¯ã—ãªã„â€ ã®ã§ä¸å®‰ã«ãªã‚‹ğŸ˜°

å¤§ä¸ˆå¤«ã§ã™ğŸ˜†âœ¨
`tsx` ã¯é–‹ç™ºä½“é¨“ã‚’é€Ÿãã™ã‚‹æ–¹å‘ã§ã€å‹ãƒã‚§ãƒƒã‚¯ã¯ IDE ã‚„åˆ¥ã‚³ãƒãƒ³ãƒ‰ã«ä»»ã›ã‚‹è¨­è¨ˆã§ã™ï¼ˆtsxå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€Œå‹ã‚¨ãƒ©ãƒ¼ã«ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œãšå®Ÿè¡Œã§ãã‚‹ã€è¶£æ—¨ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚([tsx][6])ï¼‰

ãªã®ã§ã€æœ€å°æ§‹æˆã§ã¯æ¬¡ã‚’è¶³ã™ã¨å®‰å¿ƒæ„ŸãŒçˆ†ä¸ŠãŒã‚ŠğŸ‘‡

```json
{
  "scripts": {
    "typecheck": "tsc --noEmit"
  }
}
```

> ã“ã‚Œã§ã€Œå®Ÿè¡Œã¯é€Ÿã„ã€ã€Œå‹ã¯åˆ¥ã§å®ˆã‚‹ã€ã«ãªã£ã¦å¼·ã„ã§ã™ğŸ›¡ï¸âœ¨

---

## 4) scripts ã®å‘½åãƒ«ãƒ¼ãƒ«ï¼ˆè¿·å­ã‚¼ãƒ­ã®å‹ï¼‰ğŸ§ ğŸ§­

### âœ… åŸºæœ¬3ã¤ã¯å›ºå®šã§è¦šãˆã‚‹

* `dev`
* `build`
* `start`ï¼ˆ`npm start` ã§èµ·å‹•ã§ãã‚‹ã®ã‚‚ä¾¿åˆ©âœ¨ï¼‰

### âœ… å¢—ã‚„ã™æ™‚ã¯ `:` ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°

* `build:prod`
* `test:unit`
* `db:migrate`

ã“ã†ã™ã‚‹ã¨ä¸€è¦§ãŒè¦‹ã‚„ã™ã„ã§ã™ğŸ‘€âœ¨

---

## 5) â€œè‡ªå‹•ã§å‰å¾Œã«æŒŸã‚€â€å°æŠ€ï¼š`pre` / `post` ğŸª„

npm scripts ã¯ã€`preX` / `postX` ã‚’ç½®ãã¨ **è‡ªå‹•ã§å‰å¾Œã«èµ°ã‚‹**ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã™ğŸ”âœ¨ ([docs.npmjs.com][1])

ä¾‹ï¼š`build` ã®å‰ã«å‹ãƒã‚§ãƒƒã‚¯ã‚’å¿…ãšèµ°ã‚‰ã›ãŸã„ğŸ‘‡

```json
{
  "scripts": {
    "prebuild": "npm run typecheck",
    "build": "tsc -p tsconfig.json",
    "typecheck": "tsc --noEmit"
  }
}
```

* `npm run build` ã™ã‚‹ã¨
  âœ… `prebuild` â†’ âœ… `build` ã®é †ã§èµ°ã‚Šã¾ã™ğŸ¬âœ¨ ([docs.npmjs.com][1])

---

## 6) å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ğŸ§ª

æœ€å¾Œã«ã€ã“ã‚Œã ã‘ç¢ºèªã™ã‚Œã°OKã§ã™ğŸ‘‡

1. `npm run`ï¼ˆscriptsä¸€è¦§ãŒå‡ºã‚‹ğŸ‘€ï¼‰([docs.npmjs.com][1])
2. `npm run dev`ï¼ˆä¿å­˜ã§å†èµ·å‹•ã™ã‚‹ğŸ‘€ğŸ”ï¼‰([tsx][2])
3. `npm run build`ï¼ˆ`dist/` ãŒã§ãã‚‹ğŸ—ï¸ï¼‰
4. `npm start`ï¼ˆ`dist/` ãŒèµ·å‹•ã™ã‚‹ğŸš€ï¼‰

---

## ã¾ã¨ã‚ğŸâœ¨

ã“ã®ç« ã®æœ€é‡è¦ãƒã‚¤ãƒ³ãƒˆã¯ã‚³ãƒ¬ã§ã™ğŸ‘‡

* **`dev/build/start` ã®3ç‚¹ã‚»ãƒƒãƒˆ**ãŒ â€œæœ€å°ã§å¼·ã„â€ğŸ“¦ğŸ’ª
* é–‹ç™ºã¯ `tsx watch` ã§çˆ†é€ŸğŸ‘€ğŸ” ([tsx][2])
* æœ¬ç•ªã¯ `node dist/...`ï¼ˆ+ source maps ã§ãƒ‡ãƒãƒƒã‚°å¿«é©ï¼‰ğŸ•µï¸â€â™‚ï¸âœ¨ ([Stack Overflow][3])
* `prebuild` ãªã©ã®ãƒ•ãƒƒã‚¯ã§ã€ŒãƒŸã‚¹ã—ãªã„æµã‚Œã€ã‚’ä½œã‚Œã‚‹ğŸª„ ([docs.npmjs.com][1])

---

æ¬¡ã®ç¬¬23ç« ã§ã¯ã€ã“ã® `build` ã‚’å—ã‘å–ã‚‹å´ã® **`tsconfig.json` ã‚’â€œè–„ããƒ»å®‰å…¨ã«â€** æ•´ãˆã¦ã€`dist/` ã‚’ã¡ã‚ƒã‚“ã¨ä½œã‚Œã‚‹çŠ¶æ…‹ã«ã—ã¾ã™ğŸ§Šâ¡ï¸ğŸ§ âœ¨

[1]: https://docs.npmjs.com/cli/v10/using-npm/scripts/?utm_source=chatgpt.com "scripts"
[2]: https://tsx.is/watch-mode?utm_source=chatgpt.com "Watch mode"
[3]: https://stackoverflow.com/questions/53265182/how-to-use-source-maps-in-node-js?utm_source=chatgpt.com "How to use source maps in node js?"
[4]: https://www.npmjs.com/package/typescript?activeTab=versions&utm_source=chatgpt.com "typescript"
[5]: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-9.html?utm_source=chatgpt.com "Documentation - TypeScript 5.9"
[6]: https://tsx.is/typescript?utm_source=chatgpt.com "TypeScript"
