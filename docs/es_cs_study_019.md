# ç¬¬19ç« ï¼šãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè£…â‘¡ï¼ˆæ›´æ–°ç³»ï¼‰ğŸ”§âœ¨

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ ğŸ¯ğŸ’¡

æ›´æ–°ï¼ˆ= æ—¢ã«å­˜åœ¨ã™ã‚‹é›†ç´„ã®çŠ¶æ…‹ã‚’å¤‰ãˆã‚‹ï¼‰ã‚’ã€**ã‚³ãƒãƒ³ãƒ‰ â†’ æ–°ã‚¤ãƒ™ãƒ³ãƒˆ**ã¨ã—ã¦ãã‚Œã„ã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ğŸ˜Šâœ¨
ã“ã®ç« ã§ã¯ã€Œæ›´æ–°ã®ä»£è¡¨æ ¼ã€ã‚’2ã€œ3å€‹ã¤ãã£ã¦ã€**æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã®ç²’åº¦**ã‚‚ä½“ã§è¦šãˆã¾ã™ğŸ§ âš–ï¸

---

# 1. æ›´æ–°ç³»ã£ã¦ãªã«ãŒé›£ã—ã„ã®ï¼ŸğŸ˜µâ€ğŸ’«â¡ï¸ğŸ˜Š

æ›´æ–°ç³»ãŒé›£ã—ãæ„Ÿã˜ã‚‹ç†ç”±ã¯ã ã„ãŸã„ã“ã®3ã¤ğŸ‘‡

1. **åŒã˜æ›´æ–°ã§ã‚‚ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šã„**ï¼ˆè¿½åŠ ãƒ»å‰Šé™¤ãƒ»æ•°é‡å¤‰æ›´ãƒ»å±æ€§å¤‰æ›´â€¦ï¼‰ğŸ§©
2. **ã‚¤ãƒ™ãƒ³ãƒˆåãŒãƒ–ãƒ¬ã‚„ã™ã„**ï¼ˆã§ã‹ã™ããƒ»ç´°ã‹ã™ãå•é¡Œï¼‰âš–ï¸
3. **ä¸å¤‰æ¡ä»¶ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ã‚’ã©ã“ã§å®ˆã‚‹ã‹è¿·ã†**ğŸ›¡ï¸

ã§ã‚‚å®‰å¿ƒã—ã¦ã­ğŸŒ¸
# ç¬¬16ç« ã®å‹ï¼ˆLoad â†’ Decide â†’ Appendï¼‰ã‚’ãã®ã¾ã¾ä½¿ãˆã°ã€æ›´æ–°ã‚‚ã‚­ãƒ¬ã‚¤ã«ãƒãƒã‚Šã¾ã™âœ…

---

## 2. ä»Šå›ã®é¡Œæï¼ˆä¾‹ï¼‰ï¼šã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆğŸ›’âœ¨

ç¬¬18ç« ã§ã€Œä½œæˆç³»ï¼ˆCartCreatedï¼‰ã€ã‚’ã‚„ã£ãŸå‰æã§ã€æ›´æ–°ç³»ã‚’è¶³ã—ã¾ã™ğŸ˜Š
ã“ã“ã§ã¯æ›´æ–°ã‚³ãƒãƒ³ãƒ‰ã‚’2ã¤ï¼ˆï¼‹ãŠã¾ã‘1ã¤ï¼‰ã¤ãã‚‹ã‚ˆğŸ‘‡

* âœ… **AddItem**ï¼šå•†å“ã‚’è¿½åŠ ã™ã‚‹ â•ğŸ“¦
* âœ… **ChangeQuantity**ï¼šæ•°é‡ã‚’å¤‰æ›´ã™ã‚‹ ğŸ”¢ğŸ”
* â­ï¼ˆãŠã¾ã‘ï¼‰**RemoveItem**ï¼šå•†å“ã‚’å‰Šé™¤ã™ã‚‹ ğŸ—‘ï¸

---

## 3. æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­è¨ˆï¼ˆã¾ãšã“ã“ãŒå‘½ï¼ï¼‰ğŸ§ ğŸ”¥

### 3.1 ã‚¤ãƒ™ãƒ³ãƒˆå‘½åï¼ˆéå»å½¢ï¼‰â³âœ…

ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€Œã‚„ã£ãŸã“ã¨ï¼ˆäº‹å®Ÿï¼‰ã€ãªã®ã§ã€**éå»å½¢**ãŒåŸºæœ¬âœ¨

* `ItemAddedToCart`ï¼ˆã‚«ãƒ¼ãƒˆã«å•†å“ãŒè¿½åŠ ã•ã‚ŒãŸï¼‰
* `ItemQuantityChanged`ï¼ˆæ•°é‡ãŒå¤‰æ›´ã•ã‚ŒãŸï¼‰
* `ItemRemovedFromCart`ï¼ˆå•†å“ãŒå‰Šé™¤ã•ã‚ŒãŸï¼‰

### 3.2 ç²’åº¦ï¼ˆã§ã‹ã™ã vs ã¡ã‚‡ã†ã©ã„ã„ï¼‰âš–ï¸ğŸ‘€

ã‚ã‚ŠãŒã¡ãªNGğŸ‘‡

* âŒ `CartUpdated`ï¼ˆã§ã‹ã™ãã¦ã€ä½•ãŒèµ·ããŸã‹åˆ†ã‹ã‚‰ãªã„ğŸ˜‡ï¼‰
* âŒ `CartItemQuantityIncrementedBy1`ï¼ˆç´°ã‹ã™ãã¦ã‚¤ãƒ™ãƒ³ãƒˆçˆ†ç™ºğŸ˜µï¼‰

ãŠã™ã™ã‚ã¯ã€Œç”»é¢ã®æ“ä½œã€ã˜ã‚ƒãªãã¦ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ„å‘³ã€ã§åˆ‡ã‚‹ã“ã¨ğŸ˜Šâœ¨
ä¾‹ï¼šæ•°é‡å¤‰æ›´ã¯ã€Œ+1ã€ã€Œ-1ã€ã§ã¯ãªãã€Œ**æ•°é‡ãŒXã«ãªã£ãŸ**ã€ã®æ–¹ãŒå¾Œã€…ãƒ©ã‚¯ãªã“ã¨ãŒå¤šã„ã‚ˆğŸ”§

---

## 4. ä¸å¤‰æ¡ä»¶ï¼ˆæ›´æ–°ç³»ã®å®ˆã‚Šã©ã“ã‚ï¼‰ğŸ›¡ï¸ğŸ§·

ã“ã®ç« ã®ã‚«ãƒ¼ãƒˆä¾‹ã§ã€æœ€ä½é™ã®ãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã‚ˆã†ğŸ‘‡ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§OKï¼ï¼‰

* æ•°é‡ã¯ **1ä»¥ä¸Š**ï¼ˆ0ã‚„ãƒã‚¤ãƒŠã‚¹ã¯ç¦æ­¢ï¼‰ğŸ™…â€â™€ï¸
* è¿½åŠ ã™ã‚‹SKUã¯ç©ºæ–‡å­—ç¦æ­¢ğŸ™…â€â™€ï¸
* å¤‰æ›´å¯¾è±¡ã®å•†å“ãŒå­˜åœ¨ã—ãªã„ãªã‚‰å¤‰æ›´ã§ããªã„ğŸ™…â€â™€ï¸
* ï¼ˆãŠã¾ã‘ï¼‰å‰Šé™¤å¯¾è±¡ãŒå­˜åœ¨ã—ãªã„ãªã‚‰å‰Šé™¤ã§ããªã„ğŸ™…â€â™€ï¸

ã“ã®ãƒ«ãƒ¼ãƒ«ã¯ **Decideã®ä¸­ã§å¼¾ã** ã®ãŒåŸºæœ¬ã ã‚ˆâœ…

---

## 5. å®Ÿè£…ï¼šDomainï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒ»ã‚³ãƒãƒ³ãƒ‰ãƒ»é›†ç´„ï¼‰ğŸ§±âœ¨

ã“ã“ã‹ã‚‰ã¯ã€Œãã®ã¾ã¾è²¼ã£ã¦å‹•ãã€å¯„ã‚Šã®ã‚µãƒ³ãƒ—ãƒ«ã§ã„ãã¾ã™ğŸ˜Š
ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã¯ç¬¬13ã€œ17ç« ã®æœ€å°å®Ÿè£…ã‚’ä½¿ã†æƒ³å®šğŸ“¦ï¼‰

### 5.1 ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾© ğŸ“œâœ¨

```csharp
public interface IDomainEvent;

public sealed record CartCreated(Guid CartId) : IDomainEvent;

public sealed record ItemAddedToCart(Guid CartId, string Sku, int Quantity) : IDomainEvent;

public sealed record ItemQuantityChanged(Guid CartId, string Sku, int NewQuantity) : IDomainEvent;

public sealed record ItemRemovedFromCart(Guid CartId, string Sku) : IDomainEvent;
```

ãƒã‚¤ãƒ³ãƒˆğŸ’¡

* æ›´æ–°ç³»ã¯ã€Œå·®åˆ†ã€ã‚’å…¥ã‚Œã‚‹ã‹ã€Œçµæœï¼ˆNewQuantityï¼‰ã€ã‚’å…¥ã‚Œã‚‹ã‹è¿·ã†ã‘ã©ã€åˆå¿ƒè€…ã‚³ãƒ¼ã‚¹ã§ã¯ **çµæœï¼ˆNewQuantityï¼‰**ãŒãŠã™ã™ã‚ğŸ˜Š

  * ãƒªãƒ—ãƒ¬ã‚¤ã—ã¦ã‚‚ãƒ–ãƒ¬ãªã„âœ…
  * é€”ä¸­ã®è¨ˆç®—ãŒæ¸›ã‚‹âœ…

---

### 5.2 ã‚³ãƒãƒ³ãƒ‰å®šç¾© ğŸ“®âœ¨

```csharp
public interface ICommand;

public sealed record CreateCart(Guid CartId) : ICommand;

public sealed record AddItem(Guid CartId, string Sku, int Quantity) : ICommand;

public sealed record ChangeQuantity(Guid CartId, string Sku, int NewQuantity) : ICommand;

public sealed record RemoveItem(Guid CartId, string Sku) : ICommand;
```

---

### 5.3 é›†ç´„ï¼ˆCart Aggregateï¼‰ğŸ§ºâœ¨

```csharp
public sealed class Cart
{
    private readonly Dictionary<string, int> _items = new();

    public Guid Id { get; private set; }
    public bool IsCreated { get; private set; }

    // Rehydrate ç”¨ï¼ˆå¤–ã‹ã‚‰ new ã•ã›ãªã„ï¼‰
    private Cart() { }

    public static Cart Rehydrate(IEnumerable<IDomainEvent> history)
    {
        var cart = new Cart();
        foreach (var e in history)
        {
            cart.Apply(e);
        }
        return cart;
    }

    // Decideï¼šã‚³ãƒãƒ³ãƒ‰ -> æ–°ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã“ã“ã§ä¸å¤‰æ¡ä»¶ã‚’å®ˆã‚‹ï¼‰
    public IReadOnlyList<IDomainEvent> Decide(ICommand command) =>
        command switch
        {
            CreateCart c        => DecideCreate(c),
            AddItem c           => DecideAddItem(c),
            ChangeQuantity c    => DecideChangeQuantity(c),
            RemoveItem c        => DecideRemoveItem(c),
            _ => throw new NotSupportedException($"Unknown command: {command.GetType().Name}")
        };

    private IReadOnlyList<IDomainEvent> DecideCreate(CreateCart c)
    {
        if (IsCreated) throw new InvalidOperationException("Cart is already created.");
        if (c.CartId == Guid.Empty) throw new InvalidOperationException("CartId is required.");

        return new IDomainEvent[]
        {
            new CartCreated(c.CartId)
        };
    }

    private IReadOnlyList<IDomainEvent> DecideAddItem(AddItem c)
    {
        EnsureCreated();
        EnsureSku(c.Sku);
        if (c.Quantity <= 0) throw new InvalidOperationException("Quantity must be >= 1.");

        // ã“ã“ã¯æ–¹é‡ãŒ2ã¤ã‚ã‚‹ã‚ˆğŸ‘‡
        // A) åŒã˜SKUãªã‚‰ã€Œè¿½åŠ ã€ã˜ã‚ƒãªãã€Œæ•°é‡å¤‰æ›´ã€ã«çµ±ä¸€ã™ã‚‹
        // B) è¿½åŠ ã¯è¿½åŠ ã€å¤‰æ›´ã¯å¤‰æ›´ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†ã‘ã‚‹ï¼‰
        // ä»Šå›ã¯åˆ†ã‹ã‚Šã‚„ã™ã•å„ªå…ˆã§ B ã«ã™ã‚‹ğŸ˜Š

        return new IDomainEvent[]
        {
            new ItemAddedToCart(Id, c.Sku, c.Quantity)
        };
    }

    private IReadOnlyList<IDomainEvent> DecideChangeQuantity(ChangeQuantity c)
    {
        EnsureCreated();
        EnsureSku(c.Sku);
        if (c.NewQuantity <= 0) throw new InvalidOperationException("NewQuantity must be >= 1.");

        if (!_items.ContainsKey(c.Sku))
            throw new InvalidOperationException("Item does not exist in cart.");

        return new IDomainEvent[]
        {
            new ItemQuantityChanged(Id, c.Sku, c.NewQuantity)
        };
    }

    private IReadOnlyList<IDomainEvent> DecideRemoveItem(RemoveItem c)
    {
        EnsureCreated();
        EnsureSku(c.Sku);

        if (!_items.ContainsKey(c.Sku))
            throw new InvalidOperationException("Item does not exist in cart.");

        return new IDomainEvent[]
        {
            new ItemRemovedFromCart(Id, c.Sku)
        };
    }

    // Applyï¼šã‚¤ãƒ™ãƒ³ãƒˆ -> çŠ¶æ…‹æ›´æ–°ï¼ˆã“ã“ã¯ãƒ«ãƒ¼ãƒ«åˆ¤å®šã—ãªã„ï¼‰
    private void Apply(IDomainEvent e)
    {
        switch (e)
        {
            case CartCreated x:
                Id = x.CartId;
                IsCreated = true;
                break;

            case ItemAddedToCart x:
                if (_items.TryGetValue(x.Sku, out var current))
                    _items[x.Sku] = current + x.Quantity;
                else
                    _items[x.Sku] = x.Quantity;
                break;

            case ItemQuantityChanged x:
                _items[x.Sku] = x.NewQuantity;
                break;

            case ItemRemovedFromCart x:
                _items.Remove(x.Sku);
                break;

            default:
                throw new NotSupportedException($"Unknown event: {e.GetType().Name}");
        }
    }

    private void EnsureCreated()
    {
        if (!IsCreated) throw new InvalidOperationException("Cart is not created.");
    }

    private static void EnsureSku(string sku)
    {
        if (string.IsNullOrWhiteSpace(sku))
            throw new InvalidOperationException("Sku is required.");
    }

    // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆçŠ¶æ…‹ã‚’è¦‹ãŸã„ã¨ãä¾¿åˆ©ğŸ˜Šï¼‰
    public IReadOnlyDictionary<string, int> GetItems() => _items;
}
```

ã“ã“å¤§äº‹ğŸ˜Šâœ¨

* **Decide**ï¼šä¸å¤‰æ¡ä»¶ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ã‚’å®ˆã‚‹å ´æ‰€ğŸ›¡ï¸
* **Apply**ï¼šã‚¤ãƒ™ãƒ³ãƒˆã‚’çŠ¶æ…‹ã«åæ˜ ã™ã‚‹ã ã‘ï¼ˆåˆ¤å®šã¯ã—ãªã„ï¼‰ğŸ”

---

## 6. å®Ÿè£…ï¼šApplicationï¼ˆãƒãƒ³ãƒ‰ãƒ©ï¼‰ğŸ“®â¡ï¸ğŸ“¦

ç¬¬16ç« ã®å‹ã‚’ãã®ã¾ã¾ä½¿ã†ã‚ˆâœ…
ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢å´ã¯ã€ŒReadStreamã€ã€ŒAppend(streamId, expectedVersion, events)ã€ãŒã‚ã‚‹æƒ³å®šğŸ“¦

```csharp
public sealed class CartCommandHandler
{
    private readonly IEventStore _store;

    public CartCommandHandler(IEventStore store)
    {
        _store = store;
    }

    public void Handle(ICommand command)
    {
        var cartId = command switch
        {
            CreateCart c => c.CartId,
            AddItem c => c.CartId,
            ChangeQuantity c => c.CartId,
            RemoveItem c => c.CartId,
            _ => throw new NotSupportedException()
        };

        var streamId = $"cart-{cartId:N}";

        var history = _store.ReadStream(streamId); // IEnumerable<IDomainEvent>
        var cart = Cart.Rehydrate(history);

        var newEvents = cart.Decide(command);

        var expectedVersion = history.Count(); // â€»ç¬¬14ç« ã®versionç®¡ç†ã®å½¢ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦OK
        _store.Append(streamId, expectedVersion, newEvents);
    }
}
```

â€» `history.Count()` ã¯ IEnumerable ã‚’2å›ãªã‚ãŒã¡ãªã®ã§ã€å®Ÿå‹™ãªã‚‰ List ã«ã—ã¦ã‹ã‚‰ä½¿ã†ã®ãŒå®‰å…¨ã ã‚ˆğŸ˜Šï¼ˆã“ã®ç« ã§ã¯åˆ†ã‹ã‚Šã‚„ã™ã•å„ªå…ˆâœ¨ï¼‰

---

## 7. ãƒŸãƒ‹æ¼”ç¿’ï¼ˆæ›´æ–°ã‚³ãƒãƒ³ãƒ‰2ã¤ã‚’é€šã™ï¼‰ğŸ§ªâœ¨

### æ¼”ç¿’Aï¼šAddItemã‚’é€šã™â•ğŸ“¦

1. `CreateCart` ã™ã‚‹
2. `AddItem(SKU="APPLE", Quantity=2)` ã‚’æŠ•ã’ã‚‹
3. ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’èª­ã‚“ã§ã€æœ€å¾Œã« `ItemAddedToCart` ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªâœ…

### æ¼”ç¿’Bï¼šChangeQuantityã‚’é€šã™ğŸ”¢ğŸ”

1. ã™ã§ã« `APPLE` ãŒå…¥ã£ã¦ã„ã‚‹çŠ¶æ…‹ã‹ã‚‰
2. `ChangeQuantity(SKU="APPLE", NewQuantity=5)` ã‚’æŠ•ã’ã‚‹
3. `ItemQuantityChanged` ãŒç©ã¾ã‚Œã‚‹ã‹ç¢ºèªâœ…

### æ¼”ç¿’Cï¼šå¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œã‚‹ğŸ™…â€â™€ï¸ğŸ’¥

* `NewQuantity=0` ã‚’æŠ•ã’ã¦ã€ã¡ã‚ƒã‚“ã¨å¼¾ã‹ã‚Œã‚‹ã‹ç¢ºèª
* å­˜åœ¨ã—ãªã„SKUã‚’å¤‰æ›´ã—ã¦å¼¾ã‹ã‚Œã‚‹ã‹ç¢ºèª

---

## 8. â€œæ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã®ç²’åº¦è¨ºæ–­â€ ãƒŸãƒ‹ãƒã‚§ãƒƒã‚¯âš–ï¸ğŸ”

æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œã£ãŸã‚‰ã€ã“ã‚Œã‚’è‡ªåˆ†ã«è³ªå•ã—ã¦ã¿ã¦ã­ğŸ˜Š

* ã€Œ**ä½•ãŒèµ·ããŸã‹**ã€ã‚¤ãƒ™ãƒ³ãƒˆåã ã‘ã§åˆ†ã‹ã‚‹ï¼Ÿã€ğŸ‘€
* ã€Œå¾Œã‹ã‚‰è¦‹ãŸäººãŒã€**ãªãœã“ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒå¿…è¦ã‹**èª¬æ˜ã§ãã‚‹ï¼Ÿã€ğŸ—£ï¸
* ã€Œå°†æ¥ â€œç›£æŸ»ãƒ­ã‚°â€ ã«ä¸¦ã‚“ã æ™‚ã«ã€**äººé–“ãŒèª­ã‚ã‚‹ï¼Ÿ**ã€ğŸ“œ
* ã€Œ`CartUpdated` ã¿ãŸã„ã«â€œä¾¿åˆ©ãã†ã§æ„å‘³ãŒè–„ã„â€ã‚¤ãƒ™ãƒ³ãƒˆã«ãªã£ã¦ãªã„ï¼Ÿã€ğŸ˜‡

---

## 9. AIæ´»ç”¨ï¼ˆCopilot / Codexï¼‰ğŸ¤–âœ¨

### 9.1 ã¾ãšã¯ã‚¤ãƒ™ãƒ³ãƒˆæ¡ˆã‚’å‡ºã—ã¦ã‚‚ã‚‰ã†ğŸ§ ğŸ’¬

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ‘‡ï¼ˆãã®ã¾ã¾è²¼ã£ã¦OKï¼‰

```text
ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã‚’å­¦ç¿’ä¸­ã§ã™ã€‚
æ›´æ–°ç³»ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã€Œå•†å“è¿½åŠ ã€ã€Œæ•°é‡å¤‰æ›´ã€ã€Œå•†å“å‰Šé™¤ã€ã‚’å®Ÿè£…ã—ãŸã„ã§ã™ã€‚

æ¡ä»¶:
- ã‚¤ãƒ™ãƒ³ãƒˆåã¯éå»å½¢ã§ã€ä½•ãŒèµ·ããŸã‹åˆ†ã‹ã‚‹ã“ã¨
- payloadã¯æœ€å°é™ï¼ˆå…¥ã‚Œã™ããªã„ï¼‰
- ä¸å¤‰æ¡ä»¶ï¼ˆæ•°é‡ã¯1ä»¥ä¸Šã€SKUç©ºã¯ç¦æ­¢ã€å­˜åœ¨ã—ãªã„å•†å“ã¯å¤‰æ›´/å‰Šé™¤ã§ããªã„ï¼‰ã‚’å®ˆã‚‹

ææ¡ˆã—ã¦:
1) ã‚³ãƒãƒ³ãƒ‰å
2) ã‚¤ãƒ™ãƒ³ãƒˆå
3) ãã‚Œãã‚Œã®payloadè¨­è¨ˆ
4) ç²’åº¦ãŒã§ã‹ã™ã/ç´°ã‹ã™ãã®NGä¾‹ã‚‚
```

### 9.2 å‡ºã¦ããŸæ¡ˆã®â€œæ‰‹ç›´ã—ãƒã‚¤ãƒ³ãƒˆâ€âœï¸âœ¨

AIãŒã‚ˆãã‚„ã‚ŠãŒã¡ğŸ‘‡

* payloadã« **ç”»é¢è¡¨ç¤ºç”¨ã®æƒ…å ±** ã‚’å…¥ã‚Œã‚ˆã†ã¨ã™ã‚‹ï¼ˆã‚„ã‚Šã™ãğŸ±ğŸ’¦ï¼‰
* `CartUpdated` ã¿ãŸã„ãª **ä¸‡èƒ½ã‚¤ãƒ™ãƒ³ãƒˆ** ã‚’ä½œã‚ŠãŸãŒã‚‹ï¼ˆå±é™ºâš ï¸ï¼‰

ã ã‹ã‚‰ã€æœ€å¾Œã¯ã‚ãªãŸãŒã“ã®æ–¹é‡ã§æ•´ãˆã‚‹ã¨å‹ã¡ğŸ˜Š

* ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³çš„ã«æ„å‘³ãŒã‚ã‚‹ï¼Ÿã€
* ã€Œå¾Œã‹ã‚‰èª­ã‚ã‚‹ï¼Ÿã€
* ã€ŒApplyãŒå˜ç´”ï¼Ÿã€

---

## 10. ã¾ã¨ã‚ï¼ˆã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ç¢ºèªï¼‰âœ…ğŸ‰

ã“ã®ç« ã§æŠ¼ã•ãˆãŸã“ã¨ğŸ‘‡

* æ›´æ–°ç³»ã‚‚ **Load â†’ Decide â†’ Append** ã®å‹ã§è¿·å­ã«ãªã‚‰ãªã„ğŸ“®âœ…
* **Decideã§ä¸å¤‰æ¡ä»¶**ã€**Applyã§çŠ¶æ…‹æ›´æ–°** ã‚’å¾¹åº•ğŸ›¡ï¸ğŸ”
* æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€Œæ„å‘³ãŒåˆ†ã‹ã‚‹åå‰ã€ã¨ã€Œã¡ã‚‡ã†ã©ã„ã„ç²’åº¦ã€âš–ï¸âœ¨

æ¬¡ç« ï¼ˆç¬¬20ç« ï¼‰ã§ã¯ã€ã“ã®æ›´æ–°ã‚‚å«ã‚ã¦ **Given-When-Then** ã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€Œæ€–ããªã„ã€çŠ¶æ…‹ã«ã—ã¦ã„ãã‚ˆğŸ§ªğŸŒ¸

---

### å‚è€ƒï¼ˆ2026å¹´æ™‚ç‚¹ã®é–‹ç™ºã‚¹ã‚¿ãƒƒã‚¯ã®æ ¹æ‹ ï¼‰ğŸ“šâœ¨

* .NET 10 ã¯ LTS ã§ã€ã‚µãƒãƒ¼ãƒˆæœŸé–“ã‚„å…¥æ‰‹ã«ã¤ã„ã¦å…¬å¼ã«æ¡ˆå†…ã•ã‚Œã¦ã„ã¾ã™ã€‚([Microsoft for Developers][1])
* .NET 10 ã®æ–°æ©Ÿèƒ½æ¦‚è¦ï¼ˆASP.NET Core 10 ãªã©ï¼‰ã‚‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¾ã¨ã¾ã£ã¦ã„ã¾ã™ã€‚([Microsoft Learn][2])
* C# 14 ã¯ .NET 10 SDK / Visual Studio 2026 ã§è©¦ã›ã‚‹æ—¨ãŒå…¬å¼ã«æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚([Microsoft Learn][3])
* Visual Studio 2026 ã¨ .NET 10 ã§ F5 èµ·å‹•ãŒæœ€å¤§30%é«˜é€ŸåŒ–ã€ãªã©ã®æ”¹å–„ãŒãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«ã‚ã‚Šã¾ã™ã€‚([Microsoft Learn][4])
* xUnit v3 å´ã‚‚ .NET 10 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãªã©ã®æƒ…å ±ã‚’ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ï¼ˆãƒ†ã‚¹ãƒˆç« ã§æ´»ç”¨ã—ã‚„ã™ã„ã§ã™ï¼‰ã€‚([xunit.net][5])

[1]: https://devblogs.microsoft.com/dotnet/announcing-dotnet-10/?utm_source=chatgpt.com "Announcing .NET 10"
[2]: https://learn.microsoft.com/en-us/dotnet/core/whats-new/dotnet-10/overview?utm_source=chatgpt.com "What's new in .NET 10"
[3]: https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-14?utm_source=chatgpt.com "What's new in C# 14"
[4]: https://learn.microsoft.com/ja-jp/visualstudio/releases/2026/release-notes?utm_source=chatgpt.com "Visual Studio 2026 ãƒªãƒªãƒ¼ã‚¹ ãƒãƒ¼ãƒˆ"
[5]: https://xunit.net/releases/v3/3.1.0?utm_source=chatgpt.com "Core Framework v3 3.1.0 [2025 September 27]"
