# 26ç« ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå®Ÿè£…ï¼ˆæœ€å°ï¼‰ğŸ“¸ğŸ§ª

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆSnapshotï¼‰ã‚’ **æœ€å°æ§‹æˆ** ã§å®Ÿè£…ã§ãã‚‹ğŸ“¸
* **ã€Œæœ€æ–°ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ + æ®‹ã‚Šã‚¤ãƒ™ãƒ³ãƒˆã€** ã§é«˜é€Ÿã«å¾©å…ƒã§ãã‚‹ğŸ”âš¡
* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ **ã„ã¤ä¿å­˜ã™ã‚‹ã‹ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰** ã‚’æ±ºã‚ã‚‰ã‚Œã‚‹ğŸ§ ğŸ“
* ã€Œä¿å­˜ã€ã€Œèª­ã¿å‡ºã—ã€ã€Œå–ã‚Šè¾¼ã¿ã€ã®å®Ÿè£…æ¼ã‚Œã‚’æ½°ã›ã‚‹ğŸ”âœ…

---

# 1. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã£ã¦ä½•ï¼ŸğŸ“¸ğŸ¤”

ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯ã€çŠ¶æ…‹ã‚’ä½œã‚‹ã¨ãã« **ã‚¤ãƒ™ãƒ³ãƒˆã‚’å…ˆé ­ã‹ã‚‰å…¨éƒ¨ Apply** ã—ã¦å¾©å…ƒã—ã¾ã™ã‚ˆã­ğŸ”
ã§ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆãŒå¢—ãˆã‚‹ã¨â€¦â€¦å¾©å…ƒãŒã ã‚“ã ã‚“é‡ããªã‚‹ğŸ˜µâ€ğŸ’«ğŸ’¦

ãã“ã§ **é€”ä¸­ã®çŠ¶æ…‹ã‚’ã€Œå†™çœŸğŸ“¸ã€ã¿ãŸã„ã«ä¿å­˜** ã—ã¦ãŠãã®ãŒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã™âœ¨

* ã‚¤ãƒ™ãƒ³ãƒˆï¼šå‡ºæ¥äº‹ã®å±¥æ­´ğŸ“œ
* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼šã‚ã‚‹æ™‚ç‚¹ã®ã€ŒçŠ¶æ…‹ã®å†™ã—ã€ğŸ“¸

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ **â€œæ­£ã—ã•â€ ã®ãŸã‚ã˜ã‚ƒãªãã¦ â€œé€Ÿã•â€ ã®ãŸã‚** ã®ä»•çµ„ã¿ã ã‚ˆâš¡ğŸ˜Š
ã ã‹ã‚‰æ‰±ã„ã¯ **ã‚­ãƒ£ãƒƒã‚·ãƒ¥** ã«è¿‘ã„ã§ã™ğŸ§Šï¼ˆå£Šã‚Œã¦ã‚‚ä½œã‚Šç›´ã›ã‚‹ã®ãŒç†æƒ³ï¼‰ğŸ”âœ¨

---

# 2. å¾©å…ƒã®æµã‚Œï¼ˆã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šï¼‰ã‚’å›³ã§ç†è§£ğŸ“ŒğŸ§ 

ã‚¹ãƒŠãƒƒãƒ—ç„¡ã—ã ã¨ã“ã†ğŸ‘‡

* å…ˆé ­ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰æœ€å¾Œã¾ã§å…¨éƒ¨èª­ã‚€ â†’ å…¨éƒ¨Apply â†’ ã„ã¾ã®çŠ¶æ…‹å®Œæˆ

ã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šã ã¨ã“ã†ğŸ‘‡

* æœ€æ–°ã‚¹ãƒŠãƒƒãƒ—ã‚’èª­ã‚€ â†’ ãã®ç¶šãã®ã‚¤ãƒ™ãƒ³ãƒˆã ã‘èª­ã‚€ â†’ æ®‹ã‚Šã ã‘Apply â†’ ã„ã¾ã®çŠ¶æ…‹å®Œæˆ

```text
ï¼ˆã‚¹ãƒŠãƒƒãƒ—ç„¡ã—ï¼‰
Events: 1 2 3 4 5 6 7 8 9 ... 500
Apply:  å…¨éƒ¨ãœã‚“ã¶ãœã‚“ã¶â€¦ğŸ˜‡

ï¼ˆã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šï¼‰
Snapshot(v=450) ğŸ“¸  +  Events: 451 452 ... 500
Apply:  50å€‹ã ã‘ã§OKğŸ˜âœ¨
```

---

# 3. æœ€å°ã®è¨­è¨ˆï¼ˆã“ã‚Œã ã‘ã§å‹•ãï¼‰ğŸ§©âœ…

## 3.1 ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«å…¥ã‚Œã‚‹ã‚‚ã®ğŸ±ğŸ·ï¸

æœ€ä½é™ã€ã“ã‚ŒãŒã‚ã‚Œã°å‹•ãã¾ã™ğŸ‘‡

* `StreamId`ï¼šã©ã®é›†ç´„ã®ã‚¹ãƒŠãƒƒãƒ—ï¼ŸğŸ§º
* `Version`ï¼šãã®ã‚¹ãƒŠãƒƒãƒ—ã¯ **ä½•ç•ªç›®ã®ã‚¤ãƒ™ãƒ³ãƒˆã¾ã§åæ˜ æ¸ˆã¿ï¼Ÿ** ğŸ”¢
* `StateJson`ï¼šçŠ¶æ…‹ã‚’ JSON ã«ã—ãŸã‚‚ã®ğŸ§¾
* `CreatedAt`ï¼šã„ã¤ä½œã£ãŸï¼ŸğŸ•’ï¼ˆä»»æ„ã ã‘ã©ä¾¿åˆ©ï¼‰

> ãƒã‚¤ãƒ³ãƒˆğŸ’¡ï¼šVersion ãŒå‘½ï¼
> ã€ŒSnapshot ã®ç¶šãã®ã‚¤ãƒ™ãƒ³ãƒˆã€ã ã‘é©ç”¨ã™ã‚‹ãŸã‚ã«å¿…é ˆã ã‚ˆğŸ”âœ…

## 3.2 ã„ã¤ã‚¹ãƒŠãƒƒãƒ—ã‚’å–ã‚‹ï¼Ÿï¼ˆæœ€å°ãƒ«ãƒ¼ãƒ«ï¼‰ğŸ“âœ¨

ã¾ãšã¯è¿·ã‚ãšã“ã‚Œã§OKğŸ‘‡

* **Version ãŒ N ã®å€æ•°ã«ãªã£ãŸã‚‰ä¿å­˜**ï¼ˆä¾‹ï¼š50ãƒ»100 ãªã©ï¼‰ğŸ“¸
* ä¾‹ï¼š`Version % 50 == 0` ã®ã¨ãä¿å­˜

---

# 4. å®Ÿè£…ï¼šå¿…è¦ãªéƒ¨å“ã‚’å¢—ã‚„ã—ã¦ã„ãğŸ§±ğŸª„

ã“ã“ã‹ã‚‰ **å‹•ãæœ€å°å®Ÿè£…** ã‚’ä½œã‚‹ã‚ˆğŸ˜Šâœ¨
ï¼ˆã“ã®ç« ã¯ã€Œã‚¹ãƒŠãƒƒãƒ—å°å…¥ã€ã«é›†ä¸­ã—ãŸã„ã®ã§ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã¯ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªæƒ³å®šã®ã¾ã¾ã§ã‚‚OKğŸ‘Œï¼‰

---

# 4.1 ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç”¨ã®å‹ã‚’ä½œã‚‹ğŸ“¦ğŸ“¸

```csharp
public sealed record SnapshotEnvelope(
    string StreamId,
    long Version,
    string StateType,
    string StateJson,
    DateTimeOffset CreatedAt
);
```

* `StateType` ã¯ã€Œã“ã‚Œã¯ä½•ã®çŠ¶æ…‹ï¼Ÿã€ã£ã¦ã„ã†ä¿é™ºğŸ›Ÿï¼ˆå°†æ¥ã¡ã‚‡ã„ä¾¿åˆ©ï¼‰

---

# 4.2 ISnapshotStoreï¼ˆä¿å­˜/èª­å–ï¼‰ã‚’ä½œã‚‹ğŸ§°âœ…

```csharp
public interface ISnapshotStore
{
    Task SaveAsync(SnapshotEnvelope snapshot, CancellationToken ct = default);
    Task<SnapshotEnvelope?> LoadLatestAsync(string streamId, CancellationToken ct = default);
}
```

---

# 4.3 æœ€å°ï¼šã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã® SnapshotStore ã‚’ä½œã‚‹ğŸ§ ğŸ“¦

ã¾ãšã¯é›‘ã«ã€Œæœ€æ–°ã ã‘æŒã¤ã€å®Ÿè£…ã§OKğŸ‘Œâœ¨
ï¼ˆæœ¬ç•ªã§ã¯å±¥æ­´ç®¡ç†ã—ãŸã‚ŠDBã«å…¥ã‚ŒãŸã‚Šã™ã‚‹ã‘ã©ã€ä»Šã¯æœ€å°ï¼ï¼‰

```csharp
using System.Collections.Concurrent;

public sealed class InMemorySnapshotStore : ISnapshotStore
{
    private readonly ConcurrentDictionary<string, SnapshotEnvelope> _latest = new();

    public Task SaveAsync(SnapshotEnvelope snapshot, CancellationToken ct = default)
    {
        _latest.AddOrUpdate(
            snapshot.StreamId,
            snapshot,
            (_, current) => snapshot.Version >= current.Version ? snapshot : current
        );

        return Task.CompletedTask;
    }

    public Task<SnapshotEnvelope?> LoadLatestAsync(string streamId, CancellationToken ct = default)
    {
        _latest.TryGetValue(streamId, out var snapshot);
        return Task.FromResult(snapshot);
    }
}
```

* **Version ãŒå¤ã„ã‚¹ãƒŠãƒƒãƒ—ã§ä¸Šæ›¸ãã—ãªã„** ã®ãŒå¤§äº‹ã ã‚ˆğŸ”’âœ…

---

# 4.4 é›†ç´„å´ï¼šã‚¹ãƒŠãƒƒãƒ—ã® â€œå‡ºã—å…¥ã‚Œâ€ ã‚’ç”¨æ„ã™ã‚‹ğŸ§ºğŸ“¸

ã€ŒçŠ¶æ…‹ã‚’JSONã«ã—ã¦ä¿å­˜ã€ã™ã‚‹ã«ã¯ã€çŠ¶æ…‹ã®å‹ãŒå¿…è¦ã ã‚ˆã­ğŸ˜Š
ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ â€œã‚«ãƒ¼ãƒˆâ€ ã‚’ä½¿ã†ã‚ˆğŸ›’âœ¨

## 4.4.1 ã‚¹ãƒŠãƒƒãƒ—ç”¨ã®çŠ¶æ…‹ï¼ˆDTOï¼‰ã‚’ä½œã‚‹ğŸ§¾

```csharp
public sealed record ShoppingCartSnapshot(
    bool IsCreated,
    IReadOnlyDictionary<string, int> Items
);
```

## 4.4.2 é›†ç´„ã« ToSnapshot / LoadSnapshot ã‚’ç”¨æ„ğŸ”

```csharp
using System.Text.Json;

public sealed class ShoppingCart
{
    private readonly Dictionary<string, int> _items = new();
    public bool IsCreated { get; private set; }
    public long Version { get; private set; } // åæ˜ æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆç•ªå·ï¼ˆä¾‹ï¼š0=ã¾ã ä½•ã‚‚ãªã„ï¼‰

    // ç« ã®ç›®çš„ã®ãŸã‚ã€Applyå›æ•°ã‚’è¦‹ãˆã‚‹åŒ–ğŸ‘€
    public int ApplyCount { get; private set; }

    public void ApplyEvent(object @event, long eventVersion)
    {
        ApplyCount++;

        switch (@event)
        {
            case CartCreated:
                IsCreated = true;
                break;

            case ItemAdded e:
                _items[e.Sku] = _items.TryGetValue(e.Sku, out var q) ? q + e.Quantity : e.Quantity;
                break;
        }

        Version = eventVersion;
    }

    public ShoppingCartSnapshot ToSnapshot()
        => new(IsCreated, new Dictionary<string, int>(_items));

    public void LoadSnapshot(ShoppingCartSnapshot snapshot, long snapshotVersion)
    {
        IsCreated = snapshot.IsCreated;

        _items.Clear();
        foreach (var kv in snapshot.Items)
            _items[kv.Key] = kv.Value;

        Version = snapshotVersion;
    }

    public string DebugView()
        => $"Created={IsCreated}, Items={_items.Count}, Version={Version}, ApplyCount={ApplyCount}";
}

public sealed record CartCreated();
public sealed record ItemAdded(string Sku, int Quantity);
```

---

# 4.5 ã€Œã‚¹ãƒŠãƒƒãƒ— + æ®‹ã‚Šã‚¤ãƒ™ãƒ³ãƒˆã€ã§å¾©å…ƒã™ã‚‹ Repository ã‚’ä½œã‚‹ğŸ”ğŸ“¦

ã“ã“ãŒã“ã®ç« ã®ãƒ¡ã‚¤ãƒ³ï¼ğŸ”¥ğŸ“¸

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

1. ã¾ãšã‚¹ãƒŠãƒƒãƒ—ã‚’èª­ã‚€
2. ã‚¹ãƒŠãƒƒãƒ—ãŒã‚ã‚Œã°ã€ãã®Versionä»¥é™ã®ã‚¤ãƒ™ãƒ³ãƒˆã ã‘èª­ã‚€
3. Applyã—ã¦å®Œæˆ

## 4.5.1 ã¾ãš StoredEventï¼ˆä¿å­˜ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã‚’å®šç¾©ğŸ“œ

```csharp
public sealed record StoredEvent(
    string StreamId,
    long Version,
    string EventType,
    string EventJson
);
```

## 4.5.2 EventStore ã®èª­ã¿å–ã‚Šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæœ€å°ï¼‰ğŸ“¦

```csharp
public interface IEventStore
{
    Task<IReadOnlyList<StoredEvent>> ReadStreamAsync(
        string streamId,
        long fromVersionInclusive,
        CancellationToken ct = default
    );
}
```

## 4.5.3 Repositoryï¼šLoad ã®å®Ÿè£…ï¼ˆã‚¹ãƒŠãƒƒãƒ—å¯¾å¿œï¼‰ğŸ“¸âœ¨

```csharp
using System.Text.Json;

public sealed class ShoppingCartRepository
{
    private readonly IEventStore _eventStore;
    private readonly ISnapshotStore _snapshotStore;
    private readonly JsonSerializerOptions _json;

    public ShoppingCartRepository(IEventStore eventStore, ISnapshotStore snapshotStore)
    {
        _eventStore = eventStore;
        _snapshotStore = snapshotStore;
        _json = new JsonSerializerOptions { PropertyNameCaseInsensitive = true };
    }

    public async Task<ShoppingCart> LoadAsync(string streamId, CancellationToken ct = default)
    {
        var cart = new ShoppingCart();

        // 1) ã‚¹ãƒŠãƒƒãƒ—èª­ã¿è¾¼ã¿ğŸ“¸
        var snap = await _snapshotStore.LoadLatestAsync(streamId, ct);
        long fromVersion = 1;

        if (snap is not null)
        {
            var snapshotObj = JsonSerializer.Deserialize<ShoppingCartSnapshot>(snap.StateJson, _json)
                              ?? throw new InvalidOperationException("Snapshot JSON is invalid.");

            cart.LoadSnapshot(snapshotObj, snap.Version);

            // 2) ã‚¹ãƒŠãƒƒãƒ—ã®â€œç¶šãâ€ã‹ã‚‰èª­ã‚€ğŸ”
            fromVersion = snap.Version + 1;
        }

        // 3) æ®‹ã‚Šã‚¤ãƒ™ãƒ³ãƒˆã‚’é©ç”¨ğŸ§©
        var events = await _eventStore.ReadStreamAsync(streamId, fromVersion, ct);
        foreach (var e in events)
        {
            object domainEvent = e.EventType switch
            {
                nameof(CartCreated) => JsonSerializer.Deserialize<CartCreated>(e.EventJson, _json)!,
                nameof(ItemAdded)   => JsonSerializer.Deserialize<ItemAdded>(e.EventJson, _json)!,
                _ => throw new NotSupportedException($"Unknown event type: {e.EventType}")
            };

            cart.ApplyEvent(domainEvent, e.Version);
        }

        return cart;
    }
}
```

---

## 5. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ã€Œã„ã¤ä¿å­˜ã™ã‚‹ã‹ã€ã‚’å®Ÿè£…ğŸ“¸ğŸ—“ï¸

å¾©å…ƒå´ãŒã§ããŸã‚‰ã€æ¬¡ã¯ **ä¿å­˜ã™ã‚‹å´** ã ã‚ˆğŸ˜Šâœ¨

æœ€å°ãƒ«ãƒ¼ãƒ«ï¼š

* **Version ãŒ 50 ã®å€æ•°ã«ãªã£ãŸã‚‰ä¿å­˜**ğŸ“¸

### 5.1 ãƒ«ãƒ¼ãƒ«ï¼ˆPolicyï¼‰ã‚’é–¢æ•°ã«ã™ã‚‹ğŸ“

```csharp
public static class SnapshotPolicy
{
    public static bool ShouldTakeSnapshot(long version, int everyNEvents = 50)
        => version > 0 && version % everyNEvents == 0;
}
```

### 5.2 ä¿å­˜ã™ã‚‹å‡¦ç†ï¼ˆä¾‹ï¼šAppendå¾Œã«å‘¼ã¶ï¼‰ğŸ“¸âœ…

ã€ŒAppendã—ã¦VersionãŒé€²ã‚“ã ã‚ã¨ã€ã«ã‚¹ãƒŠãƒƒãƒ—ã‚’ä½œã‚‹ã®ãŒè‡ªç„¶ã ã‚ˆğŸŒ·

```csharp
using System.Text.Json;

public static class SnapshotSaver
{
    public static async Task TrySaveAsync(
        string streamId,
        ShoppingCart cart,
        ISnapshotStore snapshotStore,
        int everyNEvents = 50,
        CancellationToken ct = default)
    {
        if (!SnapshotPolicy.ShouldTakeSnapshot(cart.Version, everyNEvents))
            return;

        var snapshotObj = cart.ToSnapshot();
        var json = JsonSerializer.Serialize(snapshotObj);

        var envelope = new SnapshotEnvelope(
            StreamId: streamId,
            Version: cart.Version,
            StateType: nameof(ShoppingCartSnapshot),
            StateJson: json,
            CreatedAt: DateTimeOffset.UtcNow
        );

        await snapshotStore.SaveAsync(envelope, ct);
    }
}
```

---

## 6. ãƒŸãƒ‹æ¼”ç¿’ï¼šã‚¹ãƒŠãƒƒãƒ—æœ‰/ç„¡ã§ Apply å›æ•°ã‚’æ¯”ã¹ã‚ˆã†ğŸ”ğŸ“¸ğŸ‘€

ã€Œã»ã‚“ã¨ã«çŸ­ããªã‚‹ã®ï¼Ÿã€ã‚’ä½“ã§æ„Ÿã˜ã‚‹æ¼”ç¿’ã ã‚ˆğŸ˜Šâœ¨

### 6.1 å®Ÿé¨“ã®æµã‚ŒğŸ§ª

1. ã‚¤ãƒ™ãƒ³ãƒˆã‚’ 200 å€‹ã¶ã‚“ç©ã‚“ã æƒ³å®šã«ã™ã‚‹ï¼ˆä¾‹ï¼šItemAddedã‚’200å›ï¼‰
2. ã‚¹ãƒŠãƒƒãƒ—ç„¡ã—ã§å¾©å…ƒ â†’ ApplyCount ã‚’è¦‹ã‚‹
3. é€”ä¸­ï¼ˆVersion=150ï¼‰ã§ã‚¹ãƒŠãƒƒãƒ—ã‚’å…¥ã‚Œã‚‹
4. ã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šã§å¾©å…ƒ â†’ ApplyCount ãŒæ¸›ã‚‹ã®ã‚’è¦‹ã‚‹

### 6.2 æ™‚é–“ã‚‚æ¸¬ã‚ŠãŸã„ãªã‚‰ Stopwatch â±ï¸

`Stopwatch` ã¯ .NET ã®æ¨™æº–ã§ä½¿ãˆã‚‹ã‚ˆâ±ï¸âœ¨ï¼ˆé«˜ç²¾åº¦ã‚«ã‚¦ãƒ³ã‚¿å¯¾å¿œã®èª¬æ˜ã‚ã‚Šï¼‰([Microsoft Learn][1])

```csharp
using System.Diagnostics;

var sw = Stopwatch.StartNew();
// LoadAsync ã‚’å‘¼ã¶ï¼ˆã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Š/ç„¡ã—ã§æ¯”è¼ƒï¼‰
sw.Stop();

Console.WriteLine($"Elapsed: {sw.ElapsedMilliseconds} ms");
```

---

## 7. ãƒ†ã‚¹ãƒˆè¦³ç‚¹ï¼ˆæœ€å°ï¼‰ğŸ§ªâœ…

ã“ã®ç« ã§ã¾ãšæ¬²ã—ã„ãƒ†ã‚¹ãƒˆã¯ã“ã‚ŒğŸ‘‡

### 7.1 æ­£ã—ã•ãƒ†ã‚¹ãƒˆï¼ˆåŒã˜çŠ¶æ…‹ã«ãªã‚‹ï¼‰ğŸ¯

* **ã‚¹ãƒŠãƒƒãƒ—ç„¡ã—å¾©å…ƒ** ã¨ **ã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šå¾©å…ƒ** ãŒ **åŒã˜çŠ¶æ…‹** ã«ãªã‚‹ã“ã¨âœ…

  * `IsCreated` ãŒä¸€è‡´
  * `Items` ãŒä¸€è‡´
  * `Version` ãŒä¸€è‡´

### 7.2 åŠ¹æœãƒ†ã‚¹ãƒˆï¼ˆApplyå›æ•°ãŒæ¸›ã‚‹ï¼‰ğŸ“‰

* ã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šã® `ApplyCount` ãŒå°ã•ã„ã“ã¨âœ…

> æ³¨æ„âš ï¸ï¼šæ™‚é–“ï¼ˆmsï¼‰ã§ã®æ–­å®šãƒ†ã‚¹ãƒˆã¯ç’°å¢ƒå·®ãŒå‡ºã‚„ã™ã„ã‹ã‚‰ã€ã¾ãšã¯ **Applyå›æ•°** ãŒå®‰å…¨ã ã‚ˆğŸ˜Š

---

## 8. ã‚ˆãã‚ã‚‹å®Ÿè£…ãƒŸã‚¹é›†ï¼ˆã“ã“ã§è©°ã¾ã‚ŠãŒã¡ï¼‰ğŸ˜µâ€ğŸ’«ğŸ§¯

* **ã‚¹ãƒŠãƒƒãƒ—Versionã‚’æ›´æ–°ã—å¿˜ã‚Œã‚‹** â†’ ç¶šãã®ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ºãƒ¬ã‚‹ğŸ˜‡
* **fromVersion ã®è¨ˆç®—ãƒŸã‚¹**ï¼ˆ`snap.Version + 1` ã‚’å¿˜ã‚Œã‚‹ï¼‰â†’ ã‚¤ãƒ™ãƒ³ãƒˆäºŒé‡é©ç”¨ğŸ’¥
* **ã‚¹ãƒŠãƒƒãƒ—ãŒå¤ã„ã®ã«ä¸Šæ›¸ãã—ã¦ã—ã¾ã†** â†’ é€†ã«é…ããªã‚‹/å£Šã‚Œã‚‹ğŸ˜±
* **ã‚¤ãƒ™ãƒ³ãƒˆTypeâ†’å¾©å…ƒã®åˆ†å²ãŒå¢—ãˆã¦åœ°ç„** â†’ ã¾ãšã¯æœ€å°ã§OKã€ã‚ã¨ã§æ”¹å–„ğŸŒ±

---

## 9. AIæ´»ç”¨ï¼ˆã“ã®ç« å‘ã‘ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼‰ğŸ¤–âœ¨

### 9.1 å®Ÿè£…ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‚‚ã‚‰ã†ğŸ”

* ã€Œã‚¹ãƒŠãƒƒãƒ—Versionã®æ‰±ã„ã€
* ã€ŒfromVersionã®è¨ˆç®—ã€
* ã€Œå¤ã„ã‚¹ãƒŠãƒƒãƒ—ã§ä¸Šæ›¸ãã—ã¦ãªã„ã‹ã€

ä¾‹ğŸ‘‡

```text
æ¬¡ã®C#ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå°å…¥ã§èµ·ãã‚„ã™ã„ãƒã‚°
ï¼ˆVersionã‚ºãƒ¬ã€äºŒé‡é©ç”¨ã€å¤ã„ã‚¹ãƒŠãƒƒãƒ—ä¸Šæ›¸ãã€èª­ã¿å‡ºã—æ¼ã‚Œï¼‰ã‚’é‡ç‚¹çš„ã«æŒ‡æ‘˜ã—ã¦ã€‚
ä¿®æ­£æ¡ˆã¯ â€œå·®åˆ†â€ ã§ææ¡ˆã—ã¦ã­ã€‚
```

### 9.2 ãƒ†ã‚¹ãƒˆç”Ÿæˆï¼ˆGiven-When-Thenï¼‰ğŸ§ª

```text
ShoppingCartã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå¾©å…ƒã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„ã€‚
(1) ã‚¹ãƒŠãƒƒãƒ—ç„¡ã—å¾©å…ƒã¨ã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šå¾©å…ƒã®çŠ¶æ…‹ä¸€è‡´
(2) ApplyCountãŒæ¸›ã‚‹
ã“ã®2ã¤ã‚’xUnitã§æ›¸ã„ã¦ã€‚ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ItemAddedã‚’200å›ã§OKã€‚
```

---

## 10. 2026å¹´2æœˆæ™‚ç‚¹ã®å‘¨è¾ºãƒ¡ãƒ¢ğŸ“âœ¨

* .NET 10 ã® â€œWhatâ€™s newâ€ ã¯ Microsoft å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ç¢ºèªã§ãã‚‹ã‚ˆğŸ“š([Microsoft Learn][2])
* Visual Studio 2026 ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚‚å…¬å¼ã«ã¾ã¨ã¾ã£ã¦ã‚‹ã‚ˆğŸ› ï¸([Microsoft Learn][3])
* .NET 10 ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ï¼ˆGA/LTSã®æ–‡è„ˆãªã©ï¼‰ã¯å…¬å¼ãƒ–ãƒ­ã‚°ãŒåŸºç‚¹ã«ãªã‚‹ã‚ˆğŸ“°([devblogs.microsoft.com][4])

[1]: https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.stopwatch?view=net-10.0&utm_source=chatgpt.com "Stopwatch Class (System.Diagnostics)"
[2]: https://learn.microsoft.com/en-us/dotnet/core/whats-new/dotnet-10/overview?utm_source=chatgpt.com "What's new in .NET 10"
[3]: https://learn.microsoft.com/ja-jp/visualstudio/releases/2026/release-notes?utm_source=chatgpt.com "Visual Studio 2026 ãƒªãƒªãƒ¼ã‚¹ ãƒãƒ¼ãƒˆ"
[4]: https://devblogs.microsoft.com/dotnet/announcing-dotnet-10/?utm_source=chatgpt.com "Announcing .NET 10"
