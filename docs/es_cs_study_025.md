# ç¬¬25ç« ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ¦‚å¿µï¼ˆãªãœå¿…è¦ï¼Ÿï¼‰ğŸ“¸âš¡

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ ğŸ¯âœ¨

* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒ **ä½•ã®ãŸã‚ã«ã‚ã‚‹ã®ã‹** ã‚’èª¬æ˜ã§ãã‚‹ğŸ“¸
* ã€Œã„ã¤å…¥ã‚Œã‚‹ã¹ãã‹ï¼ã¾ã è¦ã‚‰ãªã„ã‹ã€ã‚’ **åˆ¤æ–­ã§ãã‚‹** âœ…
* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã® **å–ã‚Šæ–¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼ˆNä»¶ã”ã¨ãƒ»æ™‚é–“ã”ã¨ç­‰ï¼‰ã‚’é¸ã¹ã‚‹ğŸ§ 
* æ¬¡ç« ï¼ˆæœ€å°å®Ÿè£…ï¼‰ã«å‘ã‘ã¦ã€**è¨­è¨ˆãƒ¡ãƒ¢**ã‚’ä½œã‚Œã‚‹ğŸ“

---

# 1) ãã‚‚ãã‚‚ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã£ã¦ä½•ï¼ŸğŸ“¸

ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯ã€é›†ç´„ï¼ˆAggregateï¼‰ã®ç¾åœ¨çŠ¶æ…‹ã¯ **ã‚¤ãƒ™ãƒ³ãƒˆåˆ—ã‚’æœ€åˆã‹ã‚‰é †ã« Apply ã—ã¦å¾©å…ƒï¼ˆRehydrateï¼‰** ã—ã¦ä½œã‚Šã¾ã™ã‚ˆã­ğŸ”

ã§ã‚‚ã€ã‚¤ãƒ™ãƒ³ãƒˆãŒå¢—ãˆã‚‹ã¨â€¦

* å¾©å…ƒã®ãŸã³ã« **èª­ã‚€ã‚¤ãƒ™ãƒ³ãƒˆæ•°ãŒå¢—ãˆã‚‹** ğŸ“š
* Applyå›æ•°ãŒå¢—ãˆã¦ **CPUæ™‚é–“ã‚‚å¢—ãˆã‚‹** ğŸ§ ğŸ’¦

ãã“ã§ç™»å ´ã™ã‚‹ã®ãŒ **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ**ï¼ˆSnapshotï¼‰ã§ã™âœ¨
ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ã€Œã‚ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆversionï¼‰æ™‚ç‚¹ã® **é›†ç´„ã®çŠ¶æ…‹ã‚’ä¸¸ã”ã¨ä¿å­˜** ã—ãŸã‚‚ã®ã€ã§ã™ğŸ“¦
å¾©å…ƒã™ã‚‹ã¨ãã¯ã€Œæœ€æ–°ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ + ãã“ã‹ã‚‰å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆã ã‘ã€ã‚’å½“ã¦ã‚Œã°OKã«ãªã‚Šã¾ã™âœ…

> é‡è¦ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ â€œè¨­è¨ˆã®ä¸»å½¹â€ ã˜ã‚ƒãªãã¦ **æ€§èƒ½æœ€é©åŒ–ã®é“å…·** ã§ã™ğŸ“Œ
> ã¾ãšã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä½œã£ã¦ã€å¿…è¦ã«ãªã£ãŸã‚‰å…¥ã‚Œã‚‹ã€ãŒåŸºæœ¬ï¼ ([martendb.io][1])

---

# 2) ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒæ¬²ã—ããªã‚‹ã€Œã‚ã‚‹ã‚ã‚‹ã€ğŸ˜µâ€ğŸ’«

æ¬¡ã®ã©ã‚Œã‹ãŒèµ·ãã‚‹ã¨ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ¤œè¨ã™ã‚‹ä¾¡å€¤ãŒå‡ºã¾ã™ğŸ‘‡

## A. 1ã¤ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå¤šã™ãã‚‹ğŸ“šğŸ“šğŸ“š

ãŸã¨ãˆã°ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã€ã€Œè²·ã„ç‰©ã‚«ãƒ¼ãƒˆã€ã€Œã‚µãƒ–ã‚¹ã‚¯å¥‘ç´„ã€ã¿ãŸã„ã«ã€é•·æœŸã§æ›´æ–°ã•ã‚Œç¶šã‘ã‚‹é›†ç´„ã¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç©ã‚‚ã‚ŠãŒã¡ã€‚

## B. ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ãŒé…ããªã£ã¦ããŸğŸ¢ğŸ’¦

ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã¯ã ã„ãŸã„
**Loadï¼ˆå¾©å…ƒï¼‰â†’ Decideï¼ˆãƒ«ãƒ¼ãƒ«åˆ¤å®šï¼‰â†’ Appendï¼ˆä¿å­˜ï¼‰**
ãªã®ã§ã€Load ãŒé…ã„ã¨å…¨ä½“ãŒé…ããªã‚Šã¾ã™â±ï¸

## C. â€œé«˜ã„é »åº¦ã§å¾©å…ƒã•ã‚Œã‚‹â€ é›†ç´„ãŒã‚ã‚‹ğŸ”

åŒã˜é›†ç´„ãŒçŸ­æ™‚é–“ã«ä½•åº¦ã‚‚æ›´æ–°ã•ã‚Œã‚‹ã¨ã€å¾©å…ƒã‚³ã‚¹ãƒˆãŒåŠ¹ã„ã¦ãã¾ã™ğŸ’¥

---

# 3) ã¾ãšè¦šãˆã‚‹ã€Œå¤§åŸå‰‡ã€3ã¤ ğŸ§·âœ…

## åŸå‰‡â‘ ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯â€œæœ€åˆã‹ã‚‰å…¥ã‚Œãªã„â€ğŸ™…â€â™€ï¸

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ä¾¿åˆ©ã ã‘ã©ã€**æ›¸ãè¾¼ã¿ãŒå¢—ãˆã‚‹**ã—ã€é‹ç”¨ãŒè¤‡é›‘ã«ãªã‚Šã¾ã™ğŸ§¯
ã ã‹ã‚‰ã€Œå¿…è¦ã«ãªã‚‹ã¾ã§å…¥ã‚Œãªã„ã€ãŒæ¨å¥¨ã•ã‚ŒãŒã¡ã§ã™ã€‚ ([martendb.io][1])

## åŸå‰‡â‘¡ï¼šæ¯å›ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã‚‰ãªã„ğŸ™…â€â™€ï¸ğŸ“¸

ã‚¤ãƒ™ãƒ³ãƒˆã‚’1ã¤æ›¸ããŸã³ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚‚æ›¸ãã¨ã€
ã€Œé€Ÿãã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã€ãŒã€Œé…ãã™ã‚‹åŸå› ã€ã«ãªã‚ŠãŒã¡â€¦ğŸ˜‡
ä¸€èˆ¬ã«ã¯ **é–“éš”**ï¼ˆä¸€å®šã‚¤ãƒ™ãƒ³ãƒˆæ•°ã”ã¨ã€ã¾ãŸã¯ç‰¹å®šã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ãªã©ï¼‰ã§å–ã‚Šã¾ã™ã€‚ ([martendb.io][2])

## åŸå‰‡â‘¢ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®å‰ã«â€œæ§‹é€ â€ã‚’ç–‘ã†ğŸ§ ğŸ”

ã‚¤ãƒ™ãƒ³ãƒˆãŒå¢—ãˆã™ãã‚‹åŸå› ãŒã€Œé›†ç´„ãŒãƒ‡ã‚«ã™ãã€ãªã‚‰ã€
ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚ˆã‚Šå…ˆã« **é›†ç´„ã®å¢ƒç•Œè¦‹ç›´ã—** ã§è§£æ±ºã§ãã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™âš–ï¸ ([EventSourcingDB][3])

---

# 4) ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å–ã‚‹ï¼Ÿä»£è¡¨ãƒ‘ã‚¿ãƒ¼ãƒ³4ã¤ ğŸ“ˆğŸ“¸

## ãƒ‘ã‚¿ãƒ¼ãƒ³Aï¼šNä»¶ã”ã¨ï¼ˆä¾‹ï¼š100ä»¶ã”ã¨ï¼‰ğŸ”¢

* ã„ã¡ã°ã‚“åˆ†ã‹ã‚Šã‚„ã™ã„ç‹é“âœ¨
* ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’èª­ã‚€ + æœ€å¤§Nä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆã ã‘å†ç”Ÿã€ã§å¾©å…ƒã§ãã‚‹
* Nã¯ã€é›†ç´„ã®é‡ã•æ¬¡ç¬¬ï¼ˆæ•°ç™¾ã”ã¨ã€ãªã©ã®çµŒé¨“è«‡ã‚‚ã‚ã‚Šã¾ã™ï¼‰ ([Kurrent - event-native data platform][4])

**å‘ã„ã¦ã‚‹**ï¼šã‚¤ãƒ™ãƒ³ãƒˆæ•°ãŒç´ ç›´ã«å¢—ãˆç¶šã‘ã‚‹é›†ç´„
**å¼±ç‚¹**ï¼šNã®æ ¹æ‹ ãŒè–„ã„ã¨ã€èª¿æ•´ãŒè¿·å­ã«ãªã‚‹ğŸŒ€

---

## ãƒ‘ã‚¿ãƒ¼ãƒ³Bï¼šæ™‚é–“ã”ã¨ï¼ˆä¾‹ï¼š1æ—¥1å›ã€1æ™‚é–“1å›ï¼‰ğŸ•’

* â€œå¢—ãˆæ–¹â€ ãŒä¸€å®šã§ã¯ãªã„å ´åˆã«ä¾¿åˆ©
* ãƒãƒƒãƒçš„ã«å–ã‚Œã‚‹ï¼ˆå¤œé–“ã«å–ã‚‹ãªã©ï¼‰ğŸŒ™

**å‘ã„ã¦ã‚‹**ï¼šæ—¥æ¬¡ãƒ»é€±æ¬¡ã®æ›´æ–°ãŒå¤šã„ã€é‹ç”¨éƒ½åˆãŒã‚ã‚‹
**å¼±ç‚¹**ï¼šæ›´æ–°ãŒé›†ä¸­ã™ã‚‹æ™‚é–“å¸¯ã ã¨ã€ãã®æ™‚é–“ã®å¾©å…ƒãŒé‡ã„ã“ã¨ã‚‚ğŸ’¦

---

## ãƒ‘ã‚¿ãƒ¼ãƒ³Cï¼šç‰¹å®šã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ãŸã‚‰å–ã‚‹ï¼ˆç¯€ç›®ï¼‰ğŸ

ä¾‹ï¼š

* `OrderPlaced` ã®ç›´å¾Œã ã‘
* `SubscriptionRenewed` ã®ç›´å¾Œã ã‘

ã€Œã“ã®ç¯€ç›®ã®çŠ¶æ…‹ãŒé‡è¦ã€ã€Œã“ã“ã‹ã‚‰ã®å¾©å…ƒãŒé‡ã„ã€ã¿ãŸã„ãªã¨ãã«åŠ¹ãã¾ã™âœ¨
Martenã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€Œä¸€å®šé–“éš” or ç‰¹å®šã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã§ã€ãŒã‚ˆãã‚ã‚‹ã€ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ ([martendb.io][2])

---

## ãƒ‘ã‚¿ãƒ¼ãƒ³Dï¼šæ··åˆï¼ˆNä»¶ã”ã¨ + ç¯€ç›®ï¼‰ğŸ§©

* é€šå¸¸ã¯Nä»¶ã”ã¨
* ã§ã‚‚ â€œç‰¹åˆ¥ã«é‡ã„ã‚¤ãƒ™ãƒ³ãƒˆâ€ ãŒæ¥ãŸã‚‰å³ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

**å‘ã„ã¦ã‚‹**ï¼šã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡ã§é‡ã•ãŒãƒãƒ©ãƒãƒ©ãªé›†ç´„

---

# 5) ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«å…¥ã‚Œã‚‹ã‚‚ã®ï¼ˆæœ€ä½é™ï¼‰ğŸ±ğŸ·ï¸

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ã€ŒçŠ¶æ…‹ã®ä¿å­˜ã€ãªã®ã§ã€æœ€ä½é™ã“ã‚ŒãŒå¿…è¦ã§ã™ğŸ‘‡

* `AggregateId`ï¼ˆã©ã®é›†ç´„ï¼Ÿï¼‰
* `Version`ï¼ˆã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã¾ã§åæ˜ æ¸ˆã¿ï¼Ÿï¼‰ğŸ”¢
* `State`ï¼ˆé›†ç´„ã®çŠ¶æ…‹æœ¬ä½“ï¼‰ğŸ“¦
* `CreatedAt`ï¼ˆã„ã¤ä½œã£ãŸï¼Ÿï¼‰ğŸ•’ï¼ˆã‚ã‚‹ã¨ä¾¿åˆ©ï¼‰

> ã‚³ãƒ„ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ä¸­èº«ã¯ã€Œå¾©å…ƒã«å¿…è¦ãªçŠ¶æ…‹ã ã‘ã€ã«çµã‚‹ã¨å®‰å…¨ã§ã™âœ…
> â€œç”»é¢è¡¨ç¤ºç”¨ã®æƒ…å ±â€ ã¾ã§è©°ã‚ã‚‹ã¨ã€å¤‰æ›´ã«å¼±ããªã‚ŠãŒã¡ğŸ˜µâ€ğŸ’«

ã•ã‚‰ã«è¨­è¨ˆã¨ã—ã¦ã¯ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚‚å°‚ç”¨ã‚¿ã‚¤ãƒ—ã¨ã—ã¦æ‰±ã†ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆæ‰±ã„ã«è¿‘ã„å½¢ï¼‰ã€ã¿ãŸã„ãªæ–¹é‡ã‚‚ã‚ã‚Šã¾ã™ã€‚ ([EventSourcingDB][3])

---

# 6) ã‚ˆãã‚ã‚‹äº‹æ•…ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã“ã“è¶…å¤§äº‹ï¼‰ğŸ§¯ğŸ˜±

## äº‹æ•…â‘ ï¼šVersionã‚ºãƒ¬ï¼ˆã“ã‚Œä¸€ç•ªå¤šã„ï¼‰ğŸ’¥

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒ `Version=120` ãªã®ã«ã€
å¾Œç¶šã‚¤ãƒ™ãƒ³ãƒˆã‚’ `121` ã‹ã‚‰é©ç”¨ã—ãªã„ã¨ã„ã‘ãªã„ã®ã«é–“é•ãˆã¦ `120` ã‹ã‚‰é©ç”¨â€¦
â†’ äºŒé‡é©ç”¨ã§å£Šã‚Œã¾ã™ğŸ˜‡

âœ… å¯¾ç­–ï¼š

* ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ **versionã¾ã§é©ç”¨æ¸ˆã¿**ã€ã‚’å³å¯†ã«å®šç¾©
* å¾©å…ƒã‚³ãƒ¼ãƒ‰ã§ `snapshot.Version + 1` ã‹ã‚‰èª­ã‚€ã‚ˆã†ã«å›ºå®š

---

## äº‹æ•…â‘¡ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒå£Šã‚Œã¦ã‚‹ï¼ˆã§ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆã¯æ­£ã—ã„ï¼‰ğŸ§¨

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ â€œæœ€é©åŒ–ãƒ‡ãƒ¼ã‚¿â€ ãªã®ã§ã€å£Šã‚Œã‚‹ã¨å„ä»‹ğŸ’¦

âœ… å¯¾ç­–ï¼š

* ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒèª­ã‚ãªã‘ã‚Œã°ã€ã‚¤ãƒ™ãƒ³ãƒˆæœ€åˆã‹ã‚‰å¾©å…ƒã™ã‚‹ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç”¨æ„
* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯å†ç”Ÿæˆã§ãã‚‹è¨­è¨ˆã«ã™ã‚‹ğŸ”

---

## äº‹æ•…â‘¢ï¼šæ›¸ãè¾¼ã¿å¢—ãˆã™ãï¼ˆé€Ÿãã™ã‚‹ã¯ãšãŒé…ã„ï¼‰ğŸ“¸ğŸ“¸ğŸ“¸

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆé »åº¦ãŒé«˜ã„ã¨ã€IOãŒå¢—ãˆã¦é€†åŠ¹æœã«ãªã‚ŠãŒã¡ã€‚
ã€Œæ¯å›ã¯å–ã‚‰ãšã€é–“éš”ã§ã€ãŒåŸºæœ¬ã§ã™ã€‚ ([martendb.io][2])

---

## äº‹æ•…â‘£ï¼šä¿å­˜å ´æ‰€ã®è¨­è¨ˆãŒå¾®å¦™ã§é‹ç”¨åœ°ç„ğŸŒ€

ä¾‹ã¨ã—ã¦ EventStoreDB ã¾ã‚ã‚Šã§ã¯ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç”¨ã«åˆ¥ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œã‚Šã€æœ€å¤§1ä»¶ã ã‘ä¿æŒã™ã‚‹ã€ã¿ãŸã„ãªã‚„ã‚Šæ–¹ãŒç´¹ä»‹ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆæœ€æ–°ã ã‘æ®‹ã™ï¼‰ã€‚ ([ITNext][5])
ï¼ˆâ€»ã‚ãªãŸã®è‡ªä½œEventStoreã§ã‚‚ã€åŒã˜è€ƒãˆæ–¹ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚„ã‚­ãƒ¼è¨­è¨ˆãŒã§ãã¾ã™ğŸ‘Œï¼‰

---

# 7) â€œå…¥ã‚Œã‚‹ã‹ã©ã†ã‹â€åˆ¤æ–­ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ âœ…ğŸ“

æ¬¡ã®è³ªå•ã«YESãŒå¢—ãˆãŸã‚‰ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ¤œè¨ã§ã™ğŸ“¸

* [ ] 1ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ã‚¤ãƒ™ãƒ³ãƒˆæ•°ãŒ **æ•°ç™¾ã€œæ•°åƒ** ã«ãªã£ã¦ããŸ
* [ ] ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã®é…ã•ãŒ **ä½“æ„Ÿã§ãã‚‹**ï¼ˆor è¨ˆæ¸¬ã§å‡ºãŸï¼‰â±ï¸
* [ ] åŒã˜é›†ç´„ã‚’çŸ­æ™‚é–“ã«ä½•åº¦ã‚‚å¾©å…ƒã—ã¦ã„ã‚‹ğŸ”
* [ ] ã§ã‚‚é›†ç´„åˆ†å‰²ï¼ˆå¢ƒç•Œè¦‹ç›´ã—ï¼‰ã§ã¯è§£æ±ºã—ã«ãã„âš–ï¸
* [ ] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå°å…¥ã® **è¿½åŠ æ›¸ãè¾¼ã¿** ã‚’è¨±å®¹ã§ãã‚‹âœï¸

> ã€Œè¨ˆæ¸¬ã—ã¦ã‹ã‚‰å…¥ã‚Œã‚‹ã€ãŒã„ã¡ã°ã‚“å¼·ã„ã§ã™ğŸ’ª
> .NET 10 ã§ã‚‚è¨ºæ–­ãƒ»è¦³æ¸¬ãŒå¼·åŒ–ã•ã‚Œã¦ã„ã¦ã€è¨ˆæ¸¬ã®é‡è¦æ€§ã¯ã¾ã™ã¾ã™ä¸ŠãŒã£ã¦ã¾ã™ã€‚ ([Microsoft Learn][6])

---

# 8) ãƒŸãƒ‹æ¼”ç¿’ï¼šã‚¤ãƒ™ãƒ³ãƒˆ100ä»¶ã®â€œé‡ã•â€ã‚’ä½“æ„Ÿã—ã‚ˆã† ğŸ˜µâ€ğŸ’«â¡ï¸ğŸ˜²

ã“ã®ç« ã¯æ¦‚å¿µå›ãªã®ã§ã€å®Ÿè£…ã¯æ¬¡ç« ã§ã‚„ã‚Šã¾ã™ï¼
ã§ã‚‚ã€Œé…ã•ã®æ­£ä½“ã€ã‚’ä½“æ„Ÿã™ã‚‹ã¨ç†è§£ãŒçˆ†ä¸ŠãŒã‚Šã—ã¾ã™ğŸ’¡

## ã‚„ã‚‹ã“ã¨ï¼ˆæ‰‹é †ï¼‰ğŸ§ª

1. ã™ã§ã«ä½œã£ãŸé›†ç´„ã«ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’ **100ä»¶** é€£ç¶šã§Appendï¼ˆãƒ†ã‚¹ãƒˆã§OKï¼‰
2. `Rehydrate` ã‚’ **10å›** ãƒ«ãƒ¼ãƒ—ã—ã¦ `Stopwatch` ã§æ™‚é–“ã‚’è¨ˆã‚‹
3. ã¤ã„ã§ã« `Apply` ã®ä¸­ã§ã€Œã¡ã‚‡ã„é‡ã„å‡¦ç†ã€ã‚’ **ã‚ã–ã¨è¿½åŠ **ï¼ˆä¾‹ï¼šç°¡å˜ãªãƒ«ãƒ¼ãƒ—ï¼‰
4. ã€Œã‚¤ãƒ™ãƒ³ãƒˆæ•°ãŒå¢—ãˆã‚‹ã»ã©å¾©å…ƒãŒé‡ããªã‚‹ã€ã‚’ä½“æ„Ÿã™ã‚‹

### è¨ˆæ¸¬ã®æœ€å°ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆé›°å›²æ°—ï¼‰â±ï¸

```csharp
using System.Diagnostics;

var sw = Stopwatch.StartNew();

for (int i = 0; i < 10; i++)
{
    var agg = await repository.LoadAsync(id); // ã“ã“ãŒã‚¤ãƒ™ãƒ³ãƒˆå†ç”Ÿï¼ˆå¾©å…ƒï¼‰
}

sw.Stop();
Console.WriteLine($"rehydrate x10: {sw.ElapsedMilliseconds}ms");
```

âœ… è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆğŸ‘€

* ã‚¤ãƒ™ãƒ³ãƒˆæ•°ãŒå¢—ãˆã‚‹ã¨ã€**å¾©å…ƒãŒæ¯”ä¾‹ã—ã¦é‡ããªã‚‹**
* ApplyãŒé‡ã„ã¨ã€ã•ã‚‰ã«åŠ¹ã
* ã ã‹ã‚‰ã€Œæœ€æ–°çŠ¶æ…‹ã‚’é€”ä¸­ä¿å­˜ã§ããŸã‚‰å¬‰ã—ã„ã€ã£ã¦ãªã‚‹ğŸ“¸âœ¨

---

# 9) AIæ´»ç”¨ï¼ˆCopilot / Codexï¼‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ ğŸ¤–ğŸ’¬âœ¨

## ç›®çš„ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå°å…¥ã®â€œè¨­è¨ˆãƒ¡ãƒ¢â€ã‚’ä½œã‚‹ğŸ“

* ã€ŒNä»¶ã”ã¨ã€ã€Œæ™‚é–“ã”ã¨ã€ã€Œç¯€ç›®ã‚¤ãƒ™ãƒ³ãƒˆã€ã®å€™è£œã‚’3ã¤å‡ºã—ã¦
* ãã‚Œãã‚Œã®ãƒ¡ãƒªãƒ‡ãƒ¡ã¨ã€æ¡ç”¨æ¡ä»¶ï¼ˆã“ã†ãªã£ãŸã‚‰å…¥ã‚Œã‚‹ï¼‰ã‚’æ›¸ã„ã¦
* ã†ã¡ã®é¡Œæï¼ˆã‚«ãƒ¼ãƒˆ/ToDoç­‰ï¼‰ã«åˆã‚ã›ã¦ä¾‹ã‚‚ã¤ã‘ã¦

## ç›®çš„ï¼šæ¬¡ç« ã®å®Ÿè£…ã«å‘ã‘ãŸâ€œé››å½¢â€ã‚’ä½œã‚‹ğŸ§±

* `Snapshot` ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆAggregateId, Version, State, CreatedAtï¼‰ã‚’å®šç¾©ã—ã¦
* `Load` ã§ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆèª­ã‚“ã§ã€æ®‹ã‚Šã‚¤ãƒ™ãƒ³ãƒˆã ã‘èª­ã‚€ã€æµã‚Œã‚’ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ã§

> AIã«å‡ºã—ã¦ã‚‚ã‚‰ã£ãŸã‚‰ã€å¿…ãšãƒã‚§ãƒƒã‚¯ã™ã‚‹ã®ã¯ã“ã“ğŸ‘‡
>
> * versionã®æ‰±ã„ï¼ˆ+1ã®èª­ã¿é–‹å§‹ï¼‰
> * â€œæ¯å›ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜â€ ã«ãªã£ã¦ãªã„ã‹
> * Stateã«è©°ã‚ã™ãã¦ãªã„ã‹ï¼ˆè¡¨ç¤ºç”¨ã¾ã§å…¥ã‚Œã¦ãªã„ï¼Ÿï¼‰

---

# ã¾ã¨ã‚ ğŸ€

* ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ **å¾©å…ƒï¼ˆRehydrateï¼‰ã‚’é€Ÿãã™ã‚‹ãŸã‚ã®æœ€é©åŒ–** ğŸ“¸âš¡ ([martendb.io][1])
* ã¾ãšã¯å…¥ã‚Œãšã«ä½œã£ã¦ã€**å¿…è¦ã«ãªã£ãŸã‚‰**å…¥ã‚Œã‚‹ã®ãŒåŸºæœ¬âœ… ([martendb.io][1])
* å–ã‚Šæ–¹ã¯ã€ŒNä»¶ã”ã¨ã€ã€Œæ™‚é–“ã”ã¨ã€ã€Œç¯€ç›®ã‚¤ãƒ™ãƒ³ãƒˆã€ãŒä»£è¡¨ğŸ§  ([Kurrent - event-native data platform][4])
* æœ€å¤§ã®äº‹æ•…ã¯ **versionã‚ºãƒ¬**ï¼ã“ã“ã¯è¨­è¨ˆã§ã‚¬ãƒã‚¬ãƒã«å›ºå®šã™ã‚‹ğŸ”’

---

# æ¬¡ç« ãƒãƒ©è¦‹ã› ğŸ‘€âœ¨

# æ¬¡ã®ç¬¬26ç« ã§ã¯ã€ã„ã¾å­¦ã‚“ã æ¦‚å¿µã‚’ä½¿ã£ã¦
**ã€Œæœ€æ–°ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ + æ®‹ã‚Šã‚¤ãƒ™ãƒ³ãƒˆã€** ã§å¾©å…ƒã™ã‚‹æœ€å°å®Ÿè£…ã‚’ä½œã‚Šã¾ã™ğŸ“¸ğŸ§ª

[1]: https://martendb.io/events/learning.html?utm_source=chatgpt.com "Understanding Event Sourcing with Marten"
[2]: https://martendb.io/events/projections/live-aggregates?utm_source=chatgpt.com "Live Aggregation"
[3]: https://docs.eventsourcingdb.io/fundamentals/snapshots/?utm_source=chatgpt.com "Snapshots - EventSourcingDB"
[4]: https://www.kurrent.io/blog/snapshots-in-event-sourcing?utm_source=chatgpt.com "Snapshots in Event Sourcing - Kurrent.io"
[5]: https://itnext.io/advanced-features-of-an-event-store-for-event-sourcing-a457ebd77692?utm_source=chatgpt.com "Advanced features of an Event Store for Event Sourcing"
[6]: https://learn.microsoft.com/en-us/dotnet/core/whats-new/dotnet-10/overview?utm_source=chatgpt.com "What's new in .NET 10"
