# ç¬¬1ç« ï¼šåˆ†æ•£ã£ã¦ä½•ãŒå¤§å¤‰ãªã®ï¼Ÿã‚’å…ˆã«ä½“æ„ŸğŸ˜µâ€ğŸ’«ğŸŒ

## ã“ã®ç« ã®1è¡Œçµè«–âœï¸âœ¨

åˆ†æ•£ã®ä¸–ç•Œã¯ã€Œé…ã„â³ï¼é€”ä¸­ã§è½ã¡ã‚‹ğŸ’¥ï¼åŒã˜è¦æ±‚ãŒ2å›å±ŠãğŸ“¨ï¼é †ç•ªãŒã‚ºãƒ¬ã‚‹ğŸ”€ã€ãŒâ€œæ™®é€šâ€ã«ãªã‚‹ã®ã§ã€å˜ä½“ã‚¢ãƒ—ãƒªã®å¸¸è­˜ãŒãã®ã¾ã¾é€šã‚Šã¾ã›ã‚“ã€‚

---

# 1) ã¾ãšã€Œå˜ä½“ã‚¢ãƒ—ãƒªã®å¸¸è­˜ã€ã‚’ç¢ºèªã—ã‚ˆã†ğŸ§ âœ…

å˜ä½“ã‚¢ãƒ—ãƒªï¼ˆåŒã˜ãƒ—ãƒ­ã‚»ã‚¹å†…ï¼‰ã ã¨ã€ã ã„ãŸã„ã“ã†æ€ã„ãŒã¡ğŸ‘‡

* å‘¼ã‚“ã ã‚‰ã™ãè¿”ã£ã¦ãã‚‹ï¼ˆé…ãã¦ã‚‚ä¸€å®šï¼‰ğŸƒâ€â™€ï¸ğŸ’¨
* å¤±æ•—ã—ãŸã‚‰ã€Œå®Ÿè¡Œã•ã‚Œã¦ãªã„ã€ã“ã¨ãŒå¤šã„ğŸ™…â€â™€ï¸
* 1å›æŠ¼ã—ãŸã‚‰1å›ã ã‘å‡¦ç†ã•ã‚Œã‚‹ï¼ˆé‡è¤‡ã—ãªã„ï¼‰ğŸ”˜
* å…ˆã«é€ã£ãŸæ–¹ãŒå…ˆã«åæ˜ ã•ã‚Œã‚‹ï¼ˆé †ç•ªã©ãŠã‚Šï¼‰ğŸ§µ

ã§ã‚‚ã€Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æŒŸã‚“ã ç¬é–“ã€ã“ã®å‰æãŒå£Šã‚Œã¾ã™ğŸ˜µâ€ğŸ’«

---

# 2) åˆ†æ•£ã§å£Šã‚Œã‚‹4å¤§ã‚ã‚‹ã‚ã‚‹ğŸ˜‡ï¼ˆä»Šæ—¥ã“ã“ã ã‘è¦šãˆã‚Œã°OKï¼‰

## â‘  é…å»¶ï¼ˆLatencyï¼‰â³ğŸ¢

å‘¼ã³å‡ºã—ãŒâ€œé…ã„â€ã ã‘ã§ã€ç”»é¢ã‚‚æ°—æŒã¡ã‚‚ä¸å®‰ã«ãªã‚Šã¾ã™ğŸ˜–
ã—ã‹ã‚‚é…ã•ã¯æ¯å›é•ã†ï¼ˆãƒ–ãƒ¬ã‚‹ï¼‰ã®ã§ã€äºˆæ¸¬ãŒå½“ãŸã‚Šã¾ã›ã‚“ğŸ²

## â‘¡ éƒ¨åˆ†æ•…éšœï¼ˆPartial Failureï¼‰ğŸ’¥ğŸ§©

ã€ŒAã¯ç”Ÿãã¦ã‚‹ã‘ã©BãŒæ­»ã‚“ã§ã‚‹ã€ã¿ãŸã„ãª**ä¸­é€”åŠç«¯ãªå¤±æ•—**ãŒèµ·ãã¾ã™ã€‚
å˜ä½“ã‚¢ãƒ—ãƒªã®â€œå…¨éƒ¨è½ã¡ã‚‹orå…¨éƒ¨OKâ€ã¨ã¯é•ã†ä¸–ç•ŒğŸŒ

## â‘¢ äºŒé‡é€ä¿¡ï¼ˆDuplicateï¼‰ğŸ“¨ğŸ“¨

ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸã‚‰ã€Œã‚‚ã†1å›é€ã‚ï¼ã€ã£ã¦ã‚„ã‚ŠãŸããªã‚‹ã‘ã©â€¦
**æœ€åˆã®è¦æ±‚ãŒã‚µãƒ¼ãƒãƒ¼å´ã§ã¯å‡¦ç†ã•ã‚Œã¦ãŸ**ã€ãŒæ™®é€šã«èµ·ãã¾ã™ğŸ˜±

## â‘£ é †åºã‚ºãƒ¬ï¼ˆOut-of-orderï¼‰ğŸ”€

å…ˆã«é€ã£ãŸã®ã«ã€ã‚ã¨ã‹ã‚‰é€ã£ãŸæ–¹ãŒå…ˆã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ã€Œæœ€å¾Œã«æ¥ãŸã‚„ã¤ã§ä¸Šæ›¸ãã€ã¿ãŸã„ãªé›‘è¨­è¨ˆã ã¨äº‹æ•…ã‚Šã‚„ã™ã„ğŸ”¥

---

# 3) ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šã‚ã–ã¨é…ã„APIã‚’ä½œã£ã¦ã€Œå¾…ã¡ã€ã‚’è¦‹ã‚‹ğŸ¢ğŸ‘€

ã“ã“ã§ã¯ã€Œé…ã„ã€ã€Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã€Œãƒªãƒˆãƒ©ã‚¤ã§äºŒé‡ã€ã‚’ä¸€æ°—ã«ä½“é¨“ã—ã¾ã™ğŸ’¡
ï¼ˆTypeScriptã¯å®‰å®šç‰ˆã¨ã—ã¦5.9ç³»ãŒé…å¸ƒã•ã‚Œã¦ã„ã¾ã™ã€‚([typescriptlang.org][1])ï¼‰

## 3-1) ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæœ€å°ï¼‰ğŸ§°âœ¨

ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã§ğŸ‘‡ï¼ˆPowerShellã§ã‚‚OKï¼‰

```bash
mkdir ch01-slow-api
cd ch01-slow-api
npm init -y
npm i express
npm i -D typescript tsx @types/express
```

> `tsx` ã¯TypeScriptã‚’ã‚µã‚¯ãƒƒã¨å®Ÿè¡Œã™ã‚‹ãŸã‚ã®é“å…·ã§ã™ï¼ˆé–‹ç™ºä½“é¨“ãŒè»½ã„ğŸ¥³ï¼‰ã€‚([LogRocket Blog][2])

---

## 3-2) é…ã„APIï¼ˆserver.tsï¼‰ã‚’ä½œã‚‹ğŸ› ï¸

```ts
import express from "express";
import { randomUUID } from "crypto";

const app = express();
app.use(express.json());

const sleep = (ms: number) => new Promise<void>((r) => setTimeout(r, ms));

app.get("/fast", (_req, res) => {
  res.json({ ok: true, kind: "fast", at: new Date().toISOString() });
});

app.get("/slow", async (req, res) => {
  const requestId = (req.header("x-request-id") ?? randomUUID()).toString();

  // 100ã€œ2000msã®ãƒ©ãƒ³ãƒ€ãƒ é…å»¶
  const delayMs = 100 + Math.floor(Math.random() * 1900);

  console.log(`[IN ] id=${requestId} delay=${delayMs}ms at=${new Date().toISOString()}`);

  await sleep(delayMs);

  console.log(`[OUT] id=${requestId} at=${new Date().toISOString()}`);
  res.json({ ok: true, kind: "slow", requestId, delayMs });
});

app.listen(3000, () => {
  console.log("http://localhost:3000");
});
```

èµ·å‹•ğŸ‘‡

```bash
npx tsx server.ts
```

---

## 3-3) ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆclient.tsï¼‰ã§ã€Œå¾…ã¡ã€ã¨ã€Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ã‚’è¦‹ã‚‹â³ğŸ’¥

```ts
const timeoutFetch = async (url: string, ms: number, headers: Record<string, string>) => {
  const ac = new AbortController();
  const t = setTimeout(() => ac.abort(), ms);

  const start = Date.now();
  try {
    const res = await fetch(url, { signal: ac.signal, headers });
    const body = await res.json();
    return { ok: true as const, took: Date.now() - start, body };
  } catch (e) {
    return { ok: false as const, took: Date.now() - start, error: String(e) };
  } finally {
    clearTimeout(t);
  }
};

const run = async () => {
  for (let i = 0; i < 8; i++) {
    const requestId = `req-${i}`; // ã‚ã–ã¨å›ºå®šIDã§è¦³å¯Ÿã—ã‚„ã™ãã™ã‚‹ğŸ“Œ
    const url = "http://localhost:3000/slow";

    // 700msã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ã—ã¦ã¿ã‚‹ï¼ˆçŸ­ã‚ï¼ï¼‰â±ï¸
    const r1 = await timeoutFetch(url, 700, { "x-request-id": requestId });

    console.log("1st", requestId, r1);

    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸã‚‰ã€Œã‚‚ã†1å›ï¼ã€ï¼ˆ=ãƒªãƒˆãƒ©ã‚¤ï¼‰ğŸ”
    // ã“ã‚ŒãŒâ€œäºŒé‡é€ä¿¡â€ã®å…¥å£â€¦ğŸ˜‡
    if (!r1.ok) {
      const r2 = await timeoutFetch(url, 700, { "x-request-id": requestId });
      console.log("retry", requestId, r2);
    }

    console.log("----");
  }
};

run().catch(console.error);
```

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡ŒğŸ‘‡

```bash
npx tsx client.ts
```

---

# 4) è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆğŸ‘€ğŸ”ï¼ˆã“ã“ãŒâ€œåˆ†æ•£ã®å…¥å£â€ï¼‰

## âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¦ã‚‚ã€ã‚µãƒ¼ãƒãƒ¼å´ã¯å‹•ã„ã¦ã‚‹ã‹ã‚‚ğŸ˜±

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã€Œå¾…ã¦ãªã„ï¼ã€ã£ã¦è«¦ã‚ãŸã ã‘ã§ã€ã‚µãƒ¼ãƒãƒ¼ã¯ã®ã‚“ã³ã‚Šå‡¦ç†ã—ã¦ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ğŸ¢
ãƒ­ã‚°ã§ `[IN]` ãŒå‡ºã¦ã‚‹ã®ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å¤±æ•—æ‰±ã„â€¦ã¿ãŸã„ãªã®ãŒè¦‹ãˆãŸã‚‰å¤§æˆåŠŸğŸ‰

## âœ… ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹ã¨ã€åŒã˜requestIdãŒ2å›å‡¦ç†ã•ã‚Œã†ã‚‹ğŸ“¨ğŸ“¨

ä»Šå›ã®ä¾‹ã¯ã€ŒåŒã˜IDã§é€ã‚Šç›´ã™ã€ã®ã§ã€ãƒ­ã‚°ã§åŒã˜idãŒè¤‡æ•°å›å‡ºãŸã‚‰
ã€ŒäºŒé‡é€ä¿¡ã£ã¦ã“ã†ã‚„ã£ã¦èµ·ãã‚‹ã‚“ã â€¦ğŸ˜‡ã€ãŒä½“æ„Ÿã§ãã¾ã™ã€‚

## âœ… â€œé…ã•ãŒæ¯å›é•ã†â€ã ã‘ã§ã€è¨­è¨ˆãŒé›£ã—ããªã‚‹ğŸ²

é€Ÿã„ã¨ãã¯ä¸€ç¬ã€é…ã„ã¨ãã¯æ•°ç§’â€¦ã¿ãŸã„ã«ãƒ–ãƒ¬ã¾ã™ã€‚
ã“ã®ãƒ–ãƒ¬ãŒã€UXãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ»æ··é›‘ã‚’å…¨éƒ¨ã‚„ã‚„ã“ã—ãã—ã¾ã™ğŸŒ€

---

# 5) AIï¼ˆCopilotç­‰ï¼‰ã§å­¦ã³ã‚’åŠ é€Ÿã™ã‚‹ã‚³ãƒ„ğŸ¤–âœ¨

## ãã®ã¾ã¾ä½¿ãˆã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ“

* ã€ŒExpress + TypeScriptã§ã€ãƒ©ãƒ³ãƒ€ãƒ é…å»¶å…¥ã‚Šã®GET /slow ã‚’ä½œã£ã¦ã€‚ãƒ­ã‚°ã«requestIdã¨å‡¦ç†æ™‚é–“ã‚’å‡ºã—ã¦ã€
* ã€ŒNodeã®fetchã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆAbortControllerï¼‰ä»˜ãã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œã£ã¦ã€‚ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã ã‘1å›ãƒªãƒˆãƒ©ã‚¤ã—ã¦ã€
* ã€Œã“ã®ã‚³ãƒ¼ãƒ‰ã®â€œäºŒé‡é€ä¿¡ãŒèµ·ãã‚‹ç†ç”±â€ã‚’ã€åˆå¿ƒè€…å‘ã‘ã«ç®‡æ¡æ›¸ãã§èª¬æ˜ã—ã¦ã€

## ä½¿ã„æ–¹ã®ã‚³ãƒ„ğŸ¯

* ç”Ÿæˆã—ã¦çµ‚ã‚ã‚Šã˜ã‚ƒãªãã¦ã€ã€Œãƒ­ã‚°ã®æ„å‘³ã‚’èª¬æ˜ã—ã¦ã€ã€Œã©ã“ãŒå±é™ºï¼Ÿã€ã£ã¦**è§£èª¬å½¹**ã«ã™ã‚‹ã®ãŒå¼·ã„ã§ã™ğŸ¤–ğŸ‘€

---

# 6) ã¡ã‚‡ã„æ³¨æ„ï¼ˆå®‰å…¨ï¼‰ğŸ›¡ï¸âš ï¸

æœ€è¿‘ã¯ã€Œæ±‚äººèª²é¡Œã£ã½ã„Gitãƒªãƒã‚¸ãƒˆãƒªã€ã‚’é–‹ã‹ã›ã¦æ”»æ’ƒã™ã‚‹äº‹ä¾‹ã‚‚å ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚çŸ¥ã‚‰ãªã„ãƒªãƒã‚¸ãƒˆãƒªã¯â€œä¿¡é ¼â€ã™ã‚‹å‰ã«å¿…ãšä¸­èº«ç¢ºèªã—ã‚ˆã†ã­ğŸ™([TechRadar][3])

---

# 7) ãƒŸãƒ‹ç·´ç¿’å•é¡Œâœï¸ğŸŒ¸ï¼ˆç­”ãˆã¤ãï¼‰

## Q1. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸã‚‰ã€Œã‚µãƒ¼ãƒãƒ¼å´ã‚‚çµ¶å¯¾ã«å‡¦ç†ã•ã‚Œã¦ã„ãªã„ã€ï¼Ÿ

* A. ã¯ã„
* B. ã„ã„ãˆ âœ…

**ç­”ãˆï¼šB**ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè«¦ã‚ãŸã ã‘ã§ã€ã‚µãƒ¼ãƒãƒ¼ã¯å‡¦ç†ã—ã¦ã‚‹ã‹ã‚‚ï¼‰

## Q2. ãƒªãƒˆãƒ©ã‚¤ãŒå±é™ºã«ãªã‚‹ä»£è¡¨ä¾‹ã¯ï¼Ÿ

* A. ç”»é¢ãŒç¶ºéº—ã«ãªã‚‹
* B. åŒã˜å‡¦ç†ãŒ2å›èµ°ã‚‹ âœ…

**ç­”ãˆï¼šB**ï¼ˆäºŒé‡é€ä¿¡ğŸ“¨ğŸ“¨ â†’ ãŠé‡‘ãƒ»åœ¨åº«ãƒ»ãƒã‚¤ãƒ³ãƒˆã¯ç‰¹ã«å±é™ºğŸ’¸ï¼‰

## Q3. ã€Œå…ˆã«é€ã£ãŸæ›´æ–°ãŒã€ã‚ã¨ã‹ã‚‰é€ã£ãŸæ›´æ–°ã‚ˆã‚Šå¾Œã«åæ˜ ã€ã•ã‚Œã‚‹ç¾è±¡ã¯ï¼Ÿ

* A. é †åºã‚ºãƒ¬ âœ…
* B. å‹æ¨è«–

**ç­”ãˆï¼šA**ï¼ˆOut-of-orderğŸ”€ï¼‰

---

# 8) ã“ã®ç« ã§æ‰‹ã«å…¥ã‚‹â€œæ„Ÿè¦šâ€ğŸâœ¨

* åˆ†æ•£ã¯ã¾ãšã€Œé…ã„ã€ã‹ã‚‰å§‹ã¾ã‚‹â³
* ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯â€œå¤±æ•—â€ã˜ã‚ƒãªãâ€œå¾…ã¦ãªã‹ã£ãŸâ€ã ã‘ã‹ã‚‚ğŸ˜‡
* ãƒªãƒˆãƒ©ã‚¤ã¯äºŒé‡é€ä¿¡ã®å…¥å£ğŸ”ğŸ“¨
* é †åºã‚‚ä¿è¨¼ã•ã‚Œãªã„å‰æãŒå¿…è¦ğŸ”€

æ¬¡ç« ã‹ã‚‰ã¯ã€ã“ã®å®Ÿé¨“ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€Œå®Ÿé¨“ç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‹ã€ã‚’ä½œã£ã¦ã€ã©ã‚“ã©ã‚“å£Šã—ã¦ç›´ã—ã¦ã„ãã¾ã™ğŸ§ªğŸ”¨âœ…

ï¼ˆå‚è€ƒï¼šNodeã¯å¶æ•°ãƒ¡ã‚¸ãƒ£ãƒ¼ãŒLTSã«ãªã‚Šã‚„ã™ãã€ç¾è¡Œã®LTSçŠ¶æ³ã¯å…¬å¼ã®ãƒªãƒªãƒ¼ã‚¹è¡¨ã§ç¢ºèªã§ãã¾ã™ã€‚([nodejs.org][4])ï¼‰

[1]: https://www.typescriptlang.org/download/?utm_source=chatgpt.com "How to set up TypeScript"
[2]: https://blog.logrocket.com/running-typescript-node-js-tsx-vs-ts-node-vs-native/?utm_source=chatgpt.com "Running TypeScript in Node.js: tsx vs. ts-node vs. native"
[3]: https://www.techradar.com/pro/security/north-korean-hackers-target-microsoft-virtual-studio-code?utm_source=chatgpt.com "North Korean hackers target Microsoft Virtual Studio Code"
[4]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
