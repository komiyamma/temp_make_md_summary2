# ç¬¬21ç« ï¼šç«¶åˆã®æ­£ä½“ï¼ˆåŒæ™‚æ›´æ–°ã§å£Šã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ğŸ’¥âš”ï¸

## 21.1 ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ğŸ¯âœ¨

ã“ã®ç« ãŒçµ‚ã‚ã‚‹ã¨ã€ã“ã‚“ãªã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ğŸ‘‡ğŸ˜Š

* ã€Œç«¶åˆï¼ˆã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆï¼‰ã€ã‚’ **ã‚ã–ã¨å†ç¾** ã§ãã‚‹ğŸ§ªğŸ’¥
* ç«¶åˆãŒèµ·ãã‚‹ã¨ä½•ãŒå£Šã‚Œã‚‹ã‹ã‚’ **è¨€è‘‰ã§èª¬æ˜** ã§ãã‚‹ğŸ—£ï¸ğŸ“Œ
* ãƒ†ã‚¹ãƒˆã§ã€Œå£Šã‚Œæ–¹ã€ã‚’å›ºå®šåŒ–ã—ã¦ã€**åŸå› ã‚’åˆ†é¡**ã§ãã‚‹ğŸ”ğŸ§ 

---

## 21.2 ç«¶åˆã£ã¦ãªã«ï¼Ÿï¼ˆè¶…ã–ã£ãã‚Šï¼‰ğŸ§ ğŸ”€

**ç«¶åˆ**ã¯ä¸€è¨€ã§ã„ã†ã¨ğŸ‘‡

> ã€Œã»ã¼åŒæ™‚ã«ã€åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ã€çµæœãŒå£Šã‚Œã‚‹ã“ã¨ã€ğŸ’£

åˆ†æ•£ã¨ã‹æœ€çµ‚çš„æ•´åˆæ€§ã ã¨ã€ã“ã‚ŒãŒã‚ã¡ã‚ƒèµ·ãã‚„ã™ã„ã§ã™ğŸ˜µâ€ğŸ’«
ç†ç”±ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã€**æ›´æ–°ãŒ1æœ¬é“ã˜ã‚ƒãªã„**ã‹ã‚‰ğŸ‘‡

* å—ä»˜APIï¼ˆæ—©ãè¿”ã™ï¼‰ã¨ã€å¾Œå‡¦ç†Workerï¼ˆã‚ã¨ã§åæ˜ ï¼‰ãŒåˆ¥ğŸ§µ
* ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã§é †åºãŒã‚ºãƒ¬ã‚‹â³ğŸ”€
* ãƒªãƒˆãƒ©ã‚¤ã§åŒã˜å‡¦ç†ãŒè¤‡æ•°å›èµ°ã‚‹ğŸ”âš ï¸

---

## 21.3 ç«¶åˆã®ã€Œ3å¤§ãƒ»å£Šã‚Œæ–¹ã€ğŸ’¥ğŸ’¥ğŸ’¥

ã“ã®ç« ã§ã¯ã€ã¾ãš **å£Šã‚Œæ–¹ã®å‹** ã‚’è¦šãˆã¾ã™ğŸ§©âœ¨
ï¼ˆå‹ãŒåˆ†ã‹ã‚‹ã¨ã€ç¾å ´ã§ã‚‚åŸå› ãŒè¿½ã„ã‚„ã™ã„ã‚ˆã€œğŸ˜Šï¼‰

### A) Lost Updateï¼ˆæ›´æ–°ã®å–ã‚Šã“ã¼ã—ï¼‰ğŸ•³ï¸ğŸ’”

**ã‚ã‚ŠãŒã¡No.1**
ã€Œèª­ã‚“ã§â†’è¨ˆç®—ã—ã¦â†’æ›¸ãã€ã®é€”ä¸­ã§ã€åˆ¥ã®æ›´æ–°ãŒå‰²ã‚Šè¾¼ã‚€ã‚„ã¤ğŸ˜±

ä¾‹ï¼šåœ¨åº«ãŒ1ã®ã¨ãã«ã€2äººãŒåŒæ™‚ã«è²·ã†ğŸ›’ğŸ›’

* 2äººã¨ã‚‚ã€Œåœ¨åº«1ã‚ã‚‹ï¼ã€ã¨è¦‹ãˆã‚‹ğŸ‘€
* 2äººã¨ã‚‚æ³¨æ–‡OKã«ãªã‚‹âœ…âœ…
* çµæœï¼š**åœ¨åº«ã¯0ã®ã¾ã¾ãªã®ã«ã€æ³¨æ–‡ãŒ2ä»¶é€šã‚‹**ï¼ˆå®Ÿè³ªâ€œå£²ã‚Šéãâ€ï¼‰ğŸ’€

---

### B) äºŒé‡åæ˜ ï¼ˆDouble Applyï¼‰ğŸ“¨ğŸ“¨â¡ï¸ğŸ’¥

ãƒªãƒˆãƒ©ã‚¤ã‚„é‡è¤‡é…é”ã§ã€**åŒã˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’2å›åæ˜ **ã—ã¡ã‚ƒã†ã‚„ã¤ğŸ˜µ

ä¾‹ï¼š

* ã€Œãƒã‚¤ãƒ³ãƒˆ+10ã€ã‚¤ãƒ™ãƒ³ãƒˆãŒ2å›å‡¦ç†ã•ã‚Œã¦ +20 ã«ãªã‚‹ğŸâ¡ï¸ğŸğŸ
* ã€Œåœ¨åº«-1ã€ã‚¤ãƒ™ãƒ³ãƒˆãŒ2å›å‡¦ç†ã•ã‚Œã¦åœ¨åº«ãŒæ¸›ã‚Šã™ãã‚‹ğŸ“‰ğŸ’¥

---

### C) å–ã‚Šæ¶ˆã—æ¼ã‚Œï¼ˆCancel Leakï¼‰ğŸ§¨ğŸ•³ï¸

ã€Œå–ã‚Šæ¶ˆã—ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ã€ãŒ **åæ˜ ã•ã‚Œãªã„/é…ã‚Œã‚‹/é †åºãŒé€†** ã«ãªã‚‹ã‚„ã¤ğŸ˜±

ä¾‹ï¼š

* æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã®ã«ã€åœ¨åº«ãŒæˆ»ã‚‰ãªã„ï¼ˆæˆ»ã—ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¬ è½ï¼‰ğŸ“¦âŒ
* ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€â†’ã€Œç¢ºå®šã€ãŒé€†é †ã«åˆ°ç€ã—ã¦ã€çµå±€ç¢ºå®šã«ãªã£ã¡ã‚ƒã†ğŸ”€ğŸ˜‡ğŸ’¥

---

## 21.4 ãƒãƒ³ã‚ºã‚ªãƒ³ğŸ§ªï¼šLost Update ã‚’ â€œç¢ºå®Ÿã«â€ èµ·ã“ã™ãƒ†ã‚¹ãƒˆã‚’ä½œã‚ã†ğŸ’¥âš”ï¸

ã“ã“ã‹ã‚‰ã¯æ‰‹ã‚’å‹•ã‹ã—ã¾ã™âœ‹âœ¨
ç‹™ã„ã¯ã“ã‚ŒğŸ‘‡

* **åŒæ™‚æ›´æ–°**ã§å£Šã‚Œã‚‹
* ã—ã‹ã‚‚ **ãƒ†ã‚¹ãƒˆã§æ¯å›å†ç¾**ã§ãã‚‹ï¼ˆå¤§äº‹ï¼ï¼‰ğŸ¯

### ä»Šå›ã®é¡ŒæğŸ›’ğŸ“¦

**åœ¨åº«äºˆç´„ï¼ˆreserveï¼‰** ã‚’ä½œã‚Šã¾ã™ã€‚

* åˆæœŸåœ¨åº«ï¼š`1`
* åŒæ™‚ã«2ã¤äºˆç´„è¦æ±‚ãŒæ¥ã‚‹ï¼š`qty=1` ã¨ `qty=1`
* æ­£å¸¸ãªã‚‰ï¼šç‰‡æ–¹ã ã‘æˆåŠŸ âœ… / ã‚‚ã†ç‰‡æ–¹ã¯å¤±æ•— âŒ
* ã§ã‚‚ãƒŠã‚¤ãƒ¼ãƒ–å®Ÿè£…ã ã¨ï¼šä¸¡æ–¹æˆåŠŸã—ãŒã¡ âœ…âœ…ï¼ˆ= å£²ã‚Šéãï¼‰ğŸ’€

---

## 21.5 å®Ÿè£…â‘ ï¼šã‚ã–ã¨å£Šã‚Œã‚‹ã€ŒãƒŠã‚¤ãƒ¼ãƒ–åœ¨åº«ãƒªãƒã‚¸ãƒˆãƒªã€ğŸ§¨

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã“ğŸ‘‡

* ã€Œåœ¨åº«ã‚’èª­ã‚€ã€
* **ã¡ã‚‡ã£ã¨å¾…ã¤ï¼ˆã“ã“ãŒç½ ï¼‰**â³
* ã€Œåœ¨åº«ã‚’æ›¸ãæˆ»ã™ã€

ã“ã® â€œå¾…ã¡â€ ã®é–“ã«åˆ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‰²ã‚Šè¾¼ã‚€ã¨ã€ç«¶åˆã—ã¾ã™ğŸ’¥

```ts
// apps/api/src/inventory/inventoryRepo.ts
export type Reservation = { orderId: string; sku: string; qty: number };

const sleep = (ms: number) => new Promise<void>(r => setTimeout(r, ms));
const jitter = (min: number, max: number) =>
  Math.floor(Math.random() * (max - min + 1)) + min;

export class InventoryRepoNaive {
  private stock = new Map<string, number>();
  private reservations: Reservation[] = [];

  seed(sku: string, qty: number) {
    this.stock.set(sku, qty);
    this.reservations = [];
  }

  snapshot(sku: string) {
    return {
      sku,
      stock: this.stock.get(sku) ?? 0,
      reservations: [...this.reservations],
    };
  }

  async reserve(sku: string, orderId: string, qty: number) {
    const current = this.stock.get(sku) ?? 0;

    if (current < qty) {
      return { ok: false as const, reason: "OUT_OF_STOCK" as const };
    }

    // âœ… ã“ã“ãŒç«¶åˆãƒã‚¤ãƒ³ãƒˆï¼šread -> (await) -> write
    await sleep(jitter(10, 40));

    this.stock.set(sku, current - qty);
    this.reservations.push({ sku, orderId, qty });

    return { ok: true as const };
  }
}
```

---

## 21.6 å®Ÿè£…â‘¡ï¼šAPIãƒ«ãƒ¼ãƒˆï¼ˆåœ¨åº«äºˆç´„ï¼‰ğŸšªâœ¨

Fastifyã§ `POST /inventory/:sku/reserve` ã‚’ä½œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ˜Š
ï¼ˆFastifyã¯è»½é‡ã§é€Ÿã„ã®ãŒå£²ã‚Šã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã ã‚ˆã€œâš¡ ([Fastify][1])ï¼‰

```ts
// apps/api/src/app.ts
import Fastify from "fastify";
import { InventoryRepoNaive } from "./inventory/inventoryRepo";

export function buildApp(repo: InventoryRepoNaive) {
  const app = Fastify({ logger: false });

  app.post<{
    Params: { sku: string };
    Body: { orderId: string; qty: number };
  }>("/inventory/:sku/reserve", async (req, reply) => {
    const { sku } = req.params;
    const { orderId, qty } = req.body;

    const result = await repo.reserve(sku, orderId, qty);

    if (!result.ok) {
      return reply.code(409).send({ ok: false, reason: result.reason });
    }
    return reply.code(200).send({ ok: true });
  });

  return app;
}
```

---

## 21.7 å®Ÿè£…â‘¢ï¼šåŒæ™‚æ›´æ–°ãƒ†ã‚¹ãƒˆï¼ˆã¾ãšã¯â€œãŸã¾ã«å£Šã‚Œã‚‹â€ç‰ˆï¼‰ğŸ²ğŸ’¥

ã“ã“ã§ã¯ Vitest ã‚’ä½¿ã„ã¾ã™ğŸ§ª
Vitestã¯ Viteç”±æ¥ã§ã€TSã®ãƒ†ã‚¹ãƒˆãŒã‚„ã‚Šã‚„ã™ã„ç³»ã®ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç’°å¢ƒã ã‚ˆã€œğŸ˜Š ([Vitest][2])

```ts
// apps/api/test/conflict.lost-update.flaky.test.ts
import { describe, test, expect } from "vitest";
import { InventoryRepoNaive } from "../src/inventory/inventoryRepo";
import { buildApp } from "../src/app";

describe("ç«¶åˆï¼ˆflakyç‰ˆï¼‰", () => {
  test("åœ¨åº«1ã«å¯¾ã—ã¦åŒæ™‚ã«2ä»¶äºˆç´„ã™ã‚‹ã¨ã€ç‰‡æ–¹ã¯å¤±æ•—ã—ã¦ã»ã—ã„ï¼ˆã§ã‚‚å£Šã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ï¼‰", async () => {
    const repo = new InventoryRepoNaive();
    repo.seed("sku-1", 1);

    const app = buildApp(repo);

    const req1 = app.inject({
      method: "POST",
      url: "/inventory/sku-1/reserve",
      payload: { orderId: "order-A", qty: 1 },
    });
    const req2 = app.inject({
      method: "POST",
      url: "/inventory/sku-1/reserve",
      payload: { orderId: "order-B", qty: 1 },
    });

    const [r1, r2] = await Promise.all([req1, req2]);

    const okCount = [r1.statusCode, r2.statusCode].filter(s => s === 200).length;

    // âœ… æ­£å¸¸ãªã‚‰ 1ä»¶ã ã‘æˆåŠŸã®ã¯ãš
    expect(okCount).toBe(1);

    // è¦³å¯Ÿç”¨
    const snap = repo.snapshot("sku-1");
    // console.log(snap);
  });
});
```

### å®Ÿè¡Œã—ã¦ã¿ã‚‹ğŸ®

```bash
npm test
```

ğŸŒ€ ã“ã“ã§èµ·ããŒã¡ãªã®ãŒâ€¦

* ãŸã¾ã«é€šã‚‹âœ…
* ãŸã¾ã«è½ã¡ã‚‹âŒ
* ã¤ã¾ã‚Šã€Œ**ãƒ•ãƒ¬ãƒ¼ã‚¯ï¼ˆæ°—ã¾ãã‚Œï¼‰**ã€ğŸ˜µâ€ğŸ’«

ã§ã‚‚ç¾å ´ã®ç«¶åˆã£ã¦ã€ã“ã†ã„ã† â€œãŸã¾ã«â€ ãŒä¸€ç•ªæ€–ã„ã‚“ã ã‚ˆã­â€¦ğŸ˜‡ğŸ’£

---

## 21.8 â€œæ¯å›â€ å£Šã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆå†ç¾æ€§ã‚’ä½œã‚‹ï¼‰ğŸ¯âœ¨

ã€ŒãŸã¾ã«å¤±æ•—ã€ã ã¨å­¦ã³ã¥ã‚‰ã„ã®ã§ã€**ç¢ºå®Ÿã«ç«¶åˆã•ã›ã‚‹ä»•æ›ã‘**ã‚’å…¥ã‚Œã¾ã™ğŸ§ª

### ãƒãƒªã‚¢ï¼ˆå¾…ã¡åˆã‚ã›ï¼‰ã‚’ä½œã‚‹ğŸš§ğŸ§µ

ã€Œ2ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã€ä¸¡æ–¹ã¨ã‚‚èª­ã¿çµ‚ã‚ã‚‹ã¾ã§å¾…ã¤ã€â†’ ãã‚Œã‹ã‚‰åŒæ™‚ã«æ›¸ãğŸ’¥

```ts
// apps/api/src/inventory/barrier.ts
export class Barrier {
  private waiting = 0;
  private resolver: (() => void) | null = null;

  async arriveAndWait(parties: number) {
    this.waiting++;

    if (this.waiting === parties) {
      // å…¨å“¡æƒã£ãŸã‚‰ä¸€æ–‰è§£æ”¾
      const r = this.resolver;
      this.resolver = null;
      this.waiting = 0;
      r?.();
      return;
    }

    await new Promise<void>(resolve => {
      this.resolver = resolve;
    });
  }
}
```

### ãƒŠã‚¤ãƒ¼ãƒ–Repoã«ã€Œãƒãƒªã‚¢ã‚’æŒŸã‚ã‚‹ç‰ˆã€ã‚’è¶³ã™ğŸ§¨

```ts
// apps/api/src/inventory/inventoryRepoWithBarrier.ts
import { Barrier } from "./barrier";

export class InventoryRepoNaiveWithBarrier {
  private stock = new Map<string, number>();
  private reservations: { orderId: string; sku: string; qty: number }[] = [];
  constructor(private barrier: Barrier) {}

  seed(sku: string, qty: number) {
    this.stock.set(sku, qty);
    this.reservations = [];
  }

  snapshot(sku: string) {
    return { stock: this.stock.get(sku) ?? 0, reservations: [...this.reservations] };
  }

  async reserve(sku: string, orderId: string, qty: number) {
    const current = this.stock.get(sku) ?? 0;
    if (current < qty) return { ok: false as const, reason: "OUT_OF_STOCK" as const };

    // âœ… 2ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã€Œèª­ã‚“ã ã€æ™‚ç‚¹ã§å¾…ã¡åˆã‚ã›
    await this.barrier.arriveAndWait(2);

    this.stock.set(sku, current - qty);
    this.reservations.push({ sku, orderId, qty });
    return { ok: true as const };
  }
}
```

### â€œå¿…ãšè½ã¡ã‚‹â€ ãƒ†ã‚¹ãƒˆã«ã™ã‚‹ğŸ§ªğŸ’¥

```ts
// apps/api/test/conflict.lost-update.deterministic.test.ts
import { describe, test, expect } from "vitest";
import { Barrier } from "../src/inventory/barrier";
import { InventoryRepoNaiveWithBarrier } from "../src/inventory/inventoryRepoWithBarrier";
import { buildApp } from "../src/app";

describe("ç«¶åˆï¼ˆå†ç¾æ€§100%ï¼‰", () => {
  test("åœ¨åº«1ãªã®ã«2ä»¶æˆåŠŸã—ã¦ã—ã¾ã†ï¼ˆå£²ã‚Šéãï¼‰", async () => {
    const barrier = new Barrier();
    const repo = new InventoryRepoNaiveWithBarrier(barrier);
    repo.seed("sku-1", 1);

    const app = buildApp(repo as any);

    const [r1, r2] = await Promise.all([
      app.inject({
        method: "POST",
        url: "/inventory/sku-1/reserve",
        payload: { orderId: "order-A", qty: 1 },
      }),
      app.inject({
        method: "POST",
        url: "/inventory/sku-1/reserve",
        payload: { orderId: "order-B", qty: 1 },
      }),
    ]);

    // âœ… ãƒŠã‚¤ãƒ¼ãƒ–ã ã¨ä¸¡æ–¹200ã«ãªã‚ŠãŒã¡ï¼ˆ=å£Šã‚Œã¦ã‚‹ï¼‰
    expect(r1.statusCode).toBe(200);
    expect(r2.statusCode).toBe(200);

    const snap = repo.snapshot("sku-1");
    // åœ¨åº«ã¯0ã«è¦‹ãˆã‚‹ã‘ã©ã€äºˆç´„ãŒ2ä»¶ã‚ã‚‹ â†’ å£²ã‚ŠéãçŠ¶æ…‹ğŸ’€
    expect(snap.stock).toBe(0);
    expect(snap.reservations.length).toBe(2);
  });
});
```

ğŸ‰ ã“ã‚Œã§ã€Œç«¶åˆã£ã¦ã“ã†å£Šã‚Œã‚‹ï¼ã€ãŒã€æ¯å›è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ‘âœ¨

---

## 21.9 å£Šã‚Œæ–¹ã‚’ â€œè¨€èªåŒ–â€ ã—ã‚ˆã†ğŸ—£ï¸ğŸ“Œï¼ˆè¶…é‡è¦ï¼‰

ä»Šã®çŠ¶æ…‹ã‚’ä¸€è¨€ã§è¨€ã†ã¨ğŸ‘‡

* **åœ¨åº«ã®æœ€çµ‚å€¤ã ã‘è¦‹ã¦ã‚‚ã€äº‹æ•…ã«æ°—ã¥ã‘ãªã„**ğŸ˜‡
* ã§ã‚‚ **å±¥æ­´ï¼ˆäºˆç´„ã®ä»¶æ•°ï¼‰**ã‚’è¦‹ã‚‹ã¨äº‹æ•…ãŒãƒãƒ¬ã‚‹ğŸ’¥

ã¤ã¾ã‚Šã€ç«¶åˆã®æ€–ã•ã¯ğŸ‘‡

* ã€ŒDBã®1ã¤ã®æ•°å­—ã€ã˜ã‚ƒãªãã¦
* ã€Œæ³¨æ–‡ãƒ»åœ¨åº«ãƒ»æ±ºæ¸ˆã®æ•´åˆã€ã¿ãŸã„ãª **è¤‡æ•°ã®æ•´åˆæ¡ä»¶ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰** ã‚’å£Šã™ã¨ã“ã‚ğŸ§©ğŸ’£

ã“ã® â€œå£Šã‚ŒãŸä¸å¤‰æ¡ä»¶â€ ã‚’ã€æ¬¡ç« ã§ã©ã†ç›´ã™ã‹ã‚„ã‚Šã¾ã™ğŸ›ï¸ğŸ§ 

---

## 21.10 ç«¶åˆã®åŒ‚ã„ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆğŸ‘ƒâš ï¸

ã‚³ãƒ¼ãƒ‰ã«ã“ã‚ŒãŒã‚ã£ãŸã‚‰è¦æ³¨æ„ã§ã™ğŸ˜±

* `const x = await read();` ã®ã‚ã¨ã« `await` ãŒæŒŸã¾ã£ã¦ã‹ã‚‰ `await write(x - 1)` ğŸ•³ï¸
* ã€Œä¸Šæ›¸ãã€ã§çŠ¶æ…‹ã‚’ä½œã£ã¦ã‚‹ï¼ˆå±¥æ­´ã˜ã‚ƒãªã„ï¼‰ğŸ§»ğŸ’¥
* ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹ã®ã«ã€ŒåŒã˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’2å›å‡¦ç†ã—ã¦ã‚‚OKã€ã®è¨­è¨ˆãŒãªã„ğŸ”âŒ
* â€œã‚­ãƒ£ãƒ³ã‚»ãƒ«â€ ãŒåˆ¥çµŒè·¯ï¼ˆåˆ¥ã‚­ãƒ¥ãƒ¼/åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã§æˆ»ã™æ§‹é€ ã«ãªã£ã¦ã‚‹ğŸ§¨ğŸ•³ï¸

---

## 21.11 AIæ´»ç”¨ğŸ¤–âœ¨ï¼šç«¶åˆãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’é‡ç”£ã—ã‚ˆã†ğŸ§ª

Copilot / Codex ã«æŠ•ã’ã‚‹ã¨ä¾¿åˆ©ãªæŒ‡ç¤ºä¾‹ã§ã™ğŸ‘‡ğŸ’¬

### â‘  ç«¶åˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¢—ã‚„ã™ğŸ§ 

* ã€Œåœ¨åº«äºˆç´„ã§ lost update ãŒèµ·ãã‚‹ãƒ†ã‚¹ãƒˆã‚’ã€3ãƒ‘ã‚¿ãƒ¼ãƒ³ä½œã£ã¦ã€‚ä¸¦åˆ—æ•°ã‚’2/5/20ã«ã—ã¦ã€è¦³æ¸¬ãƒã‚¤ãƒ³ãƒˆã‚‚å…¥ã‚Œã¦ã€

### â‘¡ ä¸å¤‰æ¡ä»¶ã‚’åˆ—æŒ™ã™ã‚‹ğŸ“Œ

* ã€Œæ³¨æ–‡ãƒ»åœ¨åº«ãƒ»æ±ºæ¸ˆã®ä¸å¤‰æ¡ä»¶ï¼ˆç ´ã‚ŒãŸã‚‰äº‹æ•…ï¼‰ã‚’10å€‹ã€ECã®ä¾‹ã§å‡ºã—ã¦ã€

### â‘¢ å–ã‚Šæ¶ˆã—æ¼ã‚Œç³»ã‚‚ä½œã‚‹ğŸ§¨

* ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¬ è½/é…å»¶/é€†é †ã®ã¨ãã«å£Šã‚Œã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’5å€‹ã€‚æœ€å°ã®å†ç¾ã‚³ãƒ¼ãƒ‰æ¡ˆã‚‚ã€

ğŸ’¡ã‚³ãƒ„ï¼šAIã®å‡ºåŠ›ã¯ãã®ã¾ã¾æ¡ç”¨ã›ãšã€
**â€œãªãœãã®ãƒ†ã‚¹ãƒˆãŒå¿…è¦ï¼Ÿâ€** ã‚’1è¡Œã§æ›¸ãè¶³ã™ã¨ç†è§£ãŒä¼¸ã³ã¾ã™ğŸ§ âœ¨

---

## 21.12 ãƒŸãƒ‹ç†è§£ãƒã‚§ãƒƒã‚¯âœï¸âœ¨ï¼ˆç­”ãˆã¤ãï¼‰

### Q1ï¼šåœ¨åº«1ãªã®ã«2ã¤ã®æ³¨æ–‡ãŒæˆåŠŸã—ãŸã€‚ã“ã‚Œã¯ã©ã‚Œï¼Ÿ

A. Lost Update ğŸ•³ï¸ğŸ’”
B. äºŒé‡åæ˜  ğŸ“¨ğŸ“¨
C. å–ã‚Šæ¶ˆã—æ¼ã‚Œ ğŸ§¨ğŸ•³ï¸
âœ… **ç­”ãˆï¼šA**ï¼ˆâ€œåŒã˜åœ¨åº«ã‚’è¦‹ãŸâ€ã®ãŒæ ¹ã£ã“ï¼‰

### Q2ï¼šã€Œãƒã‚¤ãƒ³ãƒˆ+10ã€ã‚¤ãƒ™ãƒ³ãƒˆãŒé‡è¤‡é…é”ã•ã‚Œã¦ã€+20ã«ãªã£ãŸã€‚ã“ã‚Œã¯ï¼Ÿ

âœ… **ç­”ãˆï¼šB**

### Q3ï¼šã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã®ã«åœ¨åº«ãŒæˆ»ã‚‰ãªã„ï¼ˆæˆ»ã™ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ãªã„ï¼‰ã€‚ã“ã‚Œã¯ï¼Ÿ

âœ… **ç­”ãˆï¼šC**

---

## 21.13 ãŠã¾ã‘ï¼šæœ€è¿‘ã®Node/TSã¾ã‚ã‚Šãƒ¡ãƒ¢ğŸ“ŒğŸ†•

ï¼ˆæ•™æã‚’2026å¹´ã£ã½ãä¿ã¤ãŸã‚ã®è»½ã„ãƒ¡ãƒ¢ã ã‚ˆğŸ˜ŠğŸ§¾ï¼‰

* Node.js ã¯ **v24 ãŒ Active LTS**ã€v25 ãŒ Current ã¨ã—ã¦æ›´æ–°ã•ã‚Œã¦ã‚‹ã‚ˆğŸŸ©âš™ï¸ ([Node.js][3])
* TypeScript ã¯ npm ä¸Šã§ **5.9 ç³»**ãŒæä¾›ã•ã‚Œã¦ã„ã¦ã€Nodeå‘ã‘ã® `--module node18` / `--module node20` ã¿ãŸã„ãª â€œå›ºå®šãƒ•ãƒ©ã‚°â€ ã®è©±ã‚‚å¢—ãˆã¦ã‚‹ã‚ˆğŸ§©âœ¨ ([npmjs.com][4])
* ãƒ†ã‚¹ãƒˆã¯ Vitest ãŒã€ŒViteç”±æ¥ã§è¨­å®šãŒé¦´æŸ“ã¿ã‚„ã™ã„ã€ç³»ã¨ã—ã¦æ¡ˆå†…ã•ã‚Œã¦ã‚‹ğŸ§ªâœ¨ ([Vitest][2])

---

## 21.14 ã“ã®ç« ã®ã¾ã¨ã‚ï¼ˆçµè«–1è¡Œï¼‰âœï¸âœ¨

**ç«¶åˆã¯ â€œãŸã¾ãŸã¾å£Šã‚Œã‚‹â€ ã‹ã‚‰æ€–ã„ã€‚ã ã‹ã‚‰ãƒ†ã‚¹ãƒˆã§ â€œæ¯å›å£Šã‚Œã‚‹å½¢â€ ã«ã—ã¦ã€å£Šã‚Œæ–¹ï¼ˆå‹ï¼‰ã‚’æ´ã‚€ï¼** ğŸ’¥ğŸ§ªâœ…

[1]: https://fastify.io/?utm_source=chatgpt.com "Fastify: Fast and low overhead web framework, for Node.js"
[2]: https://vitest.dev/?utm_source=chatgpt.com "Vitest | Next Generation testing framework"
[3]: https://nodejs.org/en/about/previous-releases?utm_source=chatgpt.com "Node.js Releases"
[4]: https://www.npmjs.com/package/typescript?utm_source=chatgpt.com "TypeScript"
