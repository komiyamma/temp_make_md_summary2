# ç¬¬36ç«  åˆ¤åˆ¥å¯èƒ½Unionï¼ˆswitchã®å–ã‚Šã“ã¼ã—é˜²æ­¢ï¼‰ğŸ§·âœ…

## ã­ã‚‰ã„ğŸ¯

* ã€Œåˆ†å²ã®æŠœã‘ã€ã‚’**ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼**ã§æ­¢ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹âœ…
* `switch` ã§ **å‹ã®çµã‚Šè¾¼ã¿ï¼ˆnarrowingï¼‰**ãŒåŠ¹ãæ°—æŒã¡ã‚ˆã•ã‚’ä½“é¨“ã™ã‚‹ğŸ˜†âœ¨
* ã€Œã‚ã‚Šãˆãªã„çŠ¶æ…‹ã€ã‚’å‹ã§ä½œã‚Œãªãã—ã¦ã€ãƒã‚°ã®èŠ½ã‚’ã¤ã‚€ğŸŒ±ğŸ›¡ï¸

---

## ä»Šæ—¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ğŸ§©

* **åˆ¤åˆ¥å¯èƒ½Unionï¼ˆDiscriminated Unionï¼‰**ï¼šå…±é€šã®ã‚¿ã‚°ï¼ˆä¾‹ï¼š`type` / `kind`ï¼‰ã§åŒºåˆ¥ã§ãã‚‹Unionå‹ğŸ§·
* **ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆexhaustiveness checkï¼‰**ï¼šåˆ†å²æ¼ã‚ŒãŒã‚ã£ãŸã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§è½ã¨ã™ä»•çµ„ã¿âœ…
* **`never`**ï¼šã“ã“ã«æ¥ã‚‹ã®ã¯ã€Œã‚ã‚Šãˆãªã„ã€ï¼æ¥ãŸã‚‰åˆ†å²æ¼ã‚ŒğŸ’¥ ([TypeScript][1])
* **`satisfies`**ï¼šå‹ã‚’â€œæº€ãŸã—ã¦ã‚‹ã‹â€ã ã‘ãƒã‚§ãƒƒã‚¯ã—ã¦ã€å€¤ã®æƒ…å ±ã¯ã§ãã‚‹ã ã‘ä¿ã¤âœ¨ ([Zenn][2])

---

## ã¾ãšçµè«–ğŸ’¡ï¼šã“ã†æ›¸ã‘ã‚‹ã¨å‹ã¡ğŸ†

ã€Œã‚¿ã‚°ã§åˆ†ã‘ã‚‹ã€ï¼‹ã€Œæœ€å¾Œã« `never` ã§æ­¢ã‚ã‚‹ã€
ã“ã‚Œã§ **ã‚±ãƒ¼ã‚¹è¿½åŠ æ¼ã‚Œ**ãŒå³ãƒãƒ¬ã™ã‚‹ã‚ˆğŸ‘€âœ… ([TypeScript][1])

---

## ãƒ“ãƒ•ã‚©ãƒ¼ï¼šã‚ˆãã‚ã‚‹ã€Œå–ã‚Šã“ã¼ã—åœ°é›·ã€ğŸ’£ğŸ˜µ

`status` ãŒæ–‡å­—åˆ—ã§ã€å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã€Œãªã‚“ã¨ãªã optionalã€ã«ãªã£ã¦ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚
ã“ã†ãªã‚‹ã¨ **ã‚ã‚Šãˆãªã„çŠ¶æ…‹**ãŒä½œã‚Œã¡ã‚ƒã†â€¦ğŸ¥²

```typescript
// âŒ ãƒ“ãƒ•ã‚©ãƒ¼ï¼šçŠ¶æ…‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒãµã‚ã£ã¨ã—ã¦ã‚‹
type ApiResponse = {
  status: "loading" | "success" | "error";
  data?: { userName: string };
  errorMessage?: string;
};

function render(res: ApiResponse): string {
  switch (res.status) {
    case "loading":
      return "Loading... â³";
    case "success":
      // ã“ã“ã€dataãŒç„¡ã„å¯èƒ½æ€§ãŒæ®‹ã‚‹ï¼ˆå®Ÿè¡Œæ™‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã®åŒ‚ã„ğŸ‘ƒï¼‰
      return `Hello, ${res.data!.userName} ğŸ‘‹`;
    // ğŸ˜± "error" ã‚’æ›¸ãå¿˜ã‚Œã¦ã‚‚ã€æ™®é€šã«ãƒ“ãƒ«ãƒ‰é€šã£ã¡ã‚ƒã†ã“ã¨ãŒã‚ã‚‹â€¦
  }

  return "???";
}
```

---

## ã‚¢ãƒ•ã‚¿ãƒ¼ï¼šåˆ¤åˆ¥å¯èƒ½Unionã§ã€Œã‚ã‚Šãˆãªã„çŠ¶æ…‹ã€ã‚’æ¶ˆã™ğŸ§·âœ¨

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å…±é€šã‚¿ã‚°ï¼ˆã“ã“ã§ã¯ `type`ï¼‰ã‚’æŒãŸã›ã‚‹ğŸ·ï¸
* ã‚¿ã‚°ã”ã¨ã«ã€Œå¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€ã‚’å›ºå®šã™ã‚‹ğŸ“Œ
* `switch` ã®æœ€å¾Œã§ `never` ã‚’ä½¿ã£ã¦ **ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯**ã™ã‚‹âœ… ([TypeScript][1])

```typescript
// âœ… ã‚¢ãƒ•ã‚¿ãƒ¼ï¼šåˆ¤åˆ¥å¯èƒ½Unionï¼ˆDiscriminated Unionï¼‰
type ApiResponse =
  | { type: "loading" }
  | { type: "success"; data: { userName: string } }
  | { type: "error"; errorMessage: string };

// ä¾¿åˆ©ï¼šneverãƒã‚§ãƒƒã‚¯ç”¨ã®å°ã•ãªé–¢æ•°ğŸ§¯
function assertNever(x: never): never {
  throw new Error(`Unexpected object: ${JSON.stringify(x)}`);
}

function render(res: ApiResponse): string {
  switch (res.type) {
    case "loading":
      return "Loading... â³";

    case "success":
      // âœ… ã“ã“ã§ã¯ res.data ãŒå¿…ãšã‚ã‚‹ï¼ï¼ˆå‹ãŒçµã‚Œã¦ã‚‹ğŸ§·ï¼‰
      return `Hello, ${res.data.userName} ğŸ‘‹`;

    case "error":
      return `Error: ${res.errorMessage} ğŸ’¥`;

    default:
      // âœ… ã“ã“ã«æ¥ãŸã‚‰ã€Œåˆ†å²æ¼ã‚Œã€ï¼ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§æ€’ã‚‰ã‚Œã‚‹ğŸ˜¤
      return assertNever(res);
  }
}
```

ã“ã®ã€Œswitchã§ã‚¿ã‚°ã‚’è¦‹ã‚‹ã¨ã€ä¸­ã®å‹ãŒè‡ªå‹•ã§çµã‚‰ã‚Œã‚‹ã€å‹•ããŒåˆ¤åˆ¥å¯èƒ½Unionã®å¼·ã¿ã ã‚ˆğŸ§·ğŸ” ([TypeScript][3])

---

## å–ã‚Šã“ã¼ã—ãŒã©ã†é˜²ã’ã‚‹ã®ï¼ŸğŸ‘€âœ…ï¼ˆä½“é¨“ã—ã¦ã¿ã‚ˆã†ï¼‰

ãŸã¨ãˆã° `ApiResponse` ã«æ–°ã—ã„çŠ¶æ…‹ã‚’è¿½åŠ ã—ãŸã¨ã™ã‚‹ğŸ‘‡

```typescript
type ApiResponse =
  | { type: "loading" }
  | { type: "success"; data: { userName: string } }
  | { type: "error"; errorMessage: string }
  | { type: "maintenance"; until: string }; // ğŸ†•è¿½åŠ 
```

ã“ã®ç¬é–“ã€`render()` ã® `default: assertNever(res)` ãŒåŠ¹ã„ã¦ã€
ã€Œ`maintenance` ã® case ãŒç„¡ã„ã‚ˆï¼ã€ã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§æ­¢ã¾ã‚‹âœ…ğŸ§·
ï¼ˆï¼æœ¬ç•ªã§ã€Œæœªå¯¾å¿œã®ã¾ã¾ã€å‡ºè·ã—ã«ãããªã‚‹ğŸššğŸ’¨ï¼‰ ([TypeScript][1])

---

## `satisfies` ã§ã‚¹ãƒãƒ¼ãƒˆã«ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ–¹æ³•âœ¨ğŸª„

ã€Œé–¢æ•°ã‚’ä½œã‚ŠãŸããªã„ãªã€œã€ã£ã¦æ™‚ã®æ›¸ãæ–¹ã€‚
`default` ã§ `satisfies never` ã‚’ä½¿ã£ã¦ **å‹ã ã‘**ã§æ­¢ã‚ã‚‹æ„Ÿã˜ğŸ’¡ ([Zenn][2])

```typescript
function render(res: ApiResponse): string {
  switch (res.type) {
    case "loading":
      return "Loading... â³";
    case "success":
      return `Hello, ${res.data.userName} ğŸ‘‹`;
    case "error":
      return `Error: ${res.errorMessage} ğŸ’¥`;
    default: {
      // âœ… ã“ã“ãŒ never ã˜ã‚ƒãªã„ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
      const _exhaustiveCheck = res satisfies never;
      return _exhaustiveCheck;
    }
  }
}
```

---

## ã•ã‚‰ã«å®‰å…¨ã«ï¼šLintã§ã€Œdefaultç¦æ­¢ï¼ˆãŸã ã—ä¾‹å¤–ã‚ã‚Šï¼‰ã€ğŸ‘®â€â™€ï¸âœ…

ãƒãƒ¼ãƒ é–‹ç™ºã ã¨ã€`default` ã‚’é›‘ã«æ›¸ã„ã¦ã€Œå–ã‚Šã“ã¼ã—éš ã—ã€ã—ãŒã¡ğŸ˜‡ğŸ’¦
ãã“ã§ ESLint ã® **`@typescript-eslint/switch-exhaustiveness-check`** ã‚’ä½¿ã†ã¨ã€
Unionã«å¯¾ã™ã‚‹ `switch` ã®ç¶²ç¾…æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã‚Œã‚‹ã‚ˆâœ… ([blog.dennisokeeffe.com][4])

ï¼ˆâ€»ãƒ«ãƒ¼ãƒ«ã®ç´°ã‹ã„æŒ™å‹•ã¯è¨­å®šæ¬¡ç¬¬ã ã‘ã©ã€ã€Œåˆ†å²æ¼ã‚Œã‚’Lintã§ã‚‚æ—©æœŸç™ºè¦‹ã€ã§ãã‚‹ã®ãŒå¬‰ã—ã„âœ¨ï¼‰

---

## æ‰‹é †ï¼ˆå°ã•ãåˆ»ã‚€ï¼‰ğŸ‘£ğŸ›Ÿ

### 1) ã€ŒçŠ¶æ…‹ã€ã‚’åˆ—æŒ™ã™ã‚‹ğŸ“

* ä¾‹ï¼š`loading / success / error` ã¿ãŸã„ã«ã€ã¾ãšè¨€è‘‰ã§å‡ºã™ğŸ—£ï¸âœ¨

### 2) ã‚¿ã‚°åã‚’æ±ºã‚ã‚‹ğŸ·ï¸

* ã‚ˆãã‚ã‚‹ï¼š`type` / `kind` / `status`
* ãŠã™ã™ã‚ã¯ **`type` or `kind`**ï¼ˆã€Œç¨®é¡ã€æ„ŸãŒå¼·ã„ï¼‰ğŸ‘

### 3) Unionå‹ã‚’ä½œã‚‹ğŸ§·

* å„ã‚±ãƒ¼ã‚¹ã«å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã€Œå¿…é ˆã€ã«ã™ã‚‹ğŸ“Œ

### 4) åˆ†å²ã¯ã‚¿ã‚°ã§ `switch` ã™ã‚‹ğŸ”€

* `switch (res.type)` ã¿ãŸã„ã«æ›¸ã

### 5) æœ€å¾Œã«ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹âœ…

* `assertNever(res)` ã‹ `satisfies never` ã®ã©ã£ã¡ã‹ã§OKğŸ™†â€â™€ï¸

### 6) ã‚±ãƒ¼ã‚¹ã‚’1å€‹å¢—ã‚„ã—ã¦ã€Œã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€ä½“é¨“ğŸ‘€

* ã“ã“ã€ã‚ã¡ã‚ƒå¤§äº‹ï¼ã€Œå®ˆã‚ŠãŒåŠ¹ã„ã¦ã‚‹æ„Ÿã€ãŒå‡ºã‚‹ğŸ’ªâœ¨

---

## ãƒŸãƒ‹èª²é¡Œâœï¸ğŸŒ¸

### èª²é¡ŒAï¼šã‚±ãƒ¼ã‚¹è¿½åŠ ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã—ã¦ã¿ã‚ˆã†ğŸ‘€

1. `ApiResponse` ã« `{ type: "maintenance"; until: string }` ã‚’è¿½åŠ ğŸ†•
2. `render()` ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã‚’ç¢ºèªâœ…
3. `case "maintenance":` ã‚’è¶³ã—ã¦ç›´ã™ğŸ”§âœ¨

### èª²é¡ŒBï¼šåˆ¥ãƒ†ãƒ¼ãƒã§ä½œã£ã¦ã¿ã‚ˆã†ğŸ®ğŸ”

ã©ã‚Œã‹1ã¤é¸ã‚“ã§åˆ¤åˆ¥å¯èƒ½UnionåŒ–ã—ã¦ã­ğŸ‘‡

* æ³¨æ–‡çŠ¶æ…‹ï¼š`created / paid / shipped / canceled` ğŸ“¦
* ç”»é¢çŠ¶æ…‹ï¼š`idle / submitting / success / failure` ğŸ–¥ï¸
* èªè¨¼çŠ¶æ…‹ï¼š`guest / user / admin` ğŸ”

---

## AIæ´»ç”¨ãƒã‚¤ãƒ³ãƒˆğŸ¤–âœ…ï¼ˆãŠé¡˜ã„æ–¹ï¼‹ãƒã‚§ãƒƒã‚¯è¦³ç‚¹ï¼‰

### ãŠé¡˜ã„æ–¹ã®ä¾‹ğŸ“

* ã€Œã“ã®çŠ¶æ…‹é·ç§»ã«å¿…è¦ãª `type` ã®å€™è£œã‚’å‡ºã—ã¦ã€ğŸ·ï¸
* ã€Œåˆ¤åˆ¥å¯èƒ½Unionã«ç›´ã—ã¦ã€`switch` ã‚’ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ä»˜ãã«ã—ã¦ã€ğŸ§·âœ…
* ã€Œæ–°ã—ã„ã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ãŸæ™‚ã«ã€ã©ã“ãŒå£Šã‚Œã‚‹ã‹ã‚‚æ•™ãˆã¦ã€ğŸ‘€

### ãƒã‚§ãƒƒã‚¯è¦³ç‚¹âœ…

* ã‚¿ã‚°ãŒ **ãƒªãƒ†ãƒ©ãƒ«å‹**ï¼ˆ`"success"` ã¿ãŸã„ã«å›ºå®šï¼‰ã«ãªã£ã¦ã‚‹ï¼ŸğŸ·ï¸
* `default` ãŒã€Œé›‘ãªæ¡ã‚Šã¤ã¶ã—ã€ã«ãªã£ã¦ãªã„ï¼ŸğŸ˜‡
* `never` ãƒã‚§ãƒƒã‚¯ãŒåŠ¹ã„ã¦ã€Œè¿½åŠ æ¼ã‚ŒãŒæ­¢ã¾ã‚‹ã€çŠ¶æ…‹ï¼ŸğŸ›¡ï¸

---

## ã‚ˆãã‚ã‚‹ã¤ã¾ã¥ãğŸ§¯ğŸ’¦

* **ã‚¿ã‚°ãŒãƒãƒ©ãƒãƒ©**ï¼ˆ`kind` ã¨ `type` ãŒæ··åœ¨ï¼‰â†’ çµ±ä¸€ã—ã‚ˆã†ğŸ·ï¸
* **`default` ã§ä½•ã§ã‚‚è¿”ã—ã¡ã‚ƒã†** â†’ å–ã‚Šã“ã¼ã—ãŒéš ã‚Œã‚‹ğŸ™ˆ
* **optionalåœ°ç„**ï¼ˆ`data?` ã ã‚‰ã‘ï¼‰â†’ åˆ¤åˆ¥å¯èƒ½Unionã§å¿…é ˆã«å¯„ã›ã‚‹ğŸ“Œ
* **å¤–éƒ¨å…¥åŠ›ã¯å‹ã ã‘ã˜ã‚ƒå®ˆã‚Œãªã„** â†’ å…¥å£ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå‹ã‚¬ãƒ¼ãƒ‰ç­‰ï¼‰ã‚‚è€ƒãˆã‚‹ğŸ§±

---

## ã¾ã¨ã‚ğŸ§âœ¨

* åˆ¤åˆ¥å¯èƒ½Unionã¯ã€ŒçŠ¶æ…‹ã€ã‚’ãã‚Œã„ã«è¡¨ç¾ã—ã¦ã€**ã‚ã‚Šãˆãªã„çŠ¶æ…‹ã‚’æ¶ˆã™**ğŸ§·
* `switch`ï¼‹`never` ã§ **åˆ†å²æ¼ã‚ŒãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§æ­¢ã¾ã‚‹**âœ… ([TypeScript][1])
* `satisfies never` ã‚’ä½¿ã†ã¨ã€ã‚ˆã‚Šã‚¹ãƒƒã‚­ãƒªæ›¸ã‘ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‚ˆğŸª„ ([Zenn][2])

[1]: https://www.typescriptlang.org/docs/handbook/unions-and-intersections.html?utm_source=chatgpt.com "Handbook - Unions and Intersection Types"
[2]: https://zenn.dev/nkzn/articles/exhaustive-check-with-satisfies?utm_source=chatgpt.com "TypeScriptã®exhaustiveness checkã‚’satisfiesã§ç°¡å˜ã«æ›¸ã"
[3]: https://www.typescriptlang.org/docs/handbook/2/narrowing.html?utm_source=chatgpt.com "Documentation - Narrowing"
[4]: https://blog.dennisokeeffe.com/blog/2022-08-25-discriminated-unions-in-typescript?utm_source=chatgpt.com "Discriminated Unions In Typescript - Dennis O'Keeffe"
