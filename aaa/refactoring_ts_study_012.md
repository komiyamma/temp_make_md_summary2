# ç¬¬12ç«  ãƒ†ã‚¹ãƒˆã®æœ€å°å°å…¥ï¼ˆã¾ãš1æœ¬ï¼‰ğŸ§ªğŸ¥š

### ã­ã‚‰ã„ğŸ¯

* ã€Œå£Šã—ã¦ãªã„ä¿è¨¼ã€ã‚’**ãƒ†ã‚¹ãƒˆ1æœ¬**ã§ä½œã‚‹ğŸ›Ÿâœ¨
* ãƒªãƒ•ã‚¡ã‚¯ã‚¿å‰ã«ã€å®‰å¿ƒã—ã¦è§¦ã‚Œã‚‹â€œãŠå®ˆã‚Šâ€ã‚’ç½®ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ§¿âœ…

---

### ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ğŸâœ¨

âœ… `npm run test` ã§ãƒ†ã‚¹ãƒˆãŒç·‘ã«ãªã‚‹
âœ… â€œé‡è¦ãªé–¢æ•°â€ã«å¯¾ã—ã¦ **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ1æœ¬**ã‚’è¿½åŠ ã§ãã‚‹
âœ… å¤‰æ›´ã—ã¦ã‚‚è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒèµ°ã‚‹çŠ¶æ…‹ã‚’ä½“é¨“ã™ã‚‹ğŸ”ğŸ‘€ ([Vitest][1])

---

## 1) ã€Œã¾ãš1æœ¬ã€ã©ã‚Œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ï¼ŸğŸ¤”ğŸ“Œ

ãƒ†ã‚¹ãƒˆ1æœ¬ã§åŠ¹æœãŒå¤§ãã„ã®ã¯ã€ã“ã®ã¸ã‚“ğŸ‘‡

* **è¨ˆç®—ãƒ»å¤‰æ›ãƒ»åˆ¤å®š**ã¿ãŸã„ã«ã€Œå…¥å‡ºåŠ›ãŒã¯ã£ãã‚Šã€ã—ã¦ã‚‹é–¢æ•°ğŸ§®âœ¨
* é–“é•ã†ã¨ç—›ã„ï¼ˆæ–™é‡‘ãƒ»æ—¥ä»˜ãƒ»æ¨©é™ãƒ»åœ¨åº«â€¦ï¼‰ğŸ’¸ğŸ—“ï¸ğŸ”
* è§¦ã‚‹å›æ•°ãŒå¤šã„ï¼ˆã‚ˆãä¿®æ­£ã•ã‚Œã‚‹ï¼‰ğŸ”

ç›®å®‰ã¯ã“ã‚Œã§OKğŸ‘‡
**æ­£å¸¸ç³» 1ã¤ + å¢ƒç•Œå€¤ 1ã¤ + ç•°å¸¸ç³» 1ã¤** = ã¾ãšã¯å‹ã¡ğŸ†âœ¨

---

## 2) Vitest ã‚’å…¥ã‚Œã¦ã€ãƒ†ã‚¹ãƒˆã‚’å‹•ã‹ã™ğŸ§ªâš™ï¸

### 2-1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ğŸ“¦

```bash
npm i -D vitest
```

### 2-2. `package.json` ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ğŸ§·

```json
{
  "scripts": {
    "test": "vitest",
    "test:run": "vitest run",
    "coverage": "vitest run --coverage"
  }
}
```

`vitest` ã¯é–‹ç™ºä¸­ã¯åŸºæœ¬ **watch mode** ã§å‹•ã„ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´ã™ã¨é–¢é€£ãƒ†ã‚¹ãƒˆã ã‘è³¢ãå†å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã‚ˆğŸ”âš¡ ([Vitest][1])
ï¼ˆCI ã§ã¯ `vitest run` ç›¸å½“ã«ãªã‚Šã‚„ã™ã„ã€ã£ã¦è¦šãˆã¦ãŠã‘ã°OKğŸ‘Œï¼‰ ([Vitest][1])

---

## 3) ã‚µãƒ³ãƒ—ãƒ«ã§ã€Œ1æœ¬ãƒ†ã‚¹ãƒˆã€ã‚’å®Œæˆã•ã›ã‚ˆã†ğŸ§©â¡ï¸âœ…

### 3-1. ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’ç”¨æ„ã™ã‚‹ğŸ§ 

```ts
// src/shipping.ts
export function calcShippingFeeYen(subtotalYen: number, isRemoteArea: boolean): number {
  if (!Number.isFinite(subtotalYen) || subtotalYen < 0) {
    throw new Error("INVALID_SUBTOTAL");
  }

  if (subtotalYen >= 5000) {
    return isRemoteArea ? 500 : 0;
  }

  return isRemoteArea ? 800 : 300;
}
```

### 3-2. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ğŸ§ªğŸ“

Vitest ã¯ãƒ•ã‚¡ã‚¤ãƒ«åã« `.test.` ã‹ `.spec.` ãŒå…¥ã£ã¦ã‚‹ã‚‚ã®ã‚’ãƒ†ã‚¹ãƒˆã¨ã—ã¦æ‹¾ã†ã‚ˆğŸ‘€ ([Vitest][2])

```ts
// src/shipping.test.ts
import { describe, it, expect } from "vitest";
import { calcShippingFeeYen } from "./shipping";

describe("calcShippingFeeYen", () => {
  it("5000å††ä»¥ä¸Šãªã‚‰é€šå¸¸ã‚¨ãƒªã‚¢ã¯é€æ–™ç„¡æ–™ã«ãªã‚‹", () => {
    expect(calcShippingFeeYen(5000, false)).toBe(0);
    expect(calcShippingFeeYen(12000, false)).toBe(0);
  });

  it("é éš”åœ°ã¯åŠ ç®—ã•ã‚Œã‚‹", () => {
    expect(calcShippingFeeYen(5000, true)).toBe(500);
    expect(calcShippingFeeYen(4999, true)).toBe(800);
  });

  it("ä¸æ­£ãªå°è¨ˆã¯ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹", () => {
    expect(() => calcShippingFeeYen(-1, false)).toThrowError("INVALID_SUBTOTAL");
    expect(() => calcShippingFeeYen(Number.NaN, false)).toThrowError("INVALID_SUBTOTAL");
  });
});
```

### 3-3. å®Ÿè¡Œã™ã‚‹â–¶ï¸

```bash
npm run test
```

ğŸ’¡ ç·‘âœ…ã«ãªã£ãŸã‚‰ã€Œå®ˆã‚Šã€ãŒç½®ã‘ãŸåˆå›³ã ã‚ˆã€œï¼ğŸ›¡ï¸âœ¨

---

## 4) ã‚ˆãä½¿ã† â€œæœŸå¾…å€¤â€ ã®æ›¸ãæ–¹ã‚»ãƒƒãƒˆğŸ§°âœ¨

### 4-1. ãµã¤ã†ã®å€¤ãƒã‚§ãƒƒã‚¯ğŸ¯

* `toBe`ï¼ˆæ•°å€¤ãƒ»æ–‡å­—åˆ—ãªã©ï¼‰
* `toEqual`ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ/é…åˆ—ã‚’ä¸­èº«ã§æ¯”è¼ƒï¼‰

### 4-2. ä¾‹å¤–ï¼ˆthrowï¼‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹âš ï¸

ä¾‹å¤–ãƒ†ã‚¹ãƒˆã¯ **é–¢æ•°ã§åŒ…ã‚€**ã®ãŒãƒã‚¤ãƒ³ãƒˆï¼ãã†ã—ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã‚’æ•ã¾ãˆã‚‰ã‚Œãªã„ã‚ˆğŸ™…â€â™€ï¸ ([Vitest][3])

```ts
expect(() => someFn()).toThrowError("SOME_ERROR");
```

### 4-3. async ã®å¤±æ•—ï¼ˆrejectï¼‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ğŸŒ©ï¸

async ã¯ `rejects` ã‚’ä½¿ã†ã‚ˆâœ¨ï¼ˆPromise ã‚’ã¡ã‚ƒã‚“ã¨ã»ã©ã„ã¦ç¢ºèªã—ã¦ãã‚Œã‚‹ï¼‰ ([Vitest][3])

```ts
// src/parseJsonAsync.ts
export async function parseJsonAsync(text: string): Promise<unknown> {
  try {
    return JSON.parse(text);
  } catch {
    throw new Error("INVALID_JSON");
  }
}
```

```ts
import { it, expect } from "vitest";
import { parseJsonAsync } from "./parseJsonAsync";

it("å£Šã‚ŒãŸJSONã¯ reject ã™ã‚‹", async () => {
  await expect(parseJsonAsync("{")).rejects.toThrowError("INVALID_JSON");
});
```

ï¼ˆ`await` ã‚’å¿˜ã‚Œã‚‹ã¨ â€œã™ã‚ŠæŠœã‘â€ ãŒèµ·ãã‚„ã™ã„ã‹ã‚‰æ³¨æ„ã€œï¼ğŸ˜µâ€ğŸ’«ğŸ§·ï¼‰

---

## 5) ã¾ãšã¯ â€œå®ˆã‚Œã‚‹å½¢â€ ã«ã™ã‚‹ã‚³ãƒ„ğŸ‘£ğŸ›¡ï¸

### 5-1. AAA ã§æ›¸ãï¼ˆè¶…ãƒ©ã‚¯ï¼‰ğŸ§

* Arrangeï¼šæº–å‚™ğŸ½ï¸
* Actï¼šå®Ÿè¡ŒğŸƒâ€â™€ï¸
* Assertï¼šç¢ºèªâœ…

### 5-2. ãƒ†ã‚¹ãƒˆåã¯ã€Œæ—¥æœ¬èªã®ä»•æ§˜æ›¸ã€ğŸ“„âœ¨

* âŒ `works`
* âœ… `5000å††ä»¥ä¸Šãªã‚‰é€šå¸¸ã‚¨ãƒªã‚¢ã¯é€æ–™ç„¡æ–™ã«ãªã‚‹`
  ã‚ã¨ã‹ã‚‰èª­ã‚€è‡ªåˆ†ã‚’åŠ©ã‘ã‚‹ã‚ˆã€œğŸ«¶ğŸ’•

---

## 6) ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯ â€œãŠã¾ã‘ã§1å›â€ è¦‹ã¦ã¿ã‚ˆğŸ“Šâœ¨

```bash
npm run coverage
```

Vitest ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯ **v8 ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã§ã€å¿…è¦ãªã‚‰ `istanbul` ã«åˆ‡ã‚Šæ›¿ãˆã‚‚ã§ãã‚‹ã‚ˆğŸ§° ([Vitest][4])
å®Ÿè¡Œæ™‚ã«å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ä¿ƒã—ã¦ãã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‚ˆğŸ‘ ([Vitest][4])

---

## ãƒŸãƒ‹èª²é¡Œâœï¸ğŸŒ¸ï¼ˆæ‰€è¦ 15ã€œ25åˆ†ï¼‰

### èª²é¡ŒAï¼šãƒ†ã‚¹ãƒˆ1æœ¬ã‚’è¿½åŠ ã—ã‚ˆã†ğŸ§ª

1. è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã€Œè¨ˆç®—ãƒ»åˆ¤å®šãƒ»å¤‰æ›ã€ã£ã½ã„é–¢æ•°ã‚’1ã¤é¸ã¶ğŸ”
2. **æ­£å¸¸ç³»/å¢ƒç•Œå€¤/ç•°å¸¸ç³»** ã®3ã¤ã‚’æƒ³åƒã™ã‚‹ğŸ§ 
3. `.test.ts` ã‚’ä½œã£ã¦ãƒ†ã‚¹ãƒˆã‚’æ›¸ãâœï¸
4. `npm run test` ã‚’ç·‘ã«ã™ã‚‹âœ…

### åˆæ ¼ãƒã‚§ãƒƒã‚¯âœ…âœ¨

* ãƒ†ã‚¹ãƒˆãŒ1å›ã§å®‰å®šã—ã¦é€šã‚‹ï¼Ÿï¼ˆãŸã¾ã«è½ã¡ãªã„ï¼Ÿï¼‰ğŸ²âŒ
* å¤±æ•—ã—ãŸã¨ãã€ä½•ãŒå£Šã‚ŒãŸã‹åˆ†ã‹ã‚‹åå‰ã«ãªã£ã¦ã‚‹ï¼ŸğŸ“
* ã€Œã“ã®é–¢æ•°ã¯ã“ã†å‹•ãã€ãŒèª­ã‚ã‚‹ï¼ŸğŸ“–

---

## AIæ´»ç”¨ãƒã‚¤ãƒ³ãƒˆğŸ¤–ğŸ“‹âœ…

### ä½¿ã„ã©ã“ã‚1ï¼šãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ´—ã„å‡ºã—ğŸ§ ğŸ”

ãŠé¡˜ã„ä¾‹ğŸ‘‡

* ã€Œã“ã®é–¢æ•°ã® **æ­£å¸¸ç³»/å¢ƒç•Œå€¤/ç•°å¸¸ç³»** ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’10å€‹å‡ºã—ã¦ã€‚ç†ç”±ã‚‚æ·»ãˆã¦ã€
* ã€Œå…¥åŠ›ã®çµ„ã¿åˆã‚ã›ãŒå¤šã„ã‹ã‚‰ã€**æœ€å°ã‚»ãƒƒãƒˆ**ï¼ˆãƒã‚°ãŒå‡ºã‚„ã™ã„é †ï¼‰ã§ä¸¦ã¹ã¦ã€

ãƒã‚§ãƒƒã‚¯è¦³ç‚¹âœ…

* å¢ƒç•Œå€¤ï¼ˆ0ã€1ã€æœ€å¤§ã€ã¡ã‚‡ã†ã©â—‹â—‹ï¼‰ãŒå…¥ã£ã¦ã‚‹ï¼ŸğŸ§·
* ç•°å¸¸ç³»ï¼ˆnull/undefinedã€NaNã€è² æ•°ã€ç©ºæ–‡å­—ï¼‰ã‚’æƒ³åƒã—ã¦ã‚‹ï¼Ÿâš ï¸

### ä½¿ã„ã©ã“ã‚2ï¼šãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ä¸‹æ›¸ãğŸ§ªğŸ“

ãŠé¡˜ã„ä¾‹ğŸ‘‡

* ã€ŒVitest ã§ã“ã®é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€‚`toThrowError` ã¨ `rejects` ã®ä½¿ã„åˆ†ã‘ã‚‚å«ã‚ã¦ã€

ãƒã‚§ãƒƒã‚¯è¦³ç‚¹âœ…

* `throw` ã¯ `expect(() => fn())` ã«ãªã£ã¦ã‚‹ï¼Ÿï¼ˆåŒ…ã‚ã¦ã‚‹ï¼Ÿï¼‰ ([Vitest][3])
* async ã¯ `await expect(promise).rejects...` ã«ãªã£ã¦ã‚‹ï¼Ÿ ([Vitest][3])
* â€œãã‚Œã£ã½ã„æœŸå¾…å€¤â€ã˜ã‚ƒãªãã¦ã€ã¡ã‚ƒã‚“ã¨ä»•æ§˜ã‚’è¦‹ã¦ã‚‹ï¼ŸğŸ‘€

---

[1]: https://vitest.dev/guide/features "Features | Guide | Vitest"
[2]: https://vitest.dev/guide/?utm_source=chatgpt.com "Getting Started | Guide"
[3]: https://vitest.dev/api/expect.html "expect | Vitest"
[4]: https://vitest.dev/guide/coverage.html "Coverage | Guide | Vitest"
