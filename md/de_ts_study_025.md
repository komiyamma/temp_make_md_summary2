# ç¬¬25ç«  ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ğŸ“ˆğŸ•µï¸â€â™€ï¸

## ğŸ¯ ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«

* ã€Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆæ•°å­—ã®ç›£è¦–ï¼‰ğŸ“Šã€ã¨ã€Œãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆå‡¦ç†ã®é“ã®ã‚Šï¼‰ğŸ§µã€ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹
* ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆé‹ç”¨ã§â€œä½•ã‚’æ¸¬ã‚‹ã¹ãã‹â€ãŒ3ã¤ä»¥ä¸Šè¨€ãˆã‚‹âœ…
* TypeScriptã§ã€Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’1å€‹å¢—ã‚„ã™ã€ã€Œãƒˆãƒ¬ãƒ¼ã‚¹ã«1ã‚¹ãƒ‘ãƒ³è¶³ã™ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ´ã‚ã‚‹ğŸ’¡

---

## 1) ã¾ãšã¯å…¨ä½“åƒï¼šè¦³æ¸¬ã§ãã‚‹ã¨ä½•ãŒå¬‰ã—ã„ï¼ŸğŸ‘€âœ¨

ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€Œèµ·ããŸäº‹å®Ÿã€ã‚’èµ·ç‚¹ã«ã€é€šçŸ¥ãƒ»é›†è¨ˆãƒ»é€£æºãªã©ãŒå¢—ãˆã¦ã„ãè¨­è¨ˆã§ã—ãŸã­ğŸ“©ğŸ§¾ğŸ”—
ãŸã ã€å¢—ãˆã‚‹ã¨ã“ã†ãªã‚ŠãŒã¡ã§ã™ğŸ‘‡

* ã€Œæ³¨æ–‡ã—ãŸã®ã«ãƒ¡ãƒ¼ãƒ«æ¥ãªã„ã‚“ã ã‘ã©â€¦ï¼Ÿã€ğŸ˜¢
* ã€ŒãŸã¾ã«ãƒã‚¤ãƒ³ãƒˆãŒäºŒé‡ä»˜ä¸ã•ã‚Œã‚‹â€¦ï¼Ÿã€ğŸª™ğŸ’¥
* ã€Œé…ã„ï¼ã©ã“ãŒé…ã„ã®ï¼Ÿã€ğŸ¢ğŸ’¦

ã“ã“ã§åŠ©ã‘ã¦ãã‚Œã‚‹ã®ãŒ **Observabilityï¼ˆã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ“ãƒªãƒ†ã‚£ï¼‰** ã§ã™ğŸ§ ğŸ”­
OpenTelemetryï¼ˆOTelï¼‰ã¯ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ­ã‚°ãªã©ã®ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚’é›†ã‚ã‚‹ãŸã‚ã®API/SDK/ãƒ„ãƒ¼ãƒ«ç¾¤ã¨ã—ã¦æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚([OpenTelemetry][1])
ã•ã‚‰ã«è¿‘å¹´ã¯ã€ã‚·ã‚°ãƒŠãƒ«ãŒã€Œãƒˆãƒ¬ãƒ¼ã‚¹ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ­ã‚°ã€ã«åŠ ãˆã¦ã€Œãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚‚å«ã‚ã¦èªã‚‰ã‚Œã‚‹æµã‚ŒãŒã‚ã‚Šã¾ã™ã€‚([OpenTelemetry][2])

---

## 2) ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã£ã¦ãªã«ï¼ŸğŸ“Šï¼ˆâ€œæ•°å­—ã®ã‚°ãƒ©ãƒ•â€ï¼‰

### âœ… ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å½¹å‰²

ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ã€Œæ™‚é–“ã¨ä¸€ç·’ã«è¦‹ã‚‹æ•°å­—ã€ã§ã™â±ï¸
ä¾‹ï¼š1åˆ†ã‚ãŸã‚Šã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ä»¶æ•°ã€å¤±æ•—ç‡ã€é…å»¶ï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ãªã©ğŸ“ˆ

### ã‚ˆãä½¿ã†â€œå‹â€ï¼ˆè¶…é‡è¦ï¼‰ğŸ§©

Prometheusã®è€ƒãˆæ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã®ã§ã€ã¾ãšã¯ã“ã®4ã¤ã‚’è¦šãˆã‚‹ã®ãŒç‹é“ã§ã™ğŸ«¶

* **Counterï¼ˆã‚«ã‚¦ãƒ³ã‚¿ï¼‰**ï¼šå¢—ãˆã‚‹ã ã‘ï¼ˆä»¶æ•°ï¼‰ğŸ”¢
* **Gaugeï¼ˆã‚²ãƒ¼ã‚¸ï¼‰**ï¼šä¸Šä¸‹ã™ã‚‹ï¼ˆåœ¨åº«æ•°ã€ã‚­ãƒ¥ãƒ¼é•·ãªã©ï¼‰ğŸšï¸
* **Histogramï¼ˆãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ï¼‰**ï¼šåˆ†å¸ƒï¼ˆå‡¦ç†æ™‚é–“ã®ã°ã‚‰ã¤ãï¼‰ğŸ“
* **Summaryï¼ˆã‚µãƒãƒªï¼‰**ï¼šåˆ†ä½ç‚¹ã£ã½ã„è¦ç´„ï¼ˆâ€»ç”¨é€”ã¯é¸ã¶ï¼‰ğŸ§¾

ã“ã®åˆ†é¡ã¯Prometheusã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚([Prometheus][3])

---

## 3) ãƒˆãƒ¬ãƒ¼ã‚¹ã£ã¦ãªã«ï¼ŸğŸ§µï¼ˆâ€œ1å›ã®å‡¦ç†ã®é“ã®ã‚Šâ€ï¼‰

### âœ… ãƒˆãƒ¬ãƒ¼ã‚¹ã®å½¹å‰²

ãƒˆãƒ¬ãƒ¼ã‚¹ã¯ã€Œ1å›ã®å‡¦ç†ãŒã€ã©ã‚“ãªé †ç•ªã§ã€ã©ã“ã«æ™‚é–“ãŒã‹ã‹ã£ãŸã‹ã€ã‚’â€œé“ã®ã‚Šâ€ã§è¦‹ã¾ã™ğŸš¶â€â™€ï¸â¡ï¸ğŸ

* 1å›ã®æ³¨æ–‡å‡¦ç†
* 1ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼šOrderPaidï¼‰ã®å‡¦ç†
* Outboxé…ä¿¡ â†’ ãƒãƒ³ãƒ‰ãƒ©å®Ÿè¡Œ â†’ å¤–éƒ¨APIå‘¼ã³å‡ºã—

### è¶…ã–ã£ãã‚Šç”¨èª

* **Trace**ï¼šä¸€é€£ã®æµã‚Œ å…¨ä½“ğŸ§µ
* **Span**ï¼šãã®ä¸­ã®1ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆåŒºé–“ï¼‰ğŸ§±

  * ä¾‹ï¼šDBä¿å­˜ã€Outboxæ›¸ãè¾¼ã¿ã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIå‘¼ã³å‡ºã—â€¦ğŸ“¦ğŸ“®ğŸ“¡

### â€œã¤ãªãŒã‚‹â€ãŸã‚ã®å…±é€šãƒ«ãƒ¼ãƒ«ï¼ˆTrace Contextï¼‰ğŸ”—

åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’è·¨ã„ã§ã‚‚åŒã˜ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦ç¹‹ã’ãŸã„ã§ã™ğŸŒ
ãã®ãŸã‚ã« **traceparent / tracestate** ã¨ã„ã†ãƒ˜ãƒƒãƒ€å½¢å¼ãŒW3Cã§æ¨™æº–åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚([W3C][4])

---

## 4) ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆé‹ç”¨ã§ã€Œä½•ã‚’æ¸¬ã‚‹ï¼Ÿã€ğŸ›ï¸âœ¨ï¼ˆãƒŸãƒ‹ECã®ä¾‹ï¼‰

ã“ã“ã‹ã‚‰ã¯ã€ã‚ãªãŸã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã®æµã‚Œï¼ˆä¿å­˜â†’Outboxâ†’é…ä¿¡â†’ãƒãƒ³ãƒ‰ãƒ©ï¼‰ã«ãƒ”ãƒƒã‚¿ãƒªå½“ã¦ã¯ã‚ã¾ã™ğŸ§©ğŸ“¦

### 4.1 æœ€ä½é™ã»ã—ã„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆã¾ãšã¯ã“ã®3ã¤ï¼‰ğŸ¥‡

1. **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ä»¶æ•°ï¼ˆCounterï¼‰**

* ä¾‹ï¼šdomain_event_handled_total
* ãƒ©ãƒ™ãƒ«ä¾‹ï¼ševentTypeï¼ˆOrderPaidãªã©ï¼‰ã€handlerï¼ˆSendEmailãªã©ï¼‰

2. **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†å¤±æ•—æ•°ï¼ˆCounterï¼‰** ğŸ’¥

* ä¾‹ï¼šdomain_event_failed_total
* ãƒªãƒˆãƒ©ã‚¤è¨­è¨ˆã®åŠ¹ãå…·åˆãŒè¦‹ãˆã‚‹ğŸ”

3. **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†æ™‚é–“ï¼ˆHistogramï¼‰** â³

* ä¾‹ï¼šdomain_event_handler_duration_ms
* â€œé…ã„åŸå› â€ã‚’ç–‘ã†å…¥å£ã«ãªã‚‹ğŸ¢

### 4.2 OutboxãŒã‚ã‚‹ãªã‚‰ã€Œé…å»¶ã€ã‚’æ¸¬ã‚‹ã¨å¼·ã„ğŸ’ª

* **Outboxæ»ç•™ä»¶æ•°ï¼ˆGaugeï¼‰**ï¼šæœªé…ä¿¡ãŒæºœã¾ã£ã¦ãªã„ï¼ŸğŸ«™
* **Outboxæ»ç•™æ™‚é–“ï¼ˆHistogramï¼‰**ï¼šé…ä¿¡ã¾ã§ä½•ç§’ã‹ã‹ã£ã¦ã‚‹ï¼Ÿâ±ï¸

---

## 5) â€œèª­ã¿æ–¹â€ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šãƒ¡ãƒˆãƒªã‚¯ã‚¹ vs ãƒˆãƒ¬ãƒ¼ã‚¹ğŸ‘€

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§åˆ†ã‹ã‚‹ã“ã¨ğŸ“Š

* ã€Œä»Šæ—¥ã€å¤±æ•—ç‡ãŒä¸ŠãŒã£ã¦ã‚‹ã€âš ï¸
* ã€Œç‰¹å®šã®ãƒãƒ³ãƒ‰ãƒ©ã ã‘é…ã„ã€ğŸ¢
* ã€ŒOutboxãŒè©°ã¾ã£ã¦ã‚‹ã€ğŸ«™ğŸ’¦

ğŸ‘‰ ã§ã‚‚ã€**â€œã©ã®1å›â€ãŒå¤±æ•—ã—ãŸã‹** ã¯æ¢ã—ã«ãã„ã§ã™ğŸ˜µâ€ğŸ’«

### ãƒˆãƒ¬ãƒ¼ã‚¹ã§åˆ†ã‹ã‚‹ã“ã¨ğŸ§µ

* ã€Œã“ã®æ³¨æ–‡ï¼ˆã“ã®1å›ï¼‰ãŒé…ã„ã€‚çŠ¯äººã¯å¤–éƒ¨æ±ºæ¸ˆAPIã ã£ãŸã€ğŸ’³ğŸ“¡
* ã€ŒOutboxæ›¸ãè¾¼ã¿å¾Œã€ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒæ‹¾ã†ã¾ã§60ç§’ç©ºã„ã¦ã‚‹ã€ğŸ«™â¡ï¸ğŸ¤–

ğŸ‘‰ ã¤ã¾ã‚Š

* **ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼šå…¨ä½“ã®å¥åº·è¨ºæ–­** ğŸ©º
* **ãƒˆãƒ¬ãƒ¼ã‚¹ï¼šå€‹åˆ¥ã®æ¤œæ­»ï¼ˆåŸå› è¿½è·¡ï¼‰** ğŸ•µï¸â€â™€ï¸

---

## 6) TypeScriptå®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šOTelã§â€œãƒˆãƒ¬ãƒ¼ã‚¹ã‚’1æœ¬å…¥ã‚Œã‚‹â€ğŸ§µğŸ”§

OpenTelemetryã¯ã€ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹/ãƒ¡ãƒˆãƒªã‚¯ã‚¹/ãƒ­ã‚°ï¼‰ã‚’é›†ã‚ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã¨ã—ã¦æ•´ç†ã•ã‚Œã€JavaScript/Nodeå‘ã‘ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚([OpenTelemetry][1])
ã¾ãŸã€JavaScript SDK 2ç³»ã®å¤§ããªæ•´ç†ï¼ˆ2.0ï¼‰ã‚‚å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚([OpenTelemetry][5])

### 6.1 ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’â€œã‚¹ãƒ‘ãƒ³ã§å›²ã†â€ğŸ

ä¾‹ï¼šOrderPaid â†’ SendEmailHandler ã®å‡¦ç†ã‚’ã€1ã‚¹ãƒ‘ãƒ³ã¨ã—ã¦è¦‹ãˆã‚‹åŒ–ã—ã¾ã™ğŸ“©

```ts
import { trace, SpanStatusCode } from "@opentelemetry/api";

const tracer = trace.getTracer("mini-ec");

export async function handleOrderPaid(event: {
  eventId: string;
  type: "OrderPaid";
  occurredAt: string;
  aggregateId: string; // orderId
  correlationId: string;
  payload: { paymentId: string; amount: number };
}) {
  return tracer.startActiveSpan(
    "DomainEventHandler:OrderPaid:SendEmail",
    {
      attributes: {
        "domain.event.id": event.eventId,
        "domain.event.type": event.type,
        "domain.aggregate.id": event.aggregateId,
        "correlation.id": event.correlationId,
      },
    },
    async (span) => {
      try {
        // ğŸ‘‡ æœ¬æ¥ã¯ã“ã“ã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã©ã®å‰¯ä½œç”¨
        await fakeSendEmail(event.payload.paymentId);

        span.setStatus({ code: SpanStatusCode.OK });
      } catch (e) {
        span.recordException(e as Error);
        span.setStatus({ code: SpanStatusCode.ERROR });
        throw e;
      } finally {
        span.end();
      }
    }
  );
}

async function fakeSendEmail(_paymentId: string) {
  // ãƒ€ãƒŸãƒ¼ï¼ˆã‚ã¨ã§æœ¬ç‰©ã«å·®ã—æ›¿ãˆOKï¼‰
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚Œã ã‘ã§ã™ğŸ‘‡ğŸ’¡

* **â€œé…ã„/å¤±æ•—ã—ãŸâ€ãŒãƒˆãƒ¬ãƒ¼ã‚¹ä¸Šã§è¦‹ãˆã‚‹**
* correlationIdï¼ˆç¬¬24ç« ï¼‰ã‚‚å±æ€§ã¨ã—ã¦ä»˜ã‘ã‚‰ã‚Œã‚‹ğŸ”—

---

## 7) TypeScriptå®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’â€œ1å€‹å¢—ã‚„ã™â€ğŸ“ˆâ•ğŸ”¢

### 7.1 Counterã§ã€ŒæˆåŠŸä»¶æ•°ã€ã‚’æ•°ãˆã‚‹âœ…

```ts
import { metrics } from "@opentelemetry/api";

const meter = metrics.getMeter("mini-ec");

// âœ… å¢—ãˆã‚‹ã ã‘ã®ã‚«ã‚¦ãƒ³ã‚¿
const handledTotal = meter.createCounter("domain_event_handled_total", {
  description: "Number of handled domain events",
});

export function countHandled(eventType: string, handlerName: string) {
  handledTotal.add(1, {
    "domain.event.type": eventType,
    "domain.handler": handlerName,
  });
}
```

### 7.2 æ³¨æ„ï¼šãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ãƒ©ãƒ™ãƒ«ã«ã€Œæ³¨æ–‡IDã€ã‚’å…¥ã‚Œãªã„ğŸ™…â€â™€ï¸

ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯â€œé›†è¨ˆã—ã¦è¦‹ã‚‹â€ã®ã§ã€ãƒ©ãƒ™ãƒ«ãŒå¢—ãˆã™ãã‚‹ã¨é€†ã«æ­»ã«ã¾ã™ğŸ˜‡

* âœ… eventType / handlerName / resultï¼ˆsuccess/failï¼‰
* âŒ orderId / userId / emailï¼ˆ1ä»¶ã”ã¨ã«å¤‰ã‚ã‚‹å€¤ï¼‰

ã€Œå€‹åˆ¥ã®æ³¨æ–‡ã‚’è¿½ã„ãŸã„ã€ã¯ã€ãƒˆãƒ¬ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ã®æ‹…å½“ã§ã™ğŸ§µğŸ“âœ¨

---

## 8) é€ä¿¡å…ˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šOTLP ã¨ Collector ğŸššğŸ“¦

ã€Œã‚¢ãƒ—ãƒª â†’ ã©ã“ã«ãƒ‡ãƒ¼ã‚¿é€ã‚‹ã®ï¼Ÿã€å•é¡Œã€ã‚ã‚Šã¾ã™ã‚ˆã­ğŸ˜µâ€ğŸ’«
ã‚ˆãã‚ã‚‹å½¢ã¯ã“ã‚ŒğŸ‘‡

* ã‚¢ãƒ—ãƒªï¼ˆOTel SDKï¼‰
  â†’ **OTLP** ã§é€ã‚‹ğŸ“¤
  â†’ **OpenTelemetry Collector** ãŒå—ã‘å–ã£ã¦ã€åŠ å·¥ã—ã¦ã€å¥½ããªè¦³æ¸¬åŸºç›¤ã¸æµã™ğŸšš

Collectorã¯ã€ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚’ **å—ä¿¡ãƒ»å‡¦ç†ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ** ã™ã‚‹ãŸã‚ã®ãƒ™ãƒ³ãƒ€ãƒ¼ä¸­ç«‹ãªå®Ÿè£…ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚([OpenTelemetry][6])
ã¾ãŸOTLPã¯ã€OTelã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã«æ²¿ã£ã¦ãƒ­ã‚¹ãªãå‡ºã›ã‚‹â€œã¾ãšé¸ã¶è¼¸å‡ºæ–¹å¼â€ã¨ã—ã¦æ•´ç†ã•ã‚Œã€å¯¾å¿œãƒ„ãƒ¼ãƒ«ãŒå¤šã„ã®ã‚‚å¼·ã¿ã§ã™ã€‚([OpenTelemetry][7])

---

## 9) ğŸ“ æ¼”ç¿’ï¼ˆæ‰‹ã‚’å‹•ã‹ãã†ï¼ï¼‰ğŸ’ªâœ¨

### æ¼”ç¿’1ï¼šç›£è¦–ã—ãŸã„æŒ‡æ¨™ã‚’3ã¤é¸ã¶âœ…

æ¬¡ã‹ã‚‰3ã¤é¸ã‚“ã§ã€ç†ç”±ã‚‚ä¸€è¨€ã§æ›¸ã„ã¦ãã ã•ã„ğŸ“

* ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†æˆåŠŸä»¶æ•°ï¼ˆdomain_event_handled_totalï¼‰
* ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†å¤±æ•—ä»¶æ•°ï¼ˆdomain_event_failed_totalï¼‰
* ãƒãƒ³ãƒ‰ãƒ©å‡¦ç†æ™‚é–“ï¼ˆdomain_event_handler_duration_msï¼‰
* Outboxæ»ç•™ä»¶æ•°ï¼ˆoutbox_pending_countï¼‰
* Outboxæ»ç•™æ™‚é–“ï¼ˆoutbox_lag_secondsï¼‰

### æ¼”ç¿’2ï¼šãƒˆãƒ¬ãƒ¼ã‚¹ã®â€œã‚¹ãƒ‘ãƒ³è¨­è¨ˆâ€ã‚’æãğŸ§µ

OrderPaid ã®å‡¦ç†ã‚’ä¾‹ã«ã€Spanã‚’3ã€œ5å€‹ã«åˆ†ã‘ã¦æ›¸ã„ã¦ãã ã•ã„âœï¸
ä¾‹ï¼ˆé›°å›²æ°—ï¼‰ğŸ‘‡

* UseCase
* Repository Save
* Outbox Insert
* Publish Worker
* SendEmailHandler

### æ¼”ç¿’3ï¼šã€Œã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ã€ã‚’1å€‹æ±ºã‚ã‚‹ğŸ””

ä¾‹ğŸ‘‡

* ã€Œ5åˆ†é–“ã®å¤±æ•—ç‡ãŒ2%ã‚’è¶…ãˆãŸã‚‰é€šçŸ¥ã€âš ï¸
* ã€ŒOutboxæ»ç•™ä»¶æ•°ãŒ100ã‚’è¶…ãˆãŸã‚‰é€šçŸ¥ã€ğŸ«™

---

## 10) ğŸ¤– AIæ´»ç”¨ï¼ˆCopilot / Codexå‘ã‘ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼‰ğŸ’¬âœ¨

### 10.1 æŒ‡æ¨™ã®æ´—ã„å‡ºã—ã‚’æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã†ğŸ§ 

* ã€ŒãƒŸãƒ‹ECã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆé‹ç”¨ã§ã€æœ€åˆã«å…¥ã‚Œã‚‹ã¹ããƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’10å€‹ã€‚Counter/Gauge/Histogramã«åˆ†é¡ã—ã¦ã€
* ã€ŒOutboxãƒ‘ã‚¿ãƒ¼ãƒ³ã§â€œè©°ã¾ã‚Šâ€ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ¡ˆã‚’ã€ãƒ©ãƒ™ãƒ«è¨­è¨ˆã¤ãã§ã€

### 10.2 â€œãƒ©ãƒ™ãƒ«åœ°ç„â€ã‚’é¿ã‘ã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ğŸ“

* ã€Œã“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹åã¨ãƒ©ãƒ™ãƒ«è¨­è¨ˆã€ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãŒçˆ†ç™ºã—ãªã„ï¼Ÿå±ãªã„ç‚¹ãŒã‚ã‚Œã°ç›´ã—ã¦ã€

### 10.3 ãƒˆãƒ¬ãƒ¼ã‚¹ã®Spanè¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ğŸ§µ

* ã€Œã“ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®Spanåˆ†å‰²ã€ã©ã“ãŒç²’åº¦å¤§ãã™ã/å°ã•ã™ãï¼Ÿæ”¹å–„æ¡ˆã‚’å‡ºã—ã¦ã€

---

## âœ… ã“ã®ç« ã®ã¾ã¨ã‚ğŸ€

* ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ã€Œå…¨ä½“ã®å¥åº·çŠ¶æ…‹ã‚’æ•°å­—ã§è¦‹ã‚‹ã€ğŸ“ˆ
* ãƒˆãƒ¬ãƒ¼ã‚¹ã¯ã€Œ1å›ã®å‡¦ç†ã®é“ã®ã‚Šã‚’è¿½ã†ã€ğŸ§µ
* ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆé‹ç”¨ã¯ã€ã¾ãš

  * ä»¶æ•°ï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰ğŸ”¢
  * æ™‚é–“ï¼ˆé…å»¶ï¼‰â±ï¸
  * æ»ç•™ï¼ˆOutboxè©°ã¾ã‚Šï¼‰ğŸ«™
    ã‚’æ¸¬ã‚Œã‚‹ã¨ä¸€æ°—ã«å¼·ããªã‚Šã¾ã™ğŸ’ªâœ¨

[1]: https://opentelemetry.io/docs/languages/js/?utm_source=chatgpt.com "JavaScript"
[2]: https://opentelemetry.io/blog/2025/stability-proposal-announcement/?utm_source=chatgpt.com "Evolving OpenTelemetry's Stabilization and Release ..."
[3]: https://prometheus.io/docs/tutorials/understanding_metric_types/?utm_source=chatgpt.com "Understanding metric types"
[4]: https://www.w3.org/TR/trace-context/?utm_source=chatgpt.com "Trace Context"
[5]: https://opentelemetry.io/blog/2025/otel-js-sdk-2-0/?utm_source=chatgpt.com "Announcing the OpenTelemetry JavaScript SDK 2.0"
[6]: https://opentelemetry.io/docs/collector/?utm_source=chatgpt.com "Collector"
[7]: https://opentelemetry.io/docs/languages/js/exporters/?utm_source=chatgpt.com "Exporters"
